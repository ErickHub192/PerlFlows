AN√ÅLISIS END-TO-END: FLUJOS DE WORKFLOWS PERLFLOW
=========================================================

## WORKFLOW QUE S√ç FUNCIONA: CRON + GMAIL
==========================================

### REQUEST INICIAL DEL USUARIO:
- Usuario pide: "Correo motivacional diario a las 7 am con mensaje 'stay hard'"

### PASO 1: GENERACI√ìN LLM INICIAL
==================================
- LLM genera execution_plan con 2 steps
- ‚úÖ CORRECTOS: node_name y action_name est√°n presentes:
  * Step 1: node_name="Cron_Trigger", action_name="schedule"
  * Step 2: node_name="Gmail", action_name="send_messages"

### PASO 2: AN√ÅLISIS OAUTH/SMARTFORM
===================================
- CAG analiza execution_plan
- ‚úÖ NO REQUIERE OAUTH: Cron no necesita autenticaci√≥n
- ‚úÖ NO REQUIERE SMARTFORM: Gmail se puede usar sin OAuth en este caso
- Status: "ready_for_review"
- smart_forms_required: false
- oauth_requirements: []

### PASO 3: RESPUESTA FINAL AL FRONTEND
======================================
- Se env√≠a respuesta completa con:
  * execution_plan: [step1, step2] ‚úÖ CON node_name/action_name
  * status: "ready_for_review"
  * smart_form: null
  * oauth_requirements: []

### PASO 4: FRONTEND PROCESSING
==============================
- ChatView recibe respuesta
- hasWorkflowData() = true (execution_plan presente)
- hasWebhookInWorkflow() = false (no es webhook)
- NO SE MUESTRA SMARTFORM (smart_forms_required = false)
- Se muestran botones: Ejecutar, Guardar, Activar

### PASO 5: EJECUCI√ìN (SI USUARIO ELIGE)
=======================================
- Usuario presiona "Ejecutar"
- Se llama WorkflowRunnerService.execute_workflow_steps()
- ‚úÖ √âXITO: StepMetaDTO se crea correctamente porque:
  * node_name="Cron_Trigger" ‚úÖ PRESENTE
  * action_name="schedule" ‚úÖ PRESENTE
  * params={...} ‚úÖ PRESENTE
  * params_meta=[] ‚úÖ PRESENTE

### FLUJO COMPLETO EXITOSO:
==========================
User Request ‚Üí LLM Generation ‚Üí CAG Analysis ‚Üí Frontend Display ‚Üí Execution
     ‚Üì              ‚Üì              ‚Üì             ‚Üì               ‚Üì
"correo diario" ‚Üí execution_plan ‚Üí no oauth ‚Üí show buttons ‚Üí StepMetaDTO ‚úÖ

---

## WORKFLOW QUE FALLA: WEBHOOK + GMAIL (AN√ÅLISIS COMPLETO)
==========================================================

### REQUEST INICIAL DEL USUARIO:
- Usuario pide: "workflow que cuando reciba webhook env√≠e email de bienvenida"

### PASO 1: GENERACI√ìN LLM INICIAL
==================================
- ‚ùå PROBLEMA ENCONTRADO: LLM genera execution_plan INCORRECTO desde el inicio:
  * Step 1: node_name="Unknown_Node" ‚ùå (deber√≠a ser "Webhook")  
  * Step 1: action_name="trigger" ‚úÖ (correcto)
  * Step 1: params={} ‚ùå (vac√≠o, deber√≠a tener flow_id, etc.)
  * Step 2: node_name="Gmail" ‚úÖ (correcto)
  * Step 2: action_name="send_messages" ‚úÖ (correcto)

### PASO 2: AN√ÅLISIS OAUTH/SMARTFORM  
===================================
- CAG analiza execution_plan (ya corrupto)
- ‚úÖ NO REQUIERE OAUTH: Este workflow particular no detect√≥ OAuth
- ‚úÖ NO REQUIERE SMARTFORM: smart_forms_required = false
- Status: "ready_for_review"
- oauth_requirements: []

### PASO 3: SMARTFORM PROCESSING (NO APLICA)
==========================================
- NO SE EJECUTA: Este workflow no requiri√≥ SmartForm
- El problema NO est√° en SmartForm submission

### PASO 4: EJECUCI√ìN Y FALLO
============================
- Usuario presiona "Ejecutar"
- WorkflowRunnerService.execute_workflow_steps() recibe:
  * node_name="Unknown_Node" ‚ùå
  * action_name="trigger" ‚úÖ  
  * params={} ‚ùå
- ‚ùå FALLA: StepMetaDTO(**step) validation error porque:
  * node_name="Unknown_Node" no es v√°lido
  * params={} est√° vac√≠o cuando deber√≠a tener datos

### PUNTOS CR√çTICOS A VERIFICAR:
===============================
1. ¬øLLM genera node_name/action_name en primera respuesta?
2. ¬øCAG preserva los campos al detectar OAuth?
3. ¬øSmartForm submission corrompe execution_plan?
4. ¬øWorkflowRunner recibe datos incompletos?

---

## ‚úÖ ROOT CAUSE CONFIRMADO:
===========================

### üéØ PROBLEMA: LLM genera node_name="Unknown_Node" para webhooks

**EVIDENCIA:**
- Workflow Cron + Gmail: node_name="Cron_Trigger" ‚úÖ
- Workflow Webhook + Gmail: node_name="Unknown_Node" ‚ùå

**CAUSA:** El LLM no conoce el nombre correcto del nodo Webhook

---

## üõ†Ô∏è PR√ìXIMOS PASOS PARA FIX:
==============================
1. ‚úÖ ANALIZADO: Identificar que problema est√° en LLM generation
2. üîç INVESTIGAR: ¬øC√≥mo obtiene LLM los nombres de nodos disponibles?
3. üîß VERIFICAR: Base de datos de nodos - ¬øexiste "Webhook" correctamente?  
4. üõ†Ô∏è FIXEAR: Prompt/contexto del LLM para reconocer webhooks
5. ‚úÖ VALIDAR: Re-generar workflow y confirmar node_name correcto

**TEOR√çA DEL USUARIO CONFIRMADA:** Los datos NO se persisten correctamente desde la generaci√≥n inicial del LLM.
