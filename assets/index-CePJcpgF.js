var aa=Object.defineProperty;var ts=t=>{throw TypeError(t)};var oa=(t,e,s)=>e in t?aa(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var rs=(t,e,s)=>oa(t,typeof e!="symbol"?e+"":e,s),mr=(t,e,s)=>e.has(t)||ts("Cannot "+s);var g=(t,e,s)=>(mr(t,e,"read from private field"),s?s.call(t):e.get(t)),T=(t,e,s)=>e.has(t)?ts("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),E=(t,e,s,n)=>(mr(t,e,"write to private field"),n?n.call(t,s):e.set(t,s),s),I=(t,e,s)=>(mr(t,e,"access private method"),s);var Kt=(t,e,s,n)=>({set _(a){E(t,e,a,s)},get _(){return g(t,e,n)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();var Ut,F,Vs,Ge,ss,Js,Ys,Xs,qr,vr,yr,Zs,Lt={},en=[],ia=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,zt=Array.isArray;function Se(t,e){for(var s in e)t[s]=e[s];return t}function Ur(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function xe(t,e,s){var n,a,o,i={};for(o in e)o=="key"?n=e[o]:o=="ref"?a=e[o]:i[o]=e[o];if(arguments.length>2&&(i.children=arguments.length>3?Ut.call(arguments,2):s),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)i[o]===void 0&&(i[o]=t.defaultProps[o]);return $t(t,i,n,a,null)}function $t(t,e,s,n,a){var o={type:t,props:e,key:s,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:a??++Vs,__i:-1,__u:0};return a==null&&F.vnode!=null&&F.vnode(o),o}function la(){return{current:null}}function X(t){return t.children}function pe(t,e){this.props=t,this.context=e}function bt(t,e){if(e==null)return t.__?bt(t.__,t.__i+1):null;for(var s;e<t.__k.length;e++)if((s=t.__k[e])!=null&&s.__e!=null)return s.__e;return typeof t.type=="function"?bt(t):null}function tn(t){var e,s;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((s=t.__k[e])!=null&&s.__e!=null){t.__e=t.__c.base=s.__e;break}return tn(t)}}function br(t){(!t.__d&&(t.__d=!0)&&Ge.push(t)&&!tr.__r++||ss!=F.debounceRendering)&&((ss=F.debounceRendering)||Js)(tr)}function tr(){for(var t,e,s,n,a,o,i,c=1;Ge.length;)Ge.length>c&&Ge.sort(Ys),t=Ge.shift(),c=Ge.length,t.__d&&(s=void 0,a=(n=(e=t).__v).__e,o=[],i=[],e.__P&&((s=Se({},n)).__v=n.__v+1,F.vnode&&F.vnode(s),zr(e.__P,s,n,e.__n,e.__P.namespaceURI,32&n.__u?[a]:null,o,a??bt(n),!!(32&n.__u),i),s.__v=n.__v,s.__.__k[s.__i]=s,nn(o,s,i),s.__e!=a&&tn(s)));tr.__r=0}function rn(t,e,s,n,a,o,i,c,m,h,_){var d,f,v,b,y,p,x=n&&n.__k||en,l=e.length;for(m=ca(s,e,x,m,l),d=0;d<l;d++)(v=s.__k[d])!=null&&(f=v.__i==-1?Lt:x[v.__i]||Lt,v.__i=d,p=zr(t,v,f,a,o,i,c,m,h,_),b=v.__e,v.ref&&f.ref!=v.ref&&(f.ref&&Hr(f.ref,null,v),_.push(v.ref,v.__c||b,v)),y==null&&b!=null&&(y=b),4&v.__u||f.__k===v.__k?m=sn(v,m,t):typeof v.type=="function"&&p!==void 0?m=p:b&&(m=b.nextSibling),v.__u&=-7);return s.__e=y,m}function ca(t,e,s,n,a){var o,i,c,m,h,_=s.length,d=_,f=0;for(t.__k=new Array(a),o=0;o<a;o++)(i=e[o])!=null&&typeof i!="boolean"&&typeof i!="function"?(m=o+f,(i=t.__k[o]=typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?$t(null,i,null,null,null):zt(i)?$t(X,{children:i},null,null,null):i.constructor==null&&i.__b>0?$t(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):i).__=t,i.__b=t.__b+1,c=null,(h=i.__i=da(i,s,m,d))!=-1&&(d--,(c=s[h])&&(c.__u|=2)),c==null||c.__v==null?(h==-1&&(a>_?f--:a<_&&f++),typeof i.type!="function"&&(i.__u|=4)):h!=m&&(h==m-1?f--:h==m+1?f++:(h>m?f--:f++,i.__u|=4))):t.__k[o]=null;if(d)for(o=0;o<_;o++)(c=s[o])!=null&&(2&c.__u)==0&&(c.__e==n&&(n=bt(c)),on(c,c));return n}function sn(t,e,s){var n,a;if(typeof t.type=="function"){for(n=t.__k,a=0;n&&a<n.length;a++)n[a]&&(n[a].__=t,e=sn(n[a],e,s));return e}t.__e!=e&&(e&&t.type&&!s.contains(e)&&(e=bt(t)),s.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function _e(t,e){return e=e||[],t==null||typeof t=="boolean"||(zt(t)?t.some(function(s){_e(s,e)}):e.push(t)),e}function da(t,e,s,n){var a,o,i=t.key,c=t.type,m=e[s];if(m===null&&t.key==null||m&&i==m.key&&c==m.type&&(2&m.__u)==0)return s;if(n>(m!=null&&(2&m.__u)==0?1:0))for(a=s-1,o=s+1;a>=0||o<e.length;){if(a>=0){if((m=e[a])&&(2&m.__u)==0&&i==m.key&&c==m.type)return a;a--}if(o<e.length){if((m=e[o])&&(2&m.__u)==0&&i==m.key&&c==m.type)return o;o++}}return-1}function ns(t,e,s){e[0]=="-"?t.setProperty(e,s??""):t[e]=s==null?"":typeof s!="number"||ia.test(e)?s:s+"px"}function Vt(t,e,s,n,a){var o,i;e:if(e=="style")if(typeof s=="string")t.style.cssText=s;else{if(typeof n=="string"&&(t.style.cssText=n=""),n)for(e in n)s&&e in s||ns(t.style,e,"");if(s)for(e in s)n&&s[e]==n[e]||ns(t.style,e,s[e])}else if(e[0]=="o"&&e[1]=="n")o=e!=(e=e.replace(Xs,"$1")),i=e.toLowerCase(),e=i in t||e=="onFocusOut"||e=="onFocusIn"?i.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=s,s?n?s.u=n.u:(s.u=qr,t.addEventListener(e,o?yr:vr,o)):t.removeEventListener(e,o?yr:vr,o);else{if(a=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=s??"";break e}catch{}typeof s=="function"||(s==null||s===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&s==1?"":s))}}function as(t){return function(e){if(this.l){var s=this.l[e.type+t];if(e.t==null)e.t=qr++;else if(e.t<s.u)return;return s(F.event?F.event(e):e)}}}function zr(t,e,s,n,a,o,i,c,m,h){var _,d,f,v,b,y,p,x,l,u,w,k,O,D,H,A,N,S=e.type;if(e.constructor!=null)return null;128&s.__u&&(m=!!(32&s.__u),o=[c=e.__e=s.__e]),(_=F.__b)&&_(e);e:if(typeof S=="function")try{if(x=e.props,l="prototype"in S&&S.prototype.render,u=(_=S.contextType)&&n[_.__c],w=_?u?u.props.value:_.__:n,s.__c?p=(d=e.__c=s.__c).__=d.__E:(l?e.__c=d=new S(x,w):(e.__c=d=new pe(x,w),d.constructor=S,d.render=ha),u&&u.sub(d),d.props=x,d.state||(d.state={}),d.context=w,d.__n=n,f=d.__d=!0,d.__h=[],d._sb=[]),l&&d.__s==null&&(d.__s=d.state),l&&S.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=Se({},d.__s)),Se(d.__s,S.getDerivedStateFromProps(x,d.__s))),v=d.props,b=d.state,d.__v=e,f)l&&S.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),l&&d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(l&&S.getDerivedStateFromProps==null&&x!==v&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(x,w),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(x,d.__s,w)===!1||e.__v==s.__v){for(e.__v!=s.__v&&(d.props=x,d.state=d.__s,d.__d=!1),e.__e=s.__e,e.__k=s.__k,e.__k.some(function(R){R&&(R.__=e)}),k=0;k<d._sb.length;k++)d.__h.push(d._sb[k]);d._sb=[],d.__h.length&&i.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(x,d.__s,w),l&&d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(v,b,y)})}if(d.context=w,d.props=x,d.__P=t,d.__e=!1,O=F.__r,D=0,l){for(d.state=d.__s,d.__d=!1,O&&O(e),_=d.render(d.props,d.state,d.context),H=0;H<d._sb.length;H++)d.__h.push(d._sb[H]);d._sb=[]}else do d.__d=!1,O&&O(e),_=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++D<25);d.state=d.__s,d.getChildContext!=null&&(n=Se(Se({},n),d.getChildContext())),l&&!f&&d.getSnapshotBeforeUpdate!=null&&(y=d.getSnapshotBeforeUpdate(v,b)),A=_,_!=null&&_.type===X&&_.key==null&&(A=an(_.props.children)),c=rn(t,zt(A)?A:[A],e,s,n,a,o,i,c,m,h),d.base=e.__e,e.__u&=-161,d.__h.length&&i.push(d),p&&(d.__E=d.__=null)}catch(R){if(e.__v=null,m||o!=null)if(R.then){for(e.__u|=m?160:128;c&&c.nodeType==8&&c.nextSibling;)c=c.nextSibling;o[o.indexOf(c)]=null,e.__e=c}else for(N=o.length;N--;)Ur(o[N]);else e.__e=s.__e,e.__k=s.__k;F.__e(R,e,s)}else o==null&&e.__v==s.__v?(e.__k=s.__k,e.__e=s.__e):c=e.__e=ua(s.__e,e,s,n,a,o,i,m,h);return(_=F.diffed)&&_(e),128&e.__u?void 0:c}function nn(t,e,s){for(var n=0;n<s.length;n++)Hr(s[n],s[++n],s[++n]);F.__c&&F.__c(e,t),t.some(function(a){try{t=a.__h,a.__h=[],t.some(function(o){o.call(a)})}catch(o){F.__e(o,a.__v)}})}function an(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:zt(t)?t.map(an):Se({},t)}function ua(t,e,s,n,a,o,i,c,m){var h,_,d,f,v,b,y,p=s.props,x=e.props,l=e.type;if(l=="svg"?a="http://www.w3.org/2000/svg":l=="math"?a="http://www.w3.org/1998/Math/MathML":a||(a="http://www.w3.org/1999/xhtml"),o!=null){for(h=0;h<o.length;h++)if((v=o[h])&&"setAttribute"in v==!!l&&(l?v.localName==l:v.nodeType==3)){t=v,o[h]=null;break}}if(t==null){if(l==null)return document.createTextNode(x);t=document.createElementNS(a,l,x.is&&x),c&&(F.__m&&F.__m(e,o),c=!1),o=null}if(l==null)p===x||c&&t.data==x||(t.data=x);else{if(o=o&&Ut.call(t.childNodes),p=s.props||Lt,!c&&o!=null)for(p={},h=0;h<t.attributes.length;h++)p[(v=t.attributes[h]).name]=v.value;for(h in p)if(v=p[h],h!="children"){if(h=="dangerouslySetInnerHTML")d=v;else if(!(h in x)){if(h=="value"&&"defaultValue"in x||h=="checked"&&"defaultChecked"in x)continue;Vt(t,h,null,v,a)}}for(h in x)v=x[h],h=="children"?f=v:h=="dangerouslySetInnerHTML"?_=v:h=="value"?b=v:h=="checked"?y=v:c&&typeof v!="function"||p[h]===v||Vt(t,h,v,p[h],a);if(_)c||d&&(_.__html==d.__html||_.__html==t.innerHTML)||(t.innerHTML=_.__html),e.__k=[];else if(d&&(t.innerHTML=""),rn(e.type=="template"?t.content:t,zt(f)?f:[f],e,s,n,l=="foreignObject"?"http://www.w3.org/1999/xhtml":a,o,i,o?o[0]:s.__k&&bt(s,0),c,m),o!=null)for(h=o.length;h--;)Ur(o[h]);c||(h="value",l=="progress"&&b==null?t.removeAttribute("value"):b!=null&&(b!==t[h]||l=="progress"&&!b||l=="option"&&b!=p[h])&&Vt(t,h,b,p[h],a),h="checked",y!=null&&y!=t[h]&&Vt(t,h,y,p[h],a))}return t}function Hr(t,e,s){try{if(typeof t=="function"){var n=typeof t.__u=="function";n&&t.__u(),n&&e==null||(t.__u=t(e))}else t.current=e}catch(a){F.__e(a,s)}}function on(t,e,s){var n,a;if(F.unmount&&F.unmount(t),(n=t.ref)&&(n.current&&n.current!=t.__e||Hr(n,null,e)),(n=t.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(o){F.__e(o,e)}n.base=n.__P=null}if(n=t.__k)for(a=0;a<n.length;a++)n[a]&&on(n[a],e,s||typeof t.type!="function");s||Ur(t.__e),t.__c=t.__=t.__e=void 0}function ha(t,e,s){return this.constructor(t,s)}function _t(t,e,s){var n,a,o,i;e==document&&(e=document.documentElement),F.__&&F.__(t,e),a=(n=typeof s=="function")?null:s&&s.__k||e.__k,o=[],i=[],zr(e,t=(!n&&s||e).__k=xe(X,null,[t]),a||Lt,Lt,e.namespaceURI,!n&&s?[s]:a?null:e.firstChild?Ut.call(e.childNodes):null,o,!n&&s?s:a?a.__e:e.firstChild,n,i),nn(o,t,i)}function ln(t,e){_t(t,e,ln)}function cn(t,e,s){var n,a,o,i,c=Se({},t.props);for(o in t.type&&t.type.defaultProps&&(i=t.type.defaultProps),e)o=="key"?n=e[o]:o=="ref"?a=e[o]:c[o]=e[o]===void 0&&i!=null?i[o]:e[o];return arguments.length>2&&(c.children=arguments.length>3?Ut.call(arguments,2):s),$t(t.type,c,n||t.key,a||t.ref,null)}function Ht(t){function e(s){var n,a;return this.getChildContext||(n=new Set,(a={})[e.__c]=this,this.getChildContext=function(){return a},this.componentWillUnmount=function(){n=null},this.shouldComponentUpdate=function(o){this.props.value!=o.value&&n.forEach(function(i){i.__e=!0,br(i)})},this.sub=function(o){n.add(o);var i=o.componentWillUnmount;o.componentWillUnmount=function(){n&&n.delete(o),i&&i.call(o)}}),s.children}return e.__c="__cC"+Zs++,e.__=t,e.Provider=e.__l=(e.Consumer=function(s,n){return s.children(n)}).contextType=e,e}Ut=en.slice,F={__e:function(t,e,s,n){for(var a,o,i;e=e.__;)if((a=e.__c)&&!a.__)try{if((o=a.constructor)&&o.getDerivedStateFromError!=null&&(a.setState(o.getDerivedStateFromError(t)),i=a.__d),a.componentDidCatch!=null&&(a.componentDidCatch(t,n||{}),i=a.__d),i)return a.__E=a}catch(c){t=c}throw t}},Vs=0,pe.prototype.setState=function(t,e){var s;s=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Se({},this.state),typeof t=="function"&&(t=t(Se({},s),this.props)),t&&Se(s,t),t!=null&&this.__v&&(e&&this._sb.push(e),br(this))},pe.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),br(this))},pe.prototype.render=X,Ge=[],Js=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ys=function(t,e){return t.__v.__b-e.__v.__b},tr.__r=0,Xs=/(PointerCapture)$|Capture$/i,qr=0,vr=as(!1),yr=as(!0),Zs=0;var ma=0;function r(t,e,s,n,a,o){e||(e={});var i,c,m=e;if("ref"in m)for(c in m={},e)c=="ref"?i=e[c]:m[c]=e[c];var h={type:t,props:m,key:s,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--ma,__i:-1,__u:0,__source:a,__self:o};if(typeof t=="function"&&(i=t.defaultProps))for(c in i)m[c]===void 0&&(m[c]=i[c]);return F.vnode&&F.vnode(h),h}var Nt=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},st=typeof window>"u"||"Deno"in globalThis;function de(){}function fa(t,e){return typeof t=="function"?t(e):t}function _r(t){return typeof t=="number"&&t>=0&&t!==1/0}function dn(t,e){return Math.max(t+(e||0)-Date.now(),0)}function We(t,e){return typeof t=="function"?t(e):t}function be(t,e){return typeof t=="function"?t(e):t}function os(t,e){const{type:s="all",exact:n,fetchStatus:a,predicate:o,queryKey:i,stale:c}=t;if(i){if(n){if(e.queryHash!==Wr(i,e.options))return!1}else if(!Dt(e.queryKey,i))return!1}if(s!=="all"){const m=e.isActive();if(s==="active"&&!m||s==="inactive"&&m)return!1}return!(typeof c=="boolean"&&e.isStale()!==c||a&&a!==e.state.fetchStatus||o&&!o(e))}function is(t,e){const{exact:s,status:n,predicate:a,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(s){if(nt(e.options.mutationKey)!==nt(o))return!1}else if(!Dt(e.options.mutationKey,o))return!1}return!(n&&e.state.status!==n||a&&!a(e))}function Wr(t,e){return((e==null?void 0:e.queryKeyHashFn)||nt)(t)}function nt(t){return JSON.stringify(t,(e,s)=>wr(s)?Object.keys(s).sort().reduce((n,a)=>(n[a]=s[a],n),{}):s)}function Dt(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(s=>Dt(t[s],e[s])):!1}function un(t,e){if(t===e)return t;const s=ls(t)&&ls(e);if(s||wr(t)&&wr(e)){const n=s?t:Object.keys(t),a=n.length,o=s?e:Object.keys(e),i=o.length,c=s?[]:{},m=new Set(n);let h=0;for(let _=0;_<i;_++){const d=s?_:o[_];(!s&&m.has(d)||s)&&t[d]===void 0&&e[d]===void 0?(c[d]=void 0,h++):(c[d]=un(t[d],e[d]),c[d]===t[d]&&t[d]!==void 0&&h++)}return a===i&&h===a?t:c}return e}function rr(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const s in t)if(t[s]!==e[s])return!1;return!0}function ls(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function wr(t){if(!cs(t))return!1;const e=t.constructor;if(e===void 0)return!0;const s=e.prototype;return!(!cs(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function cs(t){return Object.prototype.toString.call(t)==="[object Object]"}function pa(t){return new Promise(e=>{setTimeout(e,t)})}function Nr(t,e,s){return typeof s.structuralSharing=="function"?s.structuralSharing(t,e):s.structuralSharing!==!1?un(t,e):e}function ga(t,e,s=0){const n=[...t,e];return s&&n.length>s?n.slice(1):n}function xa(t,e,s=0){const n=[e,...t];return s&&n.length>s?n.slice(0,-1):n}var Br=Symbol();function hn(t,e){return!t.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!t.queryFn||t.queryFn===Br?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function mn(t,e){return typeof t=="function"?t(...e):!!t}var Ke,Le,it,Is,va=(Is=class extends Nt{constructor(){super();T(this,Ke);T(this,Le);T(this,it);E(this,it,e=>{if(!st&&window.addEventListener){const s=()=>e();return window.addEventListener("visibilitychange",s,!1),()=>{window.removeEventListener("visibilitychange",s)}}})}onSubscribe(){g(this,Le)||this.setEventListener(g(this,it))}onUnsubscribe(){var e;this.hasListeners()||((e=g(this,Le))==null||e.call(this),E(this,Le,void 0))}setEventListener(e){var s;E(this,it,e),(s=g(this,Le))==null||s.call(this),E(this,Le,e(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(e){g(this,Ke)!==e&&(E(this,Ke,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(s=>{s(e)})}isFocused(){var e;return typeof g(this,Ke)=="boolean"?g(this,Ke):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Ke=new WeakMap,Le=new WeakMap,it=new WeakMap,Is),Qr=new va,lt,De,ct,qs,ya=(qs=class extends Nt{constructor(){super();T(this,lt,!0);T(this,De);T(this,ct);E(this,ct,e=>{if(!st&&window.addEventListener){const s=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",s,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",n)}}})}onSubscribe(){g(this,De)||this.setEventListener(g(this,ct))}onUnsubscribe(){var e;this.hasListeners()||((e=g(this,De))==null||e.call(this),E(this,De,void 0))}setEventListener(e){var s;E(this,ct,e),(s=g(this,De))==null||s.call(this),E(this,De,e(this.setOnline.bind(this)))}setOnline(e){g(this,lt)!==e&&(E(this,lt,e),this.listeners.forEach(n=>{n(e)}))}isOnline(){return g(this,lt)}},lt=new WeakMap,De=new WeakMap,ct=new WeakMap,qs),sr=new ya;function Cr(){let t,e;const s=new Promise((a,o)=>{t=a,e=o});s.status="pending",s.catch(()=>{});function n(a){Object.assign(s,a),delete s.resolve,delete s.reject}return s.resolve=a=>{n({status:"fulfilled",value:a}),t(a)},s.reject=a=>{n({status:"rejected",reason:a}),e(a)},s}function ba(t){return Math.min(1e3*2**t,3e4)}function fn(t){return(t??"online")==="online"?sr.isOnline():!0}var pn=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function fr(t){return t instanceof pn}function gn(t){let e=!1,s=0,n=!1,a;const o=Cr(),i=y=>{var p;n||(f(new pn(y)),(p=t.abort)==null||p.call(t))},c=()=>{e=!0},m=()=>{e=!1},h=()=>Qr.isFocused()&&(t.networkMode==="always"||sr.isOnline())&&t.canRun(),_=()=>fn(t.networkMode)&&t.canRun(),d=y=>{var p;n||(n=!0,(p=t.onSuccess)==null||p.call(t,y),a==null||a(),o.resolve(y))},f=y=>{var p;n||(n=!0,(p=t.onError)==null||p.call(t,y),a==null||a(),o.reject(y))},v=()=>new Promise(y=>{var p;a=x=>{(n||h())&&y(x)},(p=t.onPause)==null||p.call(t)}).then(()=>{var y;a=void 0,n||(y=t.onContinue)==null||y.call(t)}),b=()=>{if(n)return;let y;const p=s===0?t.initialPromise:void 0;try{y=p??t.fn()}catch(x){y=Promise.reject(x)}Promise.resolve(y).then(d).catch(x=>{var O;if(n)return;const l=t.retry??(st?0:3),u=t.retryDelay??ba,w=typeof u=="function"?u(s,x):u,k=l===!0||typeof l=="number"&&s<l||typeof l=="function"&&l(s,x);if(e||!k){f(x);return}s++,(O=t.onFail)==null||O.call(t,s,x),pa(w).then(()=>h()?void 0:v()).then(()=>{e?f(x):b()})})};return{promise:o,cancel:i,continue:()=>(a==null||a(),o),cancelRetry:c,continueRetry:m,canStart:_,start:()=>(_()?b():v().then(b),o)}}var _a=t=>setTimeout(t,0);function wa(){let t=[],e=0,s=c=>{c()},n=c=>{c()},a=_a;const o=c=>{e?t.push(c):a(()=>{s(c)})},i=()=>{const c=t;t=[],c.length&&a(()=>{n(()=>{c.forEach(m=>{s(m)})})})};return{batch:c=>{let m;e++;try{m=c()}finally{e--,e||i()}return m},batchCalls:c=>(...m)=>{o(()=>{c(...m)})},schedule:o,setNotifyFunction:c=>{s=c},setBatchNotifyFunction:c=>{n=c},setScheduler:c=>{a=c}}}var se=wa(),Ve,Us,xn=(Us=class{constructor(){T(this,Ve)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),_r(this.gcTime)&&E(this,Ve,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(st?1/0:5*60*1e3))}clearGcTimeout(){g(this,Ve)&&(clearTimeout(g(this,Ve)),E(this,Ve,void 0))}},Ve=new WeakMap,Us),dt,ut,fe,Je,oe,jt,Ye,ve,Ee,zs,Na=(zs=class extends xn{constructor(e){super();T(this,ve);T(this,dt);T(this,ut);T(this,fe);T(this,Je);T(this,oe);T(this,jt);T(this,Ye);E(this,Ye,!1),E(this,jt,e.defaultOptions),this.setOptions(e.options),this.observers=[],E(this,Je,e.client),E(this,fe,g(this,Je).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,E(this,dt,Ca(this.options)),this.state=e.state??g(this,dt),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=g(this,oe))==null?void 0:e.promise}setOptions(e){this.options={...g(this,jt),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&g(this,fe).remove(this)}setData(e,s){const n=Nr(this.state.data,e,this.options);return I(this,ve,Ee).call(this,{data:n,type:"success",dataUpdatedAt:s==null?void 0:s.updatedAt,manual:s==null?void 0:s.manual}),n}setState(e,s){I(this,ve,Ee).call(this,{type:"setState",state:e,setStateOptions:s})}cancel(e){var n,a;const s=(n=g(this,oe))==null?void 0:n.promise;return(a=g(this,oe))==null||a.cancel(e),s?s.then(de).catch(de):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(g(this,dt))}isActive(){return this.observers.some(e=>be(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Br||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>We(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!dn(this.state.dataUpdatedAt,e)}onFocus(){var s;const e=this.observers.find(n=>n.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(s=g(this,oe))==null||s.continue()}onOnline(){var s;const e=this.observers.find(n=>n.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(s=g(this,oe))==null||s.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),g(this,fe).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(s=>s!==e),this.observers.length||(g(this,oe)&&(g(this,Ye)?g(this,oe).cancel({revert:!0}):g(this,oe).cancelRetry()),this.scheduleGc()),g(this,fe).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||I(this,ve,Ee).call(this,{type:"invalidate"})}fetch(e,s){var h,_,d;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(s!=null&&s.cancelRefetch))this.cancel({silent:!0});else if(g(this,oe))return g(this,oe).continueRetry(),g(this,oe).promise}if(e&&this.setOptions(e),!this.options.queryFn){const f=this.observers.find(v=>v.options.queryFn);f&&this.setOptions(f.options)}const n=new AbortController,a=f=>{Object.defineProperty(f,"signal",{enumerable:!0,get:()=>(E(this,Ye,!0),n.signal)})},o=()=>{const f=hn(this.options,s),b=(()=>{const y={client:g(this,Je),queryKey:this.queryKey,meta:this.meta};return a(y),y})();return E(this,Ye,!1),this.options.persister?this.options.persister(f,b,this):f(b)},c=(()=>{const f={fetchOptions:s,options:this.options,queryKey:this.queryKey,client:g(this,Je),state:this.state,fetchFn:o};return a(f),f})();(h=this.options.behavior)==null||h.onFetch(c,this),E(this,ut,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((_=c.fetchOptions)==null?void 0:_.meta))&&I(this,ve,Ee).call(this,{type:"fetch",meta:(d=c.fetchOptions)==null?void 0:d.meta});const m=f=>{var v,b,y,p;fr(f)&&f.silent||I(this,ve,Ee).call(this,{type:"error",error:f}),fr(f)||((b=(v=g(this,fe).config).onError)==null||b.call(v,f,this),(p=(y=g(this,fe).config).onSettled)==null||p.call(y,this.state.data,f,this)),this.scheduleGc()};return E(this,oe,gn({initialPromise:s==null?void 0:s.initialPromise,fn:c.fetchFn,abort:n.abort.bind(n),onSuccess:f=>{var v,b,y,p;if(f===void 0){m(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(f)}catch(x){m(x);return}(b=(v=g(this,fe).config).onSuccess)==null||b.call(v,f,this),(p=(y=g(this,fe).config).onSettled)==null||p.call(y,f,this.state.error,this),this.scheduleGc()},onError:m,onFail:(f,v)=>{I(this,ve,Ee).call(this,{type:"failed",failureCount:f,error:v})},onPause:()=>{I(this,ve,Ee).call(this,{type:"pause"})},onContinue:()=>{I(this,ve,Ee).call(this,{type:"continue"})},retry:c.options.retry,retryDelay:c.options.retryDelay,networkMode:c.options.networkMode,canRun:()=>!0})),g(this,oe).start()}},dt=new WeakMap,ut=new WeakMap,fe=new WeakMap,Je=new WeakMap,oe=new WeakMap,jt=new WeakMap,Ye=new WeakMap,ve=new WeakSet,Ee=function(e){const s=n=>{switch(e.type){case"failed":return{...n,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...vn(n.data,this.options),fetchMeta:e.meta??null};case"success":return{...n,data:e.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const a=e.error;return fr(a)&&a.revert&&g(this,ut)?{...g(this,ut),fetchStatus:"idle"}:{...n,error:a,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...e.state}}};this.state=s(this.state),se.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),g(this,fe).notify({query:this,type:"updated",action:e})})},zs);function vn(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:fn(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Ca(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,s=e!==void 0,n=s?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:s?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}var Ne,Hs,ka=(Hs=class extends Nt{constructor(e={}){super();T(this,Ne);this.config=e,E(this,Ne,new Map)}build(e,s,n){const a=s.queryKey,o=s.queryHash??Wr(a,s);let i=this.get(o);return i||(i=new Na({client:e,queryKey:a,queryHash:o,options:e.defaultQueryOptions(s),state:n,defaultOptions:e.getQueryDefaults(a)}),this.add(i)),i}add(e){g(this,Ne).has(e.queryHash)||(g(this,Ne).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const s=g(this,Ne).get(e.queryHash);s&&(e.destroy(),s===e&&g(this,Ne).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){se.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return g(this,Ne).get(e)}getAll(){return[...g(this,Ne).values()]}find(e){const s={exact:!0,...e};return this.getAll().find(n=>os(s,n))}findAll(e={}){const s=this.getAll();return Object.keys(e).length>0?s.filter(n=>os(e,n)):s}notify(e){se.batch(()=>{this.listeners.forEach(s=>{s(e)})})}onFocus(){se.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){se.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},Ne=new WeakMap,Hs),Ce,le,Xe,ke,Te,Ws,Sa=(Ws=class extends xn{constructor(e){super();T(this,ke);T(this,Ce);T(this,le);T(this,Xe);this.mutationId=e.mutationId,E(this,le,e.mutationCache),E(this,Ce,[]),this.state=e.state||yn(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){g(this,Ce).includes(e)||(g(this,Ce).push(e),this.clearGcTimeout(),g(this,le).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){E(this,Ce,g(this,Ce).filter(s=>s!==e)),this.scheduleGc(),g(this,le).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){g(this,Ce).length||(this.state.status==="pending"?this.scheduleGc():g(this,le).remove(this))}continue(){var e;return((e=g(this,Xe))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var o,i,c,m,h,_,d,f,v,b,y,p,x,l,u,w,k,O,D,H;const s=()=>{I(this,ke,Te).call(this,{type:"continue"})};E(this,Xe,gn({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(A,N)=>{I(this,ke,Te).call(this,{type:"failed",failureCount:A,error:N})},onPause:()=>{I(this,ke,Te).call(this,{type:"pause"})},onContinue:s,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>g(this,le).canRun(this)}));const n=this.state.status==="pending",a=!g(this,Xe).canStart();try{if(n)s();else{I(this,ke,Te).call(this,{type:"pending",variables:e,isPaused:a}),await((i=(o=g(this,le).config).onMutate)==null?void 0:i.call(o,e,this));const N=await((m=(c=this.options).onMutate)==null?void 0:m.call(c,e));N!==this.state.context&&I(this,ke,Te).call(this,{type:"pending",context:N,variables:e,isPaused:a})}const A=await g(this,Xe).start();return await((_=(h=g(this,le).config).onSuccess)==null?void 0:_.call(h,A,e,this.state.context,this)),await((f=(d=this.options).onSuccess)==null?void 0:f.call(d,A,e,this.state.context)),await((b=(v=g(this,le).config).onSettled)==null?void 0:b.call(v,A,null,this.state.variables,this.state.context,this)),await((p=(y=this.options).onSettled)==null?void 0:p.call(y,A,null,e,this.state.context)),I(this,ke,Te).call(this,{type:"success",data:A}),A}catch(A){try{throw await((l=(x=g(this,le).config).onError)==null?void 0:l.call(x,A,e,this.state.context,this)),await((w=(u=this.options).onError)==null?void 0:w.call(u,A,e,this.state.context)),await((O=(k=g(this,le).config).onSettled)==null?void 0:O.call(k,void 0,A,this.state.variables,this.state.context,this)),await((H=(D=this.options).onSettled)==null?void 0:H.call(D,void 0,A,e,this.state.context)),A}finally{I(this,ke,Te).call(this,{type:"error",error:A})}}finally{g(this,le).runNext(this)}}},Ce=new WeakMap,le=new WeakMap,Xe=new WeakMap,ke=new WeakSet,Te=function(e){const s=n=>{switch(e.type){case"failed":return{...n,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...n,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:e.error,failureCount:n.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=s(this.state),se.batch(()=>{g(this,Ce).forEach(n=>{n.onMutationUpdate(e)}),g(this,le).notify({mutation:this,type:"updated",action:e})})},Ws);function yn(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Ae,ye,Ft,Bs,Ea=(Bs=class extends Nt{constructor(e={}){super();T(this,Ae);T(this,ye);T(this,Ft);this.config=e,E(this,Ae,new Set),E(this,ye,new Map),E(this,Ft,0)}build(e,s,n){const a=new Sa({mutationCache:this,mutationId:++Kt(this,Ft)._,options:e.defaultMutationOptions(s),state:n});return this.add(a),a}add(e){g(this,Ae).add(e);const s=Jt(e);if(typeof s=="string"){const n=g(this,ye).get(s);n?n.push(e):g(this,ye).set(s,[e])}this.notify({type:"added",mutation:e})}remove(e){if(g(this,Ae).delete(e)){const s=Jt(e);if(typeof s=="string"){const n=g(this,ye).get(s);if(n)if(n.length>1){const a=n.indexOf(e);a!==-1&&n.splice(a,1)}else n[0]===e&&g(this,ye).delete(s)}}this.notify({type:"removed",mutation:e})}canRun(e){const s=Jt(e);if(typeof s=="string"){const n=g(this,ye).get(s),a=n==null?void 0:n.find(o=>o.state.status==="pending");return!a||a===e}else return!0}runNext(e){var n;const s=Jt(e);if(typeof s=="string"){const a=(n=g(this,ye).get(s))==null?void 0:n.find(o=>o!==e&&o.state.isPaused);return(a==null?void 0:a.continue())??Promise.resolve()}else return Promise.resolve()}clear(){se.batch(()=>{g(this,Ae).forEach(e=>{this.notify({type:"removed",mutation:e})}),g(this,Ae).clear(),g(this,ye).clear()})}getAll(){return Array.from(g(this,Ae))}find(e){const s={exact:!0,...e};return this.getAll().find(n=>is(s,n))}findAll(e={}){return this.getAll().filter(s=>is(e,s))}notify(e){se.batch(()=>{this.listeners.forEach(s=>{s(e)})})}resumePausedMutations(){const e=this.getAll().filter(s=>s.state.isPaused);return se.batch(()=>Promise.all(e.map(s=>s.continue().catch(de))))}},Ae=new WeakMap,ye=new WeakMap,Ft=new WeakMap,Bs);function Jt(t){var e;return(e=t.options.scope)==null?void 0:e.id}function ds(t){return{onFetch:(e,s)=>{var _,d,f,v,b;const n=e.options,a=(f=(d=(_=e.fetchOptions)==null?void 0:_.meta)==null?void 0:d.fetchMore)==null?void 0:f.direction,o=((v=e.state.data)==null?void 0:v.pages)||[],i=((b=e.state.data)==null?void 0:b.pageParams)||[];let c={pages:[],pageParams:[]},m=0;const h=async()=>{let y=!1;const p=u=>{Object.defineProperty(u,"signal",{enumerable:!0,get:()=>(e.signal.aborted?y=!0:e.signal.addEventListener("abort",()=>{y=!0}),e.signal)})},x=hn(e.options,e.fetchOptions),l=async(u,w,k)=>{if(y)return Promise.reject();if(w==null&&u.pages.length)return Promise.resolve(u);const D=(()=>{const S={client:e.client,queryKey:e.queryKey,pageParam:w,direction:k?"backward":"forward",meta:e.options.meta};return p(S),S})(),H=await x(D),{maxPages:A}=e.options,N=k?xa:ga;return{pages:N(u.pages,H,A),pageParams:N(u.pageParams,w,A)}};if(a&&o.length){const u=a==="backward",w=u?Aa:us,k={pages:o,pageParams:i},O=w(n,k);c=await l(k,O,u)}else{const u=t??o.length;do{const w=m===0?i[0]??n.initialPageParam:us(n,c);if(m>0&&w==null)break;c=await l(c,w),m++}while(m<u)}return c};e.options.persister?e.fetchFn=()=>{var y,p;return(p=(y=e.options).persister)==null?void 0:p.call(y,h,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},s)}:e.fetchFn=h}}}function us(t,{pages:e,pageParams:s}){const n=e.length-1;return e.length>0?t.getNextPageParam(e[n],e,s[n],s):void 0}function Aa(t,{pages:e,pageParams:s}){var n;return e.length>0?(n=t.getPreviousPageParam)==null?void 0:n.call(t,e[0],e,s[0],s):void 0}var te,Pe,Me,ht,mt,je,ft,pt,Qs,Oa=(Qs=class{constructor(t={}){T(this,te);T(this,Pe);T(this,Me);T(this,ht);T(this,mt);T(this,je);T(this,ft);T(this,pt);E(this,te,t.queryCache||new ka),E(this,Pe,t.mutationCache||new Ea),E(this,Me,t.defaultOptions||{}),E(this,ht,new Map),E(this,mt,new Map),E(this,je,0)}mount(){Kt(this,je)._++,g(this,je)===1&&(E(this,ft,Qr.subscribe(async t=>{t&&(await this.resumePausedMutations(),g(this,te).onFocus())})),E(this,pt,sr.subscribe(async t=>{t&&(await this.resumePausedMutations(),g(this,te).onOnline())})))}unmount(){var t,e;Kt(this,je)._--,g(this,je)===0&&((t=g(this,ft))==null||t.call(this),E(this,ft,void 0),(e=g(this,pt))==null||e.call(this),E(this,pt,void 0))}isFetching(t){return g(this,te).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return g(this,Pe).findAll({...t,status:"pending"}).length}getQueryData(t){var s;const e=this.defaultQueryOptions({queryKey:t});return(s=g(this,te).get(e.queryHash))==null?void 0:s.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),s=g(this,te).build(this,e),n=s.state.data;return n===void 0?this.fetchQuery(t):(t.revalidateIfStale&&s.isStaleByTime(We(e.staleTime,s))&&this.prefetchQuery(e),Promise.resolve(n))}getQueriesData(t){return g(this,te).findAll(t).map(({queryKey:e,state:s})=>{const n=s.data;return[e,n]})}setQueryData(t,e,s){const n=this.defaultQueryOptions({queryKey:t}),a=g(this,te).get(n.queryHash),o=a==null?void 0:a.state.data,i=fa(e,o);if(i!==void 0)return g(this,te).build(this,n).setData(i,{...s,manual:!0})}setQueriesData(t,e,s){return se.batch(()=>g(this,te).findAll(t).map(({queryKey:n})=>[n,this.setQueryData(n,e,s)]))}getQueryState(t){var s;const e=this.defaultQueryOptions({queryKey:t});return(s=g(this,te).get(e.queryHash))==null?void 0:s.state}removeQueries(t){const e=g(this,te);se.batch(()=>{e.findAll(t).forEach(s=>{e.remove(s)})})}resetQueries(t,e){const s=g(this,te);return se.batch(()=>(s.findAll(t).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const s={revert:!0,...e},n=se.batch(()=>g(this,te).findAll(t).map(a=>a.cancel(s)));return Promise.all(n).then(de).catch(de)}invalidateQueries(t,e={}){return se.batch(()=>(g(this,te).findAll(t).forEach(s=>{s.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},e)))}refetchQueries(t,e={}){const s={...e,cancelRefetch:e.cancelRefetch??!0},n=se.batch(()=>g(this,te).findAll(t).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let o=a.fetch(void 0,s);return s.throwOnError||(o=o.catch(de)),a.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(n).then(de)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const s=g(this,te).build(this,e);return s.isStaleByTime(We(e.staleTime,s))?s.fetch(e):Promise.resolve(s.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(de).catch(de)}fetchInfiniteQuery(t){return t.behavior=ds(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(de).catch(de)}ensureInfiniteQueryData(t){return t.behavior=ds(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return sr.isOnline()?g(this,Pe).resumePausedMutations():Promise.resolve()}getQueryCache(){return g(this,te)}getMutationCache(){return g(this,Pe)}getDefaultOptions(){return g(this,Me)}setDefaultOptions(t){E(this,Me,t)}setQueryDefaults(t,e){g(this,ht).set(nt(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...g(this,ht).values()],s={};return e.forEach(n=>{Dt(t,n.queryKey)&&Object.assign(s,n.defaultOptions)}),s}setMutationDefaults(t,e){g(this,mt).set(nt(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...g(this,mt).values()],s={};return e.forEach(n=>{Dt(t,n.mutationKey)&&Object.assign(s,n.defaultOptions)}),s}defaultQueryOptions(t){if(t._defaulted)return t;const e={...g(this,Me).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Wr(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Br&&(e.enabled=!1),e}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...g(this,Me).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){g(this,te).clear(),g(this,Pe).clear()}},te=new WeakMap,Pe=new WeakMap,Me=new WeakMap,ht=new WeakMap,mt=new WeakMap,je=new WeakMap,ft=new WeakMap,pt=new WeakMap,Qs),ue,z,It,ce,Ze,gt,Fe,Ie,qt,xt,vt,et,tt,qe,yt,B,Et,kr,Sr,Er,Ar,Or,$r,Rr,bn,Gs,$a=(Gs=class extends Nt{constructor(e,s){super();T(this,B);T(this,ue);T(this,z);T(this,It);T(this,ce);T(this,Ze);T(this,gt);T(this,Fe);T(this,Ie);T(this,qt);T(this,xt);T(this,vt);T(this,et);T(this,tt);T(this,qe);T(this,yt,new Set);this.options=s,E(this,ue,e),E(this,Ie,null),E(this,Fe,Cr()),this.options.experimental_prefetchInRender||g(this,Fe).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(g(this,z).addObserver(this),hs(g(this,z),this.options)?I(this,B,Et).call(this):this.updateResult(),I(this,B,Ar).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Tr(g(this,z),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Tr(g(this,z),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,I(this,B,Or).call(this),I(this,B,$r).call(this),g(this,z).removeObserver(this)}setOptions(e){const s=this.options,n=g(this,z);if(this.options=g(this,ue).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof be(this.options.enabled,g(this,z))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");I(this,B,Rr).call(this),g(this,z).setOptions(this.options),s._defaulted&&!rr(this.options,s)&&g(this,ue).getQueryCache().notify({type:"observerOptionsUpdated",query:g(this,z),observer:this});const a=this.hasListeners();a&&ms(g(this,z),n,this.options,s)&&I(this,B,Et).call(this),this.updateResult(),a&&(g(this,z)!==n||be(this.options.enabled,g(this,z))!==be(s.enabled,g(this,z))||We(this.options.staleTime,g(this,z))!==We(s.staleTime,g(this,z)))&&I(this,B,kr).call(this);const o=I(this,B,Sr).call(this);a&&(g(this,z)!==n||be(this.options.enabled,g(this,z))!==be(s.enabled,g(this,z))||o!==g(this,qe))&&I(this,B,Er).call(this,o)}getOptimisticResult(e){const s=g(this,ue).getQueryCache().build(g(this,ue),e),n=this.createResult(s,e);return Ta(this,n)&&(E(this,ce,n),E(this,gt,this.options),E(this,Ze,g(this,z).state)),n}getCurrentResult(){return g(this,ce)}trackResult(e,s){return new Proxy(e,{get:(n,a)=>(this.trackProp(a),s==null||s(a),Reflect.get(n,a))})}trackProp(e){g(this,yt).add(e)}getCurrentQuery(){return g(this,z)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=g(this,ue).defaultQueryOptions(e),n=g(this,ue).getQueryCache().build(g(this,ue),s);return n.fetch().then(()=>this.createResult(n,s))}fetch(e){return I(this,B,Et).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),g(this,ce)))}createResult(e,s){var A;const n=g(this,z),a=this.options,o=g(this,ce),i=g(this,Ze),c=g(this,gt),h=e!==n?e.state:g(this,It),{state:_}=e;let d={..._},f=!1,v;if(s._optimisticResults){const N=this.hasListeners(),S=!N&&hs(e,s),R=N&&ms(e,n,s,a);(S||R)&&(d={...d,...vn(_.data,e.options)}),s._optimisticResults==="isRestoring"&&(d.fetchStatus="idle")}let{error:b,errorUpdatedAt:y,status:p}=d;v=d.data;let x=!1;if(s.placeholderData!==void 0&&v===void 0&&p==="pending"){let N;o!=null&&o.isPlaceholderData&&s.placeholderData===(c==null?void 0:c.placeholderData)?(N=o.data,x=!0):N=typeof s.placeholderData=="function"?s.placeholderData((A=g(this,vt))==null?void 0:A.state.data,g(this,vt)):s.placeholderData,N!==void 0&&(p="success",v=Nr(o==null?void 0:o.data,N,s),f=!0)}if(s.select&&v!==void 0&&!x)if(o&&v===(i==null?void 0:i.data)&&s.select===g(this,qt))v=g(this,xt);else try{E(this,qt,s.select),v=s.select(v),v=Nr(o==null?void 0:o.data,v,s),E(this,xt,v),E(this,Ie,null)}catch(N){E(this,Ie,N)}g(this,Ie)&&(b=g(this,Ie),v=g(this,xt),y=Date.now(),p="error");const l=d.fetchStatus==="fetching",u=p==="pending",w=p==="error",k=u&&l,O=v!==void 0,H={status:p,fetchStatus:d.fetchStatus,isPending:u,isSuccess:p==="success",isError:w,isInitialLoading:k,isLoading:k,data:v,dataUpdatedAt:d.dataUpdatedAt,error:b,errorUpdatedAt:y,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>h.dataUpdateCount||d.errorUpdateCount>h.errorUpdateCount,isFetching:l,isRefetching:l&&!u,isLoadingError:w&&!O,isPaused:d.fetchStatus==="paused",isPlaceholderData:f,isRefetchError:w&&O,isStale:Gr(e,s),refetch:this.refetch,promise:g(this,Fe)};if(this.options.experimental_prefetchInRender){const N=Z=>{H.status==="error"?Z.reject(H.error):H.data!==void 0&&Z.resolve(H.data)},S=()=>{const Z=E(this,Fe,H.promise=Cr());N(Z)},R=g(this,Fe);switch(R.status){case"pending":e.queryHash===n.queryHash&&N(R);break;case"fulfilled":(H.status==="error"||H.data!==R.value)&&S();break;case"rejected":(H.status!=="error"||H.error!==R.reason)&&S();break}}return H}updateResult(){const e=g(this,ce),s=this.createResult(g(this,z),this.options);if(E(this,Ze,g(this,z).state),E(this,gt,this.options),g(this,Ze).data!==void 0&&E(this,vt,g(this,z)),rr(s,e))return;E(this,ce,s);const n=()=>{if(!e)return!0;const{notifyOnChangeProps:a}=this.options,o=typeof a=="function"?a():a;if(o==="all"||!o&&!g(this,yt).size)return!0;const i=new Set(o??g(this,yt));return this.options.throwOnError&&i.add("error"),Object.keys(g(this,ce)).some(c=>{const m=c;return g(this,ce)[m]!==e[m]&&i.has(m)})};I(this,B,bn).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&I(this,B,Ar).call(this)}},ue=new WeakMap,z=new WeakMap,It=new WeakMap,ce=new WeakMap,Ze=new WeakMap,gt=new WeakMap,Fe=new WeakMap,Ie=new WeakMap,qt=new WeakMap,xt=new WeakMap,vt=new WeakMap,et=new WeakMap,tt=new WeakMap,qe=new WeakMap,yt=new WeakMap,B=new WeakSet,Et=function(e){I(this,B,Rr).call(this);let s=g(this,z).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(de)),s},kr=function(){I(this,B,Or).call(this);const e=We(this.options.staleTime,g(this,z));if(st||g(this,ce).isStale||!_r(e))return;const n=dn(g(this,ce).dataUpdatedAt,e)+1;E(this,et,setTimeout(()=>{g(this,ce).isStale||this.updateResult()},n))},Sr=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(g(this,z)):this.options.refetchInterval)??!1},Er=function(e){I(this,B,$r).call(this),E(this,qe,e),!(st||be(this.options.enabled,g(this,z))===!1||!_r(g(this,qe))||g(this,qe)===0)&&E(this,tt,setInterval(()=>{(this.options.refetchIntervalInBackground||Qr.isFocused())&&I(this,B,Et).call(this)},g(this,qe)))},Ar=function(){I(this,B,kr).call(this),I(this,B,Er).call(this,I(this,B,Sr).call(this))},Or=function(){g(this,et)&&(clearTimeout(g(this,et)),E(this,et,void 0))},$r=function(){g(this,tt)&&(clearInterval(g(this,tt)),E(this,tt,void 0))},Rr=function(){const e=g(this,ue).getQueryCache().build(g(this,ue),this.options);if(e===g(this,z))return;const s=g(this,z);E(this,z,e),E(this,It,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},bn=function(e){se.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(g(this,ce))}),g(this,ue).getQueryCache().notify({query:g(this,z),type:"observerResultsUpdated"})})},Gs);function Ra(t,e){return be(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function hs(t,e){return Ra(t,e)||t.state.data!==void 0&&Tr(t,e,e.refetchOnMount)}function Tr(t,e,s){if(be(e.enabled,t)!==!1&&We(e.staleTime,t)!=="static"){const n=typeof s=="function"?s(t):s;return n==="always"||n!==!1&&Gr(t,e)}return!1}function ms(t,e,s,n){return(t!==e||be(n.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&Gr(t,s)}function Gr(t,e){return be(e.enabled,t)!==!1&&t.isStaleByTime(We(e.staleTime,t))}function Ta(t,e){return!rr(t.getCurrentResult(),e)}var Ue,ze,he,Oe,$e,Xt,Lr,Ks,La=(Ks=class extends Nt{constructor(s,n){super();T(this,$e);T(this,Ue);T(this,ze);T(this,he);T(this,Oe);E(this,Ue,s),this.setOptions(n),this.bindMethods(),I(this,$e,Xt).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){var a;const n=this.options;this.options=g(this,Ue).defaultMutationOptions(s),rr(this.options,n)||g(this,Ue).getMutationCache().notify({type:"observerOptionsUpdated",mutation:g(this,he),observer:this}),n!=null&&n.mutationKey&&this.options.mutationKey&&nt(n.mutationKey)!==nt(this.options.mutationKey)?this.reset():((a=g(this,he))==null?void 0:a.state.status)==="pending"&&g(this,he).setOptions(this.options)}onUnsubscribe(){var s;this.hasListeners()||(s=g(this,he))==null||s.removeObserver(this)}onMutationUpdate(s){I(this,$e,Xt).call(this),I(this,$e,Lr).call(this,s)}getCurrentResult(){return g(this,ze)}reset(){var s;(s=g(this,he))==null||s.removeObserver(this),E(this,he,void 0),I(this,$e,Xt).call(this),I(this,$e,Lr).call(this)}mutate(s,n){var a;return E(this,Oe,n),(a=g(this,he))==null||a.removeObserver(this),E(this,he,g(this,Ue).getMutationCache().build(g(this,Ue),this.options)),g(this,he).addObserver(this),g(this,he).execute(s)}},Ue=new WeakMap,ze=new WeakMap,he=new WeakMap,Oe=new WeakMap,$e=new WeakSet,Xt=function(){var n;const s=((n=g(this,he))==null?void 0:n.state)??yn();E(this,ze,{...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset})},Lr=function(s){se.batch(()=>{var n,a,o,i,c,m,h,_;if(g(this,Oe)&&this.hasListeners()){const d=g(this,ze).variables,f=g(this,ze).context;(s==null?void 0:s.type)==="success"?((a=(n=g(this,Oe)).onSuccess)==null||a.call(n,s.data,d,f),(i=(o=g(this,Oe)).onSettled)==null||i.call(o,s.data,null,d,f)):(s==null?void 0:s.type)==="error"&&((m=(c=g(this,Oe)).onError)==null||m.call(c,s.error,d,f),(_=(h=g(this,Oe)).onSettled)==null||_.call(h,void 0,s.error,d,f))}this.listeners.forEach(d=>{d(g(this,ze))})})},Ks),Be,J,pr,fs,wt=0,_n=[],ee=F,ps=ee.__b,gs=ee.__r,xs=ee.diffed,vs=ee.__c,ys=ee.unmount,bs=ee.__;function Ct(t,e){ee.__h&&ee.__h(J,t,wt||e),wt=0;var s=J.__H||(J.__H={__:[],__h:[]});return t>=s.__.length&&s.__.push({}),s.__[t]}function C(t){return wt=1,Kr(kn,t)}function Kr(t,e,s){var n=Ct(Be++,2);if(n.t=t,!n.__c&&(n.__=[s?s(e):kn(void 0,e),function(c){var m=n.__N?n.__N[0]:n.__[0],h=n.t(m,c);m!==h&&(n.__N=[h,n.__[1]],n.__c.setState({}))}],n.__c=J,!J.__f)){var a=function(c,m,h){if(!n.__c.__H)return!0;var _=n.__c.__H.__.filter(function(f){return!!f.__c});if(_.every(function(f){return!f.__N}))return!o||o.call(this,c,m,h);var d=n.__c.props!==c;return _.forEach(function(f){if(f.__N){var v=f.__[0];f.__=f.__N,f.__N=void 0,v!==f.__[0]&&(d=!0)}}),o&&o.call(this,c,m,h)||d};J.__f=!0;var o=J.shouldComponentUpdate,i=J.componentWillUpdate;J.componentWillUpdate=function(c,m,h){if(this.__e){var _=o;o=void 0,a(c,m,h),o=_}i&&i.call(this,c,m,h)},J.shouldComponentUpdate=a}return n.__N||n.__}function M(t,e){var s=Ct(Be++,3);!ee.__s&&Vr(s.__H,e)&&(s.__=t,s.u=e,J.__H.__h.push(s))}function Wt(t,e){var s=Ct(Be++,4);!ee.__s&&Vr(s.__H,e)&&(s.__=t,s.u=e,J.__h.push(s))}function at(t){return wt=5,lr(function(){return{current:t}},[])}function wn(t,e,s){wt=6,Wt(function(){if(typeof t=="function"){var n=t(e());return function(){t(null),n&&typeof n=="function"&&n()}}if(t)return t.current=e(),function(){return t.current=null}},s==null?s:s.concat(t))}function lr(t,e){var s=Ct(Be++,7);return Vr(s.__H,e)&&(s.__=t(),s.__H=e,s.__h=t),s.__}function Pt(t,e){return wt=8,lr(function(){return t},e)}function kt(t){var e=J.context[t.__c],s=Ct(Be++,9);return s.c=t,e?(s.__==null&&(s.__=!0,e.sub(J)),e.props.value):t.__}function Nn(t,e){ee.useDebugValue&&ee.useDebugValue(e?e(t):t)}function Cn(){var t=Ct(Be++,11);if(!t.__){for(var e=J.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var s=e.__m||(e.__m=[0,0]);t.__="P"+s[0]+"-"+s[1]++}return t.__}function Da(){for(var t;t=_n.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Zt),t.__H.__h.forEach(Dr),t.__H.__h=[]}catch(e){t.__H.__h=[],ee.__e(e,t.__v)}}ee.__b=function(t){J=null,ps&&ps(t)},ee.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),bs&&bs(t,e)},ee.__r=function(t){gs&&gs(t),Be=0;var e=(J=t.__c).__H;e&&(pr===J?(e.__h=[],J.__h=[],e.__.forEach(function(s){s.__N&&(s.__=s.__N),s.u=s.__N=void 0})):(e.__h.forEach(Zt),e.__h.forEach(Dr),e.__h=[],Be=0)),pr=J},ee.diffed=function(t){xs&&xs(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(_n.push(e)!==1&&fs===ee.requestAnimationFrame||((fs=ee.requestAnimationFrame)||Pa)(Da)),e.__H.__.forEach(function(s){s.u&&(s.__H=s.u),s.u=void 0})),pr=J=null},ee.__c=function(t,e){e.some(function(s){try{s.__h.forEach(Zt),s.__h=s.__h.filter(function(n){return!n.__||Dr(n)})}catch(n){e.some(function(a){a.__h&&(a.__h=[])}),e=[],ee.__e(n,s.__v)}}),vs&&vs(t,e)},ee.unmount=function(t){ys&&ys(t);var e,s=t.__c;s&&s.__H&&(s.__H.__.forEach(function(n){try{Zt(n)}catch(a){e=a}}),s.__H=void 0,e&&ee.__e(e,s.__v))};var _s=typeof requestAnimationFrame=="function";function Pa(t){var e,s=function(){clearTimeout(n),_s&&cancelAnimationFrame(e),setTimeout(t)},n=setTimeout(s,35);_s&&(e=requestAnimationFrame(s))}function Zt(t){var e=J,s=t.__c;typeof s=="function"&&(t.__c=void 0,s()),J=e}function Dr(t){var e=J;t.__c=t.__(),J=e}function Vr(t,e){return!t||t.length!==e.length||e.some(function(s,n){return s!==t[n]})}function kn(t,e){return typeof e=="function"?e(t):e}function Sn(t,e){for(var s in e)t[s]=e[s];return t}function Pr(t,e){for(var s in t)if(s!=="__source"&&!(s in e))return!0;for(var n in e)if(n!=="__source"&&t[n]!==e[n])return!0;return!1}function cr(t,e){var s=e(),n=C({t:{__:s,u:e}}),a=n[0].t,o=n[1];return Wt(function(){a.__=s,a.u=e,gr(a)&&o({t:a})},[t,s,e]),M(function(){return gr(a)&&o({t:a}),t(function(){gr(a)&&o({t:a})})},[t]),s}function gr(t){var e,s,n=t.u,a=t.__;try{var o=n();return!((e=a)===(s=o)&&(e!==0||1/e==1/s)||e!=e&&s!=s)}catch{return!0}}function En(t){t()}function An(t){return t}function On(){return[!1,En]}var $n=Wt;function Mr(t,e){this.props=t,this.context=e}function Ma(t,e){function s(a){var o=this.props.ref,i=o==a.ref;return!i&&o&&(o.call?o(null):o.current=null),e?!e(this.props,a)||!i:Pr(this.props,a)}function n(a){return this.shouldComponentUpdate=s,xe(t,a)}return n.displayName="Memo("+(t.displayName||t.name)+")",n.prototype.isReactComponent=!0,n.__f=!0,n}(Mr.prototype=new pe).isPureReactComponent=!0,Mr.prototype.shouldComponentUpdate=function(t,e){return Pr(this.props,t)||Pr(this.state,e)};var ws=F.__b;F.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),ws&&ws(t)};var ja=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Fa(t){function e(s){var n=Sn({},s);return delete n.ref,t(n,s.ref||null)}return e.$$typeof=ja,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var Ns=function(t,e){return t==null?null:_e(_e(t).map(e))},Ia={map:Ns,forEach:Ns,count:function(t){return t?_e(t).length:0},only:function(t){var e=_e(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:_e},qa=F.__e;F.__e=function(t,e,s,n){if(t.then){for(var a,o=e;o=o.__;)if((a=o.__c)&&a.__c)return e.__e==null&&(e.__e=s.__e,e.__k=s.__k),a.__c(t,e)}qa(t,e,s,n)};var Cs=F.unmount;function Rn(t,e,s){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),t.__c.__H=null),(t=Sn({},t)).__c!=null&&(t.__c.__P===s&&(t.__c.__P=e),t.__c.__e=!0,t.__c=null),t.__k=t.__k&&t.__k.map(function(n){return Rn(n,e,s)})),t}function Tn(t,e,s){return t&&s&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(n){return Tn(n,e,s)}),t.__c&&t.__c.__P===e&&(t.__e&&s.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=s)),t}function er(){this.__u=0,this.o=null,this.__b=null}function Ln(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function Ua(t){var e,s,n;function a(o){if(e||(e=t()).then(function(i){s=i.default||i},function(i){n=i}),n)throw n;if(!s)throw e;return xe(s,o)}return a.displayName="Lazy",a.__f=!0,a}function At(){this.i=null,this.l=null}F.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),Cs&&Cs(t)},(er.prototype=new pe).__c=function(t,e){var s=e.__c,n=this;n.o==null&&(n.o=[]),n.o.push(s);var a=Ln(n.__v),o=!1,i=function(){o||(o=!0,s.__R=null,a?a(c):c())};s.__R=i;var c=function(){if(!--n.__u){if(n.state.__a){var m=n.state.__a;n.__v.__k[0]=Tn(m,m.__c.__P,m.__c.__O)}var h;for(n.setState({__a:n.__b=null});h=n.o.pop();)h.forceUpdate()}};n.__u++||32&e.__u||n.setState({__a:n.__b=n.__v.__k[0]}),t.then(i,i)},er.prototype.componentWillUnmount=function(){this.o=[]},er.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var s=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=Rn(this.__b,s,n.__O=n.__P)}this.__b=null}var a=e.__a&&xe(X,null,t.fallback);return a&&(a.__u&=-33),[xe(X,null,e.__a?null:t.children),a]};var ks=function(t,e,s){if(++s[1]===s[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(s=t.i;s;){for(;s.length>3;)s.pop()();if(s[1]<s[0])break;t.i=s=s[2]}};function za(t){return this.getChildContext=function(){return t.context},t.children}function Ha(t){var e=this,s=t.h;if(e.componentWillUnmount=function(){_t(null,e.v),e.v=null,e.h=null},e.h&&e.h!==s&&e.componentWillUnmount(),!e.v){for(var n=e.__v;n!==null&&!n.__m&&n.__!==null;)n=n.__;e.h=s,e.v={nodeType:1,parentNode:s,childNodes:[],__k:{__m:n.__m},contains:function(){return!0},insertBefore:function(a,o){this.childNodes.push(a),e.h.insertBefore(a,o)},removeChild:function(a){this.childNodes.splice(this.childNodes.indexOf(a)>>>1,1),e.h.removeChild(a)}}}_t(xe(za,{context:e.context},t.__v),e.v)}function Wa(t,e){var s=xe(Ha,{__v:t,h:e});return s.containerInfo=e,s}(At.prototype=new pe).__a=function(t){var e=this,s=Ln(e.__v),n=e.l.get(t);return n[0]++,function(a){var o=function(){e.props.revealOrder?(n.push(a),ks(e,t,n)):a()};s?s(o):o()}},At.prototype.render=function(t){this.i=null,this.l=new Map;var e=_e(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var s=e.length;s--;)this.l.set(e[s],this.i=[1,0,this.i]);return t.children},At.prototype.componentDidUpdate=At.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,s){ks(t,s,e)})};var Dn=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Ba=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Qa=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Ga=/[A-Z0-9]/g,Ka=typeof document<"u",Va=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function Ja(t,e,s){return e.__k==null&&(e.textContent=""),_t(t,e),typeof s=="function"&&s(),t?t.__c:null}function Ya(t,e,s){return ln(t,e),typeof s=="function"&&s(),t?t.__c:null}pe.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(pe.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var Ss=F.event;function Xa(){}function Za(){return this.cancelBubble}function eo(){return this.defaultPrevented}F.event=function(t){return Ss&&(t=Ss(t)),t.persist=Xa,t.isPropagationStopped=Za,t.isDefaultPrevented=eo,t.nativeEvent=t};var Jr,to={enumerable:!1,configurable:!0,get:function(){return this.class}},Es=F.vnode;F.vnode=function(t){typeof t.type=="string"&&function(e){var s=e.props,n=e.type,a={},o=n.indexOf("-")===-1;for(var i in s){var c=s[i];if(!(i==="value"&&"defaultValue"in s&&c==null||Ka&&i==="children"&&n==="noscript"||i==="class"||i==="className")){var m=i.toLowerCase();i==="defaultValue"&&"value"in s&&s.value==null?i="value":i==="download"&&c===!0?c="":m==="translate"&&c==="no"?c=!1:m[0]==="o"&&m[1]==="n"?m==="ondoubleclick"?i="ondblclick":m!=="onchange"||n!=="input"&&n!=="textarea"||Va(s.type)?m==="onfocus"?i="onfocusin":m==="onblur"?i="onfocusout":Qa.test(i)&&(i=m):m=i="oninput":o&&Ba.test(i)?i=i.replace(Ga,"-$&").toLowerCase():c===null&&(c=void 0),m==="oninput"&&a[i=m]&&(i="oninputCapture"),a[i]=c}}n=="select"&&a.multiple&&Array.isArray(a.value)&&(a.value=_e(s.children).forEach(function(h){h.props.selected=a.value.indexOf(h.props.value)!=-1})),n=="select"&&a.defaultValue!=null&&(a.value=_e(s.children).forEach(function(h){h.props.selected=a.multiple?a.defaultValue.indexOf(h.props.value)!=-1:a.defaultValue==h.props.value})),s.class&&!s.className?(a.class=s.class,Object.defineProperty(a,"className",to)):(s.className&&!s.class||s.class&&s.className)&&(a.class=a.className=s.className),e.props=a}(t),t.$$typeof=Dn,Es&&Es(t)};var As=F.__r;F.__r=function(t){As&&As(t),Jr=t.__c};var Os=F.diffed;F.diffed=function(t){Os&&Os(t);var e=t.props,s=t.__e;s!=null&&t.type==="textarea"&&"value"in e&&e.value!==s.value&&(s.value=e.value==null?"":e.value),Jr=null};var ro={ReactCurrentDispatcher:{current:{readContext:function(t){return Jr.__n[t.__c].props.value},useCallback:Pt,useContext:kt,useDebugValue:Nn,useDeferredValue:An,useEffect:M,useId:Cn,useImperativeHandle:wn,useInsertionEffect:$n,useLayoutEffect:Wt,useMemo:lr,useReducer:Kr,useRef:at,useState:C,useSyncExternalStore:cr,useTransition:On}}};function so(t){return xe.bind(null,t)}function dr(t){return!!t&&t.$$typeof===Dn}function no(t){return dr(t)&&t.type===X}function ao(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function oo(t){return dr(t)?cn.apply(null,arguments):t}function io(t){return!!t.__k&&(_t(null,t),!0)}function lo(t){return t&&(t.base||t.nodeType===1&&t)||null}var co=function(t,e){return t(e)},uo=function(t,e){return t(e)},ho=X,mo=dr,$s={useState:C,useId:Cn,useReducer:Kr,useEffect:M,useLayoutEffect:Wt,useInsertionEffect:$n,useTransition:On,useDeferredValue:An,useSyncExternalStore:cr,startTransition:En,useRef:at,useImperativeHandle:wn,useMemo:lr,useCallback:Pt,useContext:kt,useDebugValue:Nn,version:"18.3.1",Children:Ia,render:Ja,hydrate:Ya,unmountComponentAtNode:io,createPortal:Wa,createElement:xe,createContext:Ht,createFactory:so,cloneElement:oo,createRef:la,Fragment:X,isValidElement:dr,isElement:mo,isFragment:no,isMemo:ao,findDOMNode:lo,Component:pe,PureComponent:Mr,memo:Ma,forwardRef:Fa,flushSync:uo,unstable_batchedUpdates:co,StrictMode:ho,Suspense:er,SuspenseList:At,lazy:Ua,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ro},Pn=Ht(void 0),Mn=t=>{const e=kt(Pn);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},fo=({client:t,children:e})=>(M(()=>(t.mount(),()=>{t.unmount()}),[t]),r(Pn.Provider,{value:t,children:e})),jn=Ht(!1),po=()=>kt(jn);jn.Provider;function go(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var xo=Ht(go()),vo=()=>kt(xo),yo=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},bo=t=>{M(()=>{t.clearReset()},[t])},_o=({result:t,errorResetBoundary:e,throwOnError:s,query:n,suspense:a})=>t.isError&&!e.isReset()&&!t.isFetching&&n&&(a&&t.data===void 0||mn(s,[t.error,n])),wo=t=>{if(t.suspense){const e=n=>n==="static"?n:Math.max(n??1e3,1e3),s=t.staleTime;t.staleTime=typeof s=="function"?(...n)=>e(s(...n)):e(s),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},No=(t,e)=>t.isLoading&&t.isFetching&&!e,Co=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,Rs=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function ko(t,e,s){var d,f,v,b,y;const n=po(),a=vo(),o=Mn(),i=o.defaultQueryOptions(t);(f=(d=o.getDefaultOptions().queries)==null?void 0:d._experimental_beforeQuery)==null||f.call(d,i),i._optimisticResults=n?"isRestoring":"optimistic",wo(i),yo(i,a),bo(a);const c=!o.getQueryCache().get(i.queryHash),[m]=C(()=>new e(o,i)),h=m.getOptimisticResult(i),_=!n&&t.subscribed!==!1;if(cr(Pt(p=>{const x=_?m.subscribe(se.batchCalls(p)):de;return m.updateResult(),x},[m,_]),()=>m.getCurrentResult()),M(()=>{m.setOptions(i)},[i,m]),Co(i,h))throw Rs(i,m,a);if(_o({result:h,errorResetBoundary:a,throwOnError:i.throwOnError,query:o.getQueryCache().get(i.queryHash),suspense:i.suspense}))throw h.error;if((b=(v=o.getDefaultOptions().queries)==null?void 0:v._experimental_afterQuery)==null||b.call(v,i,h),i.experimental_prefetchInRender&&!st&&No(h,n)){const p=c?Rs(i,m,a):(y=o.getQueryCache().get(i.queryHash))==null?void 0:y.promise;p==null||p.catch(de).finally(()=>{m.updateResult()})}return i.notifyOnChangeProps?h:m.trackResult(h)}function So(t,e){return ko(t,$a)}function Fn(t,e){const s=Mn(),[n]=C(()=>new La(s,t));M(()=>{n.setOptions(t)},[n,t]);const a=cr(Pt(i=>n.subscribe(se.batchCalls(i)),[n]),()=>n.getCurrentResult()),o=Pt((i,c)=>{n.mutate(i,c).catch(de)},[n]);if(a.error&&mn(n.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:o,mutateAsync:a.mutate}}var Eo={};function Ot(t,e){for(var s in e)t[s]=e[s];return t}function nr(t,e,s){var n,a=/(?:\?([^#]*))?(#.*)?$/,o=t.match(a),i={};if(o&&o[1])for(var c=o[1].split("&"),m=0;m<c.length;m++){var h=c[m].split("=");i[decodeURIComponent(h[0])]=decodeURIComponent(h.slice(1).join("="))}t=jr(t.replace(a,"")),e=jr(e||"");for(var _=Math.max(t.length,e.length),d=0;d<_;d++)if(e[d]&&e[d].charAt(0)===":"){var f=e[d].replace(/(^:|[+*?]+$)/g,""),v=(e[d].match(/[+*?]+$/)||Eo)[0]||"",b=~v.indexOf("+"),y=~v.indexOf("*"),p=t[d]||"";if(!p&&!y&&(v.indexOf("?")<0||b)){n=!1;break}if(i[f]=decodeURIComponent(p),b||y){i[f]=t.slice(d).map(decodeURIComponent).join("/");break}}else if(e[d]!==t[d]){n=!1;break}return(s.default===!0||n!==!1)&&i}function Ao(t,e){return t.rank<e.rank?1:t.rank>e.rank?-1:t.index-e.index}function Oo(t,e){return t.index=e,t.rank=function(s){return s.props.default?0:jr(s.props.path).map($o).join("")}(t),t.props}function jr(t){return t.replace(/(^\/+|\/+$)/g,"").split("/")}function $o(t){return t.charAt(0)==":"?1+"*+?".indexOf(t.charAt(t.length-1))||4:5}var Ro={},rt=[],Rt=[],me=null,Yr={url:ur()},In=Ht(Yr);function qn(){var t=kt(In);if(t===Yr){var e=C()[1];M(function(){return Rt.push(e),function(){return Rt.splice(Rt.indexOf(e),1)}},[])}return[t,ie]}function ur(){var t;return""+((t=me&&me.location?me.location:me&&me.getCurrentLocation?me.getCurrentLocation():typeof location<"u"?location:Ro).pathname||"")+(t.search||"")}function ie(t,e){return e===void 0&&(e=!1),typeof t!="string"&&t.url&&(e=t.replace,t=t.url),function(s){for(var n=rt.length;n--;)if(rt[n].canRoute(s))return!0;return!1}(t)&&function(s,n){n===void 0&&(n="push"),me&&me[n]?me[n](s):typeof history<"u"&&history[n+"State"]&&history[n+"State"](null,null,s)}(t,e?"replace":"push"),Un(t)}function Un(t){for(var e=!1,s=0;s<rt.length;s++)rt[s].routeTo(t)&&(e=!0);return e}function To(t){if(t&&t.getAttribute){var e=t.getAttribute("href"),s=t.getAttribute("target");if(e&&e.match(/^\//g)&&(!s||s.match(/^_?self$/i)))return ie(e)}}function Lo(t){return t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),!1}function zn(t){if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button)){var e=t.target;do if(e.localName==="a"&&e.getAttribute("href")){if(e.hasAttribute("data-native")||e.hasAttribute("native"))return;if(To(e))return Lo(t)}while(e=e.parentNode)}}var Ts=!1;function ar(t){t.history&&(me=t.history),this.state={url:t.url||ur()}}Ot(ar.prototype=new pe,{shouldComponentUpdate:function(t){return t.static!==!0||t.url!==this.props.url||t.onChange!==this.props.onChange},canRoute:function(t){var e=_e(this.props.children);return this.g(e,t)!==void 0},routeTo:function(t){this.setState({url:t});var e=this.canRoute(t);return this.p||this.forceUpdate(),e},componentWillMount:function(){this.p=!0},componentDidMount:function(){var t=this;Ts||(Ts=!0,me||addEventListener("popstate",function(){Un(ur())}),addEventListener("click",zn)),rt.push(this),me&&(this.u=me.listen(function(e){var s=e.location||e;t.routeTo(""+(s.pathname||"")+(s.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),rt.splice(rt.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(t,e){t=t.filter(Oo).sort(Ao);for(var s=0;s<t.length;s++){var n=t[s],a=nr(e,n.props.path,n.props);if(a)return[n,a]}},render:function(t,e){var s,n,a=t.onChange,o=e.url,i=this.c,c=this.g(_e(t.children),o);if(c&&(n=cn(c[0],Ot(Ot({url:o,matches:s=c[1]},s),{key:void 0,ref:void 0}))),o!==(i&&i.url)){Ot(Yr,i=this.c={url:o,previous:i&&i.url,current:n,path:n?n.props.path:null,matches:s}),i.router=this,i.active=n?[n]:[];for(var m=Rt.length;m--;)Rt[m]({});typeof a=="function"&&a(i)}return xe(In.Provider,{value:i},n)}});var Hn=function(t){return xe("a",Ot({onClick:zn},t))};const Do=Object.freeze(Object.defineProperty({__proto__:null,Link:Hn,Router:ar,default:ar,exec:nr,getCurrentUrl:ur,route:ie,useRouter:qn},Symbol.toStringTag,{value:"Module"}));var Po=["className","activeClass","activeClassName","path"];function ge(t){var e=t.className,s=t.activeClass,n=t.activeClassName,a=t.path,o=function(_,d){if(_==null)return{};var f,v,b={},y=Object.keys(_);for(v=0;v<y.length;v++)d.indexOf(f=y[v])>=0||(b[f]=_[f]);return b}(t,Po),i=qn()[0],c=a&&i.path&&nr(i.path,a,{})||nr(i.url,o.href,{}),m=o.class||e||"",h=c&&(s||n)||"";return o.class=m+(m&&h&&" ")+h,xe(Hn,o)}const Mo="modulepreload",jo=function(t){return"/"+t},Ls={},or=function(e,s,n){let a=Promise.resolve();if(s&&s.length>0){let i=function(h){return Promise.all(h.map(_=>Promise.resolve(_).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),m=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));a=i(s.map(h=>{if(h=jo(h),h in Ls)return;Ls[h]=!0;const _=h.endsWith(".css"),d=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${d}`))return;const f=document.createElement("link");if(f.rel=_?"stylesheet":Mo,_||(f.as="script"),f.crossOrigin="",f.href=h,m&&f.setAttribute("nonce",m),document.head.appendChild(f),_)return new Promise((v,b)=>{f.addEventListener("load",v),f.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return a.then(i=>{for(const c of i||[])c.status==="rejected"&&o(c.reason);return e().catch(o)})},Ds=t=>{let e;const s=new Set,n=(h,_)=>{const d=typeof h=="function"?h(e):h;if(!Object.is(d,e)){const f=e;e=_??(typeof d!="object"||d===null)?d:Object.assign({},e,d),s.forEach(v=>v(e,f))}},a=()=>e,c={setState:n,getState:a,getInitialState:()=>m,subscribe:h=>(s.add(h),()=>s.delete(h))},m=e=t(n,a,c);return c},Fo=t=>t?Ds(t):Ds,Io=t=>t;function qo(t,e=Io){const s=$s.useSyncExternalStore(t.subscribe,()=>e(t.getState()),()=>e(t.getInitialState()));return $s.useDebugValue(s),s}const Ps=t=>{const e=Fo(t),s=n=>qo(e,n);return Object.assign(s,e),s},Bt=t=>t?Ps(t):Ps,Uo="00000000-0000-0000-0000-000000000000";function zo(t,e){let s;try{s=t()}catch{return}return{getItem:a=>{var o;const i=m=>m===null?null:JSON.parse(m,void 0),c=(o=s.getItem(a))!=null?o:null;return c instanceof Promise?c.then(i):i(c)},setItem:(a,o)=>s.setItem(a,JSON.stringify(o,void 0)),removeItem:a=>s.removeItem(a)}}const Fr=t=>e=>{try{const s=t(e);return s instanceof Promise?s:{then(n){return Fr(n)(s)},catch(n){return this}}}catch(s){return{then(n){return this},catch(n){return Fr(n)(s)}}}},Ho=(t,e)=>(s,n,a)=>{let o={storage:zo(()=>localStorage),partialize:y=>y,version:0,merge:(y,p)=>({...p,...y}),...e},i=!1;const c=new Set,m=new Set;let h=o.storage;if(!h)return t((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),s(...y)},n,a);const _=()=>{const y=o.partialize({...n()});return h.setItem(o.name,{state:y,version:o.version})},d=a.setState;a.setState=(y,p)=>{d(y,p),_()};const f=t((...y)=>{s(...y),_()},n,a);a.getInitialState=()=>f;let v;const b=()=>{var y,p;if(!h)return;i=!1,c.forEach(l=>{var u;return l((u=n())!=null?u:f)});const x=((p=o.onRehydrateStorage)==null?void 0:p.call(o,(y=n())!=null?y:f))||void 0;return Fr(h.getItem.bind(h))(o.name).then(l=>{if(l)if(typeof l.version=="number"&&l.version!==o.version){if(o.migrate){const u=o.migrate(l.state,l.version);return u instanceof Promise?u.then(w=>[!0,w]):[!0,u]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,l.state];return[!1,void 0]}).then(l=>{var u;const[w,k]=l;if(v=o.merge(k,(u=n())!=null?u:f),s(v,!0),w)return _()}).then(()=>{x==null||x(v,void 0),v=n(),i=!0,m.forEach(l=>l(v))}).catch(l=>{x==null||x(void 0,l)})};return a.persist={setOptions:y=>{o={...o,...y},y.storage&&(h=y.storage)},clearStorage:()=>{h==null||h.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>b(),hasHydrated:()=>i,onHydrate:y=>(c.add(y),()=>{c.delete(y)}),onFinishHydration:y=>(m.add(y),()=>{m.delete(y)})},o.skipHydration||b(),v||f},Wn=Ho,He=Bt(Wn(t=>({token:typeof window<"u"?localStorage.getItem("access_token"):null,login:(e,s=null)=>{localStorage.setItem("access_token",e),s&&localStorage.setItem("refresh_token",s),t({token:e})},logout:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),t({token:null})}}),{name:"auth-store"}));function hr(){const t=He(a=>a.token),e=He(a=>a.login),s=He(a=>a.logout);return{token:t,login:e,logout:s,subscribeToLogout:a=>He.subscribe(i=>{i.token===null&&a()})}}function V(){return localStorage.getItem("access_token")}function Wo(){He.getState().logout()}const ne=[];for(let t=0;t<256;++t)ne.push((t+256).toString(16).slice(1));function Bo(t,e=0){return(ne[t[e+0]]+ne[t[e+1]]+ne[t[e+2]]+ne[t[e+3]]+"-"+ne[t[e+4]]+ne[t[e+5]]+"-"+ne[t[e+6]]+ne[t[e+7]]+"-"+ne[t[e+8]]+ne[t[e+9]]+"-"+ne[t[e+10]]+ne[t[e+11]]+ne[t[e+12]]+ne[t[e+13]]+ne[t[e+14]]+ne[t[e+15]]).toLowerCase()}let xr;const Qo=new Uint8Array(16);function Go(){if(!xr){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");xr=crypto.getRandomValues.bind(crypto)}return xr(Qo)}const Ko=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ms={randomUUID:Ko};function Vo(t,e,s){var a;if(Ms.randomUUID&&!t)return Ms.randomUUID();t=t||{};const n=t.random??((a=t.rng)==null?void 0:a.call(t))??Go();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Bo(n)}const ir=Bt(t=>({notifications:[],add:({type:e,message:s})=>{const n=Vo();return t(a=>({notifications:[...a.notifications,{id:n,type:e,message:s}]})),n},remove:e=>t(s=>({notifications:s.notifications.filter(n=>n.id!==e)})),clear:()=>t({notifications:[]})})),Tt=new Map,Jo=3e4;function Yo(t,e){const s=e.method||"GET",n=e.body?JSON.stringify(e.body):"",a=JSON.stringify(e.headers||{});return`${s}:${t}:${n}:${a}`}function Xo(){const t=Date.now();for(const[e,s]of Tt.entries())t-s.timestamp>Jo&&(Tt.delete(e),console.log(`🧹 Cleaned up expired request: ${e.substring(0,50)}...`))}async function W(t,e={}){Xo();const s=Yo(t,e),n=Tt.get(s);if(n)return console.log(`🔄 Deduplicating request: ${e.method||"GET"} ${t}`),n.promise;const a=V();t.includes("/api/chats")&&(console.log("🌐 Making request to",t,"method:",e.method||"GET","with token:",!!a),e.method==="DELETE"&&console.log("🗑️ DELETE request details:",{url:t,hasToken:!!a,tokenPreview:a?`${a.substring(0,10)}...`:"none"}));const o={"Content-Type":"application/json",...e.headers};a&&(o.Authorization=`Bearer ${a}`);const i=(async()=>{try{return console.log(`📤 Making request: ${e.method||"GET"} ${t}`),await fetch(t,{...e,headers:o,body:e.body?JSON.stringify(e.body):void 0})}finally{Tt.delete(s)}})();Tt.set(s,{promise:i,timestamp:Date.now()});const c=await i;if(c.status===401){const h=await c.text();if(h.includes("token")||h.includes("expire")||h.includes("invalid"))try{const{refreshAccessToken:_}=await or(async()=>{const{refreshAccessToken:f}=await Promise.resolve().then(()=>Hi);return{refreshAccessToken:f}},void 0);if(await _()){const f=localStorage.getItem("access_token"),v={...e,headers:{...o,Authorization:`Bearer ${f}`}};return console.log("Token refreshed, retrying request..."),W(t,v)}else throw new Error("Refresh failed")}catch{throw Wo(),ir.getState().add({type:"error",message:"Sesión expirada, por favor vuelve a iniciar sesión."}),ie("/",!0),{detail:[{msg:"Sesión expirada"}]}}else throw{detail:[{msg:"Error de autorización temporal"}]}}let m=null;try{m=await c.json()}catch{m=null}if(!c.ok)throw m&&typeof m=="object"?m:{detail:[{msg:c.statusText}]};return m}const Zo=Object.freeze(Object.defineProperty({__proto__:null,fetcher:W},Symbol.toStringTag,{value:"Module"})),we=Bt((t,e)=>({chats:[],activeChatId:null,messages:{},isLoading:!1,error:null,workflowStates:{},_lastLoadChatsCall:0,_loadChatsThrottle:2e3,setActiveChatId:s=>t({activeChatId:s}),setLoading:s=>t({isLoading:s}),setError:s=>t({error:s}),clearError:()=>t({error:null}),createChat:async(s="")=>{t({isLoading:!0,error:null});try{console.log("Creating chat with title:",s);const n=await W("/api/chats/",{method:"POST",body:{title:s||"Nuevo chat"}});console.log("Chat created successfully:",n);const a={...n,title:n.title||"Nuevo chat"};return t(o=>({chats:[...o.chats,a],activeChatId:a.session_id,messages:{...o.messages,[a.session_id]:[]},isLoading:!1})),a}catch(n){throw console.error("Error creating chat session:",n),t({error:n.message||"Error creando chat",isLoading:!1}),new Error("Failed to create chat session: "+n.message)}},addChat:async(s="")=>{const n=await e().createChat(s);return n==null?void 0:n.session_id},clearMessagesForNewChat:()=>{console.log("🧹 CLEARING: Messages cleared for new chat initialization"),t(s=>({activeChatId:null,messages:{},error:null}))},executeWorkflowDirect:async(s,n)=>{t({isLoading:!0,error:null});try{console.log("🚀 Executing workflow DIRECT for chat:",s),console.log("🎯 Using execution_plan directly:",(n==null?void 0:n.length)||0,"steps");const a=await W("/api/chat/workflow-decision",{method:"POST",body:{decision:"execute",chat_id:s,session_id:s,execution_plan:n||[]}});console.log("✅ Workflow executed successfully:",a);const o={id:`success-${Date.now()}`,role:"assistant",content:a.message||"✅ Workflow ejecutado exitosamente",timestamp:new Date().toISOString(),isTemp:!1};return t(i=>({messages:{...i.messages,[s]:[...i.messages[s]||[],o]},isLoading:!1})),a}catch(a){throw console.error("❌ Error executing workflow:",a),t({error:a.message||"Error ejecutando workflow",isLoading:!1}),a}},saveWorkflowDirect:async(s,n)=>{t({isLoading:!0,error:null});try{console.log("💾 Saving workflow DIRECT for chat:",s),console.log("🎯 Using execution_plan directly:",(n==null?void 0:n.length)||0,"steps");const a=await W("/api/chat/workflow-decision",{method:"POST",body:{decision:"save",chat_id:s,session_id:s,execution_plan:n||[]}});console.log("✅ Workflow saved successfully:",a);const o={id:`saved-${Date.now()}`,role:"assistant",content:a.message||"💾 Workflow guardado exitosamente",timestamp:new Date().toISOString(),isTemp:!1};return t(i=>({messages:{...i.messages,[s]:[...i.messages[s]||[],o]},isLoading:!1})),a}catch(a){throw console.error("❌ Error saving workflow:",a),t({error:a.message||"Error guardando workflow",isLoading:!1}),a}},activateWorkflowDirect:async(s,n)=>{t({isLoading:!0,error:null});try{console.log("🔄 Activating workflow DIRECT for chat:",s),console.log("🎯 Using execution_plan directly:",(n==null?void 0:n.length)||0,"steps");const a=await W("/api/chat/workflow-decision",{method:"POST",body:{decision:"activate",chat_id:s,session_id:s,execution_plan:n||[]}});console.log("✅ Workflow activated successfully:",a);const o={id:`activated-${Date.now()}`,role:"assistant",content:a.message||"🔄 Workflow activado exitosamente",timestamp:new Date().toISOString(),isTemp:!1};return t(i=>({messages:{...i.messages,[s]:[...i.messages[s]||[],o]},isLoading:!1})),a}catch(a){throw console.error("❌ Error activating workflow:",a),t({error:a.message||"Error activando workflow",isLoading:!1}),a}},sendMessage:async(s,n,a)=>{var i,c,m,h,_,d;const o={id:`temp-${Date.now()}`,role:n,content:a,timestamp:new Date().toISOString(),isTemp:!0};t(f=>({messages:{...f.messages,[s]:[...f.messages[s]||[],o]},isLoading:!0,error:null}));try{const v=e().messages[s]||[];console.log("🚀 Enviando mensaje al backend:",{chatId:s,content:a,messagesCount:v.length});const{default:b}=await or(async()=>{const{default:x}=await Promise.resolve().then(()=>yi);return{default:x}},void 0),y=b.getState().mode,p=await W("/api/chat",{method:"POST",body:{session_id:s,message:a,conversation:v.filter(x=>!x.isTemp).map(x=>({role:x.role,content:x.content})),workflow_type:y==="ai"?"agent":"classic"}});if(console.log("✅ Respuesta del backend:",p),t(x=>{const l=[...x.messages[s].filter(u=>u.id!==o.id),{id:`user-${Date.now()}`,role:"user",content:a,timestamp:new Date().toISOString()}];return p&&p.reply&&l.push({id:`assistant-${Date.now()}`,role:"assistant",content:p.reply,timestamp:new Date().toISOString(),metadata:{session_id:p.session_id,status:p.status,workflow_action:p.workflow_action,oauth_requirements:p.oauth_requirements,service_suggestions:p.service_suggestions,smart_forms_required:p.smart_forms_required,smart_form:p.smart_form,execution_plan:p.execution_plan||[]}}),{messages:{...x.messages,[s]:l},isLoading:!1}}),p.enhanced_workflow){console.log("🔍 CHATSTORE: Enhanced workflow detected, loading context from WorkflowContextService");try{const x=await e()._extractWorkflowContext([],s);x.steps&&x.steps.length>0&&(console.log(`🎯 CHATSTORE: Loaded ${x.steps.length} steps from WorkflowContextService`),t(l=>{const u=[...l.messages[s]||[]],w=u[u.length-1];return w&&w.metadata&&(w.metadata.steps=x.steps,w.metadata.workflow_context_loaded=!0),{messages:{...l.messages,[s]:u}}}))}catch(x){console.error("🔥 Error loading workflow context:",x)}}else p.hasOwnProperty("enhanced_workflow")&&console.log("🔍 CHATSTORE: No enhanced_workflow detected - backend indicates no workflow changes");if(console.log("🔍 CHATSTORE: Checking for smart forms...",{smart_forms_required:p.smart_forms_required,has_smart_form:!!p.smart_form,smart_form_title:(i=p.smart_form)==null?void 0:i.title,smart_form_fields:((m=(c=p.smart_form)==null?void 0:c.fields)==null?void 0:m.length)||0}),p.smart_forms_required&&p.smart_form?(console.log("🎉 CHATSTORE: Smart form detected! Setting up context:",{title:p.smart_form.title,fields:((h=p.smart_form.fields)==null?void 0:h.length)||0,sections:((_=p.smart_form.sections)==null?void 0:_.length)||0}),window.smartFormContext={formSchema:p.smart_form,isSmartForm:!0,backendData:p},console.log("🚀 CHATSTORE: Dispatching smartFormReady event"),window.dispatchEvent(new CustomEvent("smartFormReady",{detail:{chatId:s,smartForm:p.smart_form,backendData:p}}))):console.log("⚠️ CHATSTORE: No smart forms detected - requirements:",p.smart_forms_required,"form:",!!p.smart_form),console.log("🔍 CHATSTORE: Checking for OAuth requirements...",{oauth_requirements:p.oauth_requirements,oauth_count:((d=p.oauth_requirements)==null?void 0:d.length)||0,status:p.status}),p.oauth_requirements&&p.oauth_requirements.length>0?(console.log("🔐 CHATSTORE: OAuth requirements detected! Triggering credentials modal:",{count:p.oauth_requirements.length,requirements:p.oauth_requirements}),console.log("🚀 CHATSTORE: Dispatching oauthRequirementsDetected event"),window.dispatchEvent(new CustomEvent("oauthRequirementsDetected",{detail:{chatId:s,oauthRequirements:p.oauth_requirements,backendData:p}}))):console.log("⚠️ CHATSTORE: No OAuth requirements detected"),p&&p.execution_plan&&p.execution_plan.length>0)try{const x={execution_plan:p.execution_plan,workflow_created:!0,timestamp:Date.now(),metadata:{session_id:p.session_id,status:p.status}};localStorage.setItem(`workflow_${s}`,JSON.stringify(x)),console.log("🔄 TRIGGER: Auto-cached execution_plan para chat:",s,"- steps:",p.execution_plan.length)}catch(x){console.error("🔄 TRIGGER: Error caching execution_plan:",x)}return p}catch(f){return console.error("Error sending message:",f),t(v=>({messages:{...v.messages,[s]:v.messages[s].filter(b=>b.id!==o.id)},error:f.message||"Error enviando mensaje",isLoading:!1})),null}},loadChats:async()=>{const s=Date.now(),n=e();if(s-n._lastLoadChatsCall<n._loadChatsThrottle)return console.log("🔄 THROTTLED: loadChats called too soon, skipping..."),n.chats;t({_lastLoadChatsCall:s});try{console.log("🔄 Fetching chats from server...");const a=new AbortController,o=setTimeout(()=>a.abort(),1e4),i=await W("/api/chats/",{method:"GET",signal:a.signal});clearTimeout(o),console.log("✅ Fetched chats from server:",(i==null?void 0:i.length)||0,"chats");const c=e();let m=null;return i&&i.length>0&&c.activeChatId&&i.some(h=>h.session_id===c.activeChatId)&&(m=c.activeChatId),t({chats:i||[],activeChatId:m,messages:c.messages}),i}catch(a){throw console.error("❌ Error fetching chat sessions:",a),(a==null?void 0:a.status)===401&&t({chats:[],activeChatId:null,messages:{}}),a}},fetchSessions:async()=>await e().loadChats(),loadMessages:async s=>{try{const n=e().messages[s];if(n&&n.length>0)return console.log("📋 Messages already loaded for chat:",s,"- count:",n.length),n;console.log("🔄 Fetching messages for chat:",s);const a=new AbortController,o=setTimeout(()=>a.abort(),3e4),i=await W(`/api/chats/${s}/messages`,{method:"GET",signal:a.signal});return clearTimeout(o),console.log("✅ Fetched messages for chat:",s,"- total:",(i==null?void 0:i.length)||0),t(c=>{const m=c.messages[s]||[],h=i||[],_=m.filter(f=>f.isTemp===!0),d=[...h,..._.filter(f=>!h.some(v=>Math.abs(new Date(v.timestamp)-new Date(f.timestamp))<5e3))].sort((f,v)=>new Date(f.timestamp)-new Date(v.timestamp));return console.log("🔄 MERGE: Server messages:",h.length,"Optimistic:",_.length,"Final:",d.length),{messages:{...c.messages,[s]:d}}}),i}catch(n){console.error("❌ Error fetching messages for",s,n);const a=e().messages[s];throw!a||a.length===0?(console.log("📝 Setting empty array for chat:",s,"(no existing messages)"),t(o=>({messages:{...o.messages,[s]:[]}}))):console.log("💾 Preserving existing messages for chat:",s,"- count:",a.length),n}},fetchMessages:async s=>await e().loadMessages(s),updateChat:async(s,n)=>{try{t(o=>({chats:o.chats.map(i=>i.session_id===s?{...i,...n}:i)}));const a=await W(`/api/chats/${s}`,{method:"PATCH",body:n});return console.log("✅ Chat updated successfully:",s,n),a}catch(a){throw console.error("❌ Error updating chat:",a),e().loadChats(),t({error:a.message||"Error actualizando chat"}),a}},deleteChat:async s=>{try{const n=e();if(!n.chats.some(c=>c.session_id===s)){console.log("Chat already removed from UI:",s);return}const o=n.activeChatId===s;if(t(c=>({chats:c.chats.filter(m=>m.session_id!==s),messages:Object.fromEntries(Object.entries(c.messages).filter(([m])=>m!==s)),activeChatId:c.activeChatId===s?null:c.activeChatId})),o){console.log("🔄 Active chat deleted, redirecting to temporal chat /chat/...");const{route:c}=await or(async()=>{const{route:m}=await Promise.resolve().then(()=>Do);return{route:m}},void 0);c("/chat",!0)}console.log(`🗑️ Attempting to delete chat ${s} from server...`);const i=await W(`/api/chats/${s}`,{method:"DELETE"});return console.log("✅ Chat deleted successfully from server:",s),setTimeout(()=>{e().loadChats().catch(console.error)},100),i}catch(n){throw console.error("❌ Error deleting chat session from server:",n),e().loadChats(),t({error:n.message||"Error eliminando chat"}),n}},setWorkflowState:(s,n)=>t(a=>({workflowStates:{...a.workflowStates,[s]:n}})),getWorkflowState:s=>e().workflowStates[s]||null,clearWorkflowState:s=>t(n=>{const a={...n.workflowStates};return delete a[s],{workflowStates:a}}),clearStore:()=>t({chats:[],activeChatId:null,messages:{},workflowStates:{},isLoading:!1,error:null})}));function ei(){const t=we(l=>l.chats)||[];we(l=>l.addChat);const[e,s]=C(!1),[n,a]=C(""),[o,i]=C({show:!1,x:0,y:0,chatId:null}),[c,m]=C(null),[h,_]=C(""),d=at(null),f=async()=>{if(!e){console.log("🔧 SidebarFixed handleNewChat called"),s(!0);try{const l=await fetch("/api/chats/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify({title:"Nuevo chat"})});if(!l.ok)throw new Error("Failed to create chat");const u=await l.json();we.setState(w=>({chats:[u,...w.chats],activeChatId:u.session_id,chatHistories:{...w.chatHistories,[u.session_id]:[]}})),ie(`/chat/${u.session_id}`,!0)}catch(l){console.error("Error creando nuevo chat:",l),ie("/chat",!0)}finally{s(!1)}}},v=(l,u)=>{l.preventDefault(),l.stopPropagation(),i({show:!0,x:l.clientX,y:l.clientY,chatId:u})},b=async l=>{var u,w,k,O;if(l){if(!confirm("¿Estás seguro de que quieres eliminar esta conversación?")){i({show:!1,x:0,y:0,chatId:null});return}i({show:!1,x:0,y:0,chatId:null});try{const D=we.getState().deleteChat;await D(l),console.log("Chat deleted successfully")}catch(D){if(console.error("Error deleting chat:",D),console.log("Full error object:",D),(D==null?void 0:D.status)===404||(w=(u=D==null?void 0:D.detail)==null?void 0:u.includes)!=null&&w.call(u,"no encontrada")||(O=(k=D==null?void 0:D.message)==null?void 0:k.includes)!=null&&O.call(k,"not found")){const A=we.getState().deleteChat;A(l),console.log("Chat was already deleted, cleaned up UI")}else(D==null?void 0:D.status)>=500?console.log("Server error, but chat might be deleted"):console.log("Possible error, but chat might be deleted successfully");const H=we.getState().deleteChat;H(l)}}},y=async l=>{if(c===l){if(!h.trim()){p();return}try{const u=we.getState().updateChat;await u(l,{title:h.trim()}),m(null),_(""),console.log("Chat title updated successfully")}catch(u){console.error("Error updating chat title:",u),alert("Error actualizando el título. Por favor intenta de nuevo.")}}},p=()=>{m(null),_("")};M(()=>{if(t.length===0){const l=we.getState().loadChats;console.log("📋 SIDEBAR: No chats found, loading from server..."),l().catch(u=>{console.error("❌ Error loading chats in sidebar:",u)})}else console.log("📋 SIDEBAR: Already have",t.length,"chats loaded")},[]),M(()=>{const l=u=>{d.current&&!d.current.contains(u.target)&&i({show:!1,x:0,y:0,chatId:null})};if(o.show)return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[o.show]);const x=n?t.filter(l=>{var u;return(u=l.title)==null?void 0:u.toLowerCase().includes(n.toLowerCase())}):t;return r("div",{className:"w-80 glass border-r border-primary text-white flex flex-col h-full backdrop-blur-sm",children:[r("div",{className:"p-6 border-b border-primary",children:[r("div",{className:"mb-6"}),r("button",{onClick:f,disabled:e,className:"w-full btn-primary hover:btn-primary text-white px-6 py-3 rounded-2xl font-medium transition-all duration-200 disabled:opacity-50 shadow-lg shadow-elegant hover:shadow-elegant hover:scale-[1.02] disabled:hover:scale-100",children:e?r("div",{className:"flex items-center justify-center gap-2",children:[r("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Creando..."]}):r("div",{className:"flex items-center justify-center gap-2",children:[r("span",{className:"text-lg",children:"✨"}),"Nuevo Chat"]})})]}),r("div",{className:"p-6 pb-4",children:r("div",{className:"relative",children:[r("input",{type:"text",placeholder:"Buscar conversaciones...",value:n,onChange:l=>a(l.target.value),className:"w-full surface-input backdrop-blur-sm border border-accent rounded-2xl px-4 py-3 pl-10 text-sm text-white placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-white focus:border-accent transition-all duration-200"}),r("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-subtle",children:"🔍"})]})}),r("div",{className:"flex-1 overflow-y-auto px-4 pb-4",children:r("div",{className:"space-y-2",children:[x.map(l=>r("div",{className:"relative group",onContextMenu:u=>v(u,l.session_id),children:c===l.session_id?r("div",{className:"p-4 rounded-2xl surface-elevated border border-accent transition-all duration-200 backdrop-blur-sm",children:r("div",{className:"flex items-center gap-3",children:[r("div",{className:"w-8 h-8 surface-elevated rounded-xl flex items-center justify-center text-xs flex-shrink-0",children:"✏️"}),r("input",{type:"text",value:h,onChange:u=>_(u.target.value),onKeyDown:u=>{u.key==="Enter"&&(u.preventDefault(),y(l.session_id)),u.key==="Escape"&&(u.preventDefault(),p())},onBlur:u=>{const w=u.relatedTarget;(!w||!w.closest(".edit-buttons"))&&setTimeout(()=>y(l.session_id),150)},className:"flex-1 bg-transparent text-sm font-medium text-white border-none outline-none placeholder-text-muted",placeholder:"Título de la conversación",autoFocus:!0}),r("div",{className:"flex items-center gap-2 ml-2 edit-buttons",children:[r("button",{onClick:u=>{u.preventDefault(),u.stopPropagation(),y(l.session_id)},className:"w-8 h-8 flex items-center justify-center text-green-400 hover:text-green-300 hover:bg-green-400/10 rounded-lg transition-all duration-200",title:"Guardar (Enter)",children:r("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),r("button",{onClick:u=>{u.preventDefault(),u.stopPropagation(),p()},className:"w-8 h-8 flex items-center justify-center text-red-400 hover:text-red-300 hover:bg-red-400/10 rounded-lg transition-all duration-200",title:"Cancelar (Esc)",children:r("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})}):r("div",{className:"relative group",children:r(ge,{href:`/chat/${l.session_id}`,className:"block",children:r("div",{className:"p-4 rounded-2xl surface-elevated hover:surface-card border border-primary hover:border-accent transition-all duration-200 backdrop-blur-sm hover:shadow-lg hover:shadow-elegant hover:scale-[1.02]",children:r("div",{className:"flex items-center gap-3",children:[r("div",{className:"w-8 h-8 surface-elevated rounded-xl flex items-center justify-center text-xs flex-shrink-0 group-hover:surface-elevated transition-all duration-200",children:"💬"}),r("div",{className:"flex-1 min-w-0",children:[r("div",{className:"text-sm font-medium text-white truncate hover:text-accent transition-colors duration-200",children:l.title||"Chat sin título"}),r("div",{className:"text-xs text-subtle mt-1",children:["Hace ",Math.floor(Math.random()*24)," horas"]})]}),r("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:r("button",{onClick:u=>{u.preventDefault(),u.stopPropagation(),i({show:!0,x:u.clientX,y:u.clientY,chatId:l.session_id})},className:"w-8 h-8 flex items-center justify-center rounded-lg hover:surface-elevated transition-colors",children:r("svg",{className:"w-4 h-4 text-subtle",fill:"currentColor",viewBox:"0 0 20 20",children:r("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})})})]})})})})},l.session_id)),x.length===0&&r("div",{className:"text-center py-12",children:[r("div",{className:"w-16 h-16 surface-input rounded-3xl flex items-center justify-center mx-auto mb-4",children:r("span",{className:"text-2xl",children:"💭"})}),r("div",{className:"text-subtle font-medium mb-2",children:"No hay conversaciones"}),r("div",{className:"text-xs text-muted",children:"Inicia un nuevo chat para comenzar"})]})]})}),o.show&&r("div",{ref:d,className:"fixed z-50 glass backdrop-blur-sm border border-accent rounded-xl shadow-xl py-2 min-w-[160px]",style:{left:`${o.x}px`,top:`${o.y}px`},children:[r("button",{onClick:()=>{const l=t.find(u=>u.session_id===o.chatId);l&&(m(l.session_id),_(l.title||""),i({show:!1,x:0,y:0,chatId:null}))},className:"w-full px-4 py-3 text-left text-sm text-white hover:surface-card transition-all duration-150 flex items-center gap-3",children:[r("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Renombrar"]}),r("div",{className:"border-t border-primary my-1"}),r("button",{onClick:()=>{i({show:!1,x:0,y:0,chatId:null}),b(o.chatId)},className:"w-full px-4 py-3 text-left text-sm text-red-400 hover:bg-red-500/10 hover:text-red-300 transition-all duration-150 flex items-center gap-3",children:[r("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Eliminar"]})]})]})}function ti({onClose:t}){const{login:e}=hr(),[s,n]=C(!1),[a,o]=C({username:"",password:""}),[i,c]=C({email:"",username:"",password:""}),[m,h]=C(""),[_,d]=C(""),[f,v]=C(""),[b,y]=C(!1),p=at(null),x=at(null);return M(()=>{o({username:"",password:""}),c({email:"",username:"",password:""}),h(""),d(""),sessionStorage.getItem("sessionExpired")&&(v("Tu sesión expiró. Por favor, inicia sesión de nuevo."),sessionStorage.removeItem("sessionExpired")),setTimeout(()=>{var O;(O=p.current)==null||O.focus()},100);const k=O=>{O.key==="Escape"&&t()};return document.addEventListener("keydown",k),()=>document.removeEventListener("keydown",k)},[t]),r("div",{className:"fixed inset-0 bg-gradient-main/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:k=>{k.target===k.currentTarget&&t()},children:r("div",{ref:x,className:"relative glass-card p-8 w-full max-w-md animate-fadeInUp shadow-elegant-lg border border-accent",onClick:k=>k.stopPropagation(),children:[r("button",{onClick:t,className:"absolute top-4 right-4 w-8 h-8 surface-elevated rounded-xl flex items-center justify-center text-text-secondary hover:text-text-primary transition-colors focus-elegant",children:"✕"}),r("div",{className:"text-center mb-8",children:[r("div",{className:"w-16 h-16 surface-elevated rounded-3xl flex items-center justify-center text-3xl mx-auto mb-4 shadow-elegant",children:"🔑"}),r("h2",{className:"text-2xl font-bold gradient-text-elegant mb-2",children:s?"Crear Cuenta":"Iniciar Sesión"}),r("p",{className:"text-subtle text-sm",children:s?"Crea tu cuenta para acceder a todas las funciones":"Accede a tu cuenta para gestionar tus automatizaciones"})]}),f&&r("div",{className:"mb-6 p-3 surface-elevated rounded-xl border-l-4 border-yellow-400",children:r("p",{className:"text-yellow-300 text-sm",children:f})}),s?r(si,{data:i,setData:c,error:_,onSubmit:async()=>{d(""),y(!0);try{const k=await W("/api/auth/register",{method:"POST",body:i});e(k.access_token),t(),setTimeout(()=>{window.location.href="/"},300)}catch(k){d(k.message||"Error en el registro")}finally{y(!1)}},isLoading:b,onToggle:()=>{d(""),h(""),n(!1),setTimeout(()=>{var k;return(k=p.current)==null?void 0:k.focus()},100)}}):r(ri,{data:a,setData:o,error:m,onSubmit:async()=>{h(""),y(!0);try{const k=await W("/api/auth/login",{method:"POST",body:a});e(k.access_token,k.refresh_token),t(),setTimeout(()=>{window.location.href="/"},300)}catch(k){h(k.message||"Error al iniciar sesión")}finally{y(!1)}},isLoading:b,onToggle:()=>{d(""),h(""),n(!0)},inputRef:p})]})})}function ri({data:t,setData:e,error:s,onSubmit:n,onToggle:a,inputRef:o,isLoading:i}){const c=m=>{m.key==="Enter"&&!i&&n()};return r(X,{children:[s&&r("div",{className:"mb-4 p-3 surface-elevated rounded-xl border-l-4 border-red-400",children:r("p",{className:"text-red-300 text-sm",children:s})}),r("div",{className:"space-y-4 mb-6",children:[r("div",{children:[r("label",{className:"block text-sm font-medium text-subtle mb-2",children:"Usuario"}),r("input",{ref:o,type:"text",placeholder:"Ingresa tu usuario",value:t.username,onInput:m=>e({...t,username:m.currentTarget.value}),onKeyDown:c,disabled:i,className:"w-full surface-input rounded-xl px-4 py-3 focus-elegant bg-transparent text-elegant placeholder-text-muted transition-all disabled:opacity-50"})]}),r("div",{children:[r("label",{className:"block text-sm font-medium text-subtle mb-2",children:"Contraseña"}),r("input",{type:"password",placeholder:"Ingresa tu contraseña",value:t.password,onInput:m=>e({...t,password:m.currentTarget.value}),onKeyDown:c,disabled:i,className:"w-full surface-input rounded-xl px-4 py-3 focus-elegant bg-transparent text-elegant placeholder-text-muted transition-all disabled:opacity-50"})]})]}),r("button",{onClick:n,disabled:i||!t.username.trim()||!t.password.trim(),className:"w-full btn-primary py-3 rounded-xl font-semibold text-white mb-4 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:i?r(X,{children:[r("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Iniciando sesión..."]}):"Iniciar Sesión"}),r("p",{className:"text-center text-sm text-subtle",children:["¿No tienes cuenta?"," ",r("button",{onClick:a,disabled:i,className:"text-accent hover:text-accent-hover underline font-medium transition-colors disabled:opacity-50",children:"Crear cuenta"})]})]})}function si({data:t,setData:e,error:s,onSubmit:n,onToggle:a,isLoading:o}){const i=m=>{m.key==="Enter"&&!o&&n()},c=t.email.trim()&&t.username.trim()&&t.password.trim();return r(X,{children:[s&&r("div",{className:"mb-4 p-3 surface-elevated rounded-xl border-l-4 border-red-400",children:r("p",{className:"text-red-300 text-sm",children:s})}),r("div",{className:"space-y-4 mb-6",children:[r("div",{children:[r("label",{className:"block text-sm font-medium text-subtle mb-2",children:"Email"}),r("input",{type:"email",placeholder:"tu@email.com",value:t.email,onInput:m=>e({...t,email:m.currentTarget.value}),onKeyDown:i,disabled:o,className:"w-full surface-input rounded-xl px-4 py-3 focus-elegant bg-transparent text-elegant placeholder-text-muted transition-all disabled:opacity-50"})]}),r("div",{children:[r("label",{className:"block text-sm font-medium text-subtle mb-2",children:"Usuario"}),r("input",{type:"text",placeholder:"Elige un nombre de usuario",value:t.username,onInput:m=>e({...t,username:m.currentTarget.value}),onKeyDown:i,disabled:o,className:"w-full surface-input rounded-xl px-4 py-3 focus-elegant bg-transparent text-elegant placeholder-text-muted transition-all disabled:opacity-50"})]}),r("div",{children:[r("label",{className:"block text-sm font-medium text-subtle mb-2",children:"Contraseña"}),r("input",{type:"password",placeholder:"Crea una contraseña segura",value:t.password,onInput:m=>e({...t,password:m.currentTarget.value}),onKeyDown:i,disabled:o,className:"w-full surface-input rounded-xl px-4 py-3 focus-elegant bg-transparent text-elegant placeholder-text-muted transition-all disabled:opacity-50"})]})]}),r("button",{onClick:n,disabled:o||!c,className:"w-full btn-primary py-3 rounded-xl font-semibold text-white mb-4 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:o?r(X,{children:[r("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Creando cuenta..."]}):"Crear Cuenta"}),r("p",{className:"text-center text-sm text-text-secondary",children:["¿Ya tienes cuenta?"," ",r("button",{onClick:a,disabled:o,className:"text-accent hover:text-accent-hover underline font-medium transition-colors disabled:opacity-50",children:"Iniciar sesión"})]})]})}const Bn=()=>{const[t,e]=C([]),[s,n]=C(!1),[a,o]=C(null),i=async()=>{try{n(!0),o(null);const v=V(),b=await fetch("/api/oauth-apps/",{headers:{Authorization:`Bearer ${v}`}});if(!b.ok)throw new Error(`Error ${b.status}: ${await b.text()}`);const y=await b.json();e(y.oauth_apps||[])}catch(v){console.error("Error fetching OAuth apps:",v),o(v.message),e([])}finally{n(!1)}},c=async(v,{client_id:b,client_secret:y,app_name:p})=>{try{n(!0),o(null);const x=V(),l=await fetch(`/api/oauth-apps/${v}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify({provider:v,client_id:b,client_secret:y,app_name:p})});if(!l.ok){const w=await l.text();throw new Error(`Error ${l.status}: ${w}`)}const u=await l.json();return e(w=>[...w.filter(O=>O.provider!==v),u]),u}catch(x){throw console.error("Error creating OAuth app:",x),o(x.message),x}finally{n(!1)}},m=async(v,b)=>{try{n(!0),o(null);const y=V(),p=await fetch(`/api/oauth-apps/${v}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`},body:JSON.stringify(b)});if(!p.ok){const l=await p.text();throw new Error(`Error ${p.status}: ${l}`)}const x=await p.json();return e(l=>l.map(u=>u.provider===v?x:u)),x}catch(y){throw console.error("Error updating OAuth app:",y),o(y.message),y}finally{n(!1)}},h=async v=>{try{n(!0),o(null);const b=V(),y=await fetch(`/api/oauth-apps/${v}`,{method:"DELETE",headers:{Authorization:`Bearer ${b}`}});if(!y.ok){const p=await y.text();throw new Error(`Error ${y.status}: ${p}`)}return e(p=>p.filter(x=>x.provider!==v)),await y.json()}catch(b){throw console.error("Error deleting OAuth app:",b),o(b.message),b}finally{n(!1)}},_=async v=>{try{const b=V(),y=await fetch(`/api/oauth-apps/${v}`,{headers:{Authorization:`Bearer ${b}`}});if(y.status===404)return null;if(!y.ok){const p=await y.text();throw new Error(`Error ${y.status}: ${p}`)}return await y.json()}catch(b){throw console.error("Error getting OAuth app:",b),b}},d=v=>t.some(b=>b.provider===v),f=v=>t.find(b=>b.provider===v);return M(()=>{i()},[]),{oauthApps:t,loading:s,error:a,fetchOAuthApps:i,createOAuthApp:c,updateOAuthApp:m,deleteOAuthApp:h,getOAuthApp:_,hasOAuthApp:d,getLocalOAuthApp:f}},Qn=({isOpen:t,onClose:e,onSuccess:s,serviceId:n,chatId:a})=>{var H,A;const[o,i]=C("loading"),[c,m]=C(null),[h,_]=C({}),[d,f]=C(null),[v,b]=C(!1),[y,p]=C({client_id:"",client_secret:"",app_name:""}),{createOAuthApp:x,hasOAuthApp:l}=Bn();M(()=>{t&&n&&u()},[t,n]);const u=async()=>{try{i("loading"),f(null);const S=await W(`/api/v1/auth-service-discovery/service/${n}/auth-step?chat_id=${a||"temp-chat"}`,{method:"POST"});if(!S){i("success"),setTimeout(()=>{s({message:"Already authenticated",shouldResendMessage:!0}),e()},1500);return}if(m(S),S.mechanism==="oauth2"){i("oauth_config");return}else i("form")}catch(N){f(N.message),i("error")}},w=async N=>{N.preventDefault();try{i("processing");const S={service_id:n,provider:(c.mechanism==="oauth2",n),mechanism:c.mechanism,config:h,chat_id:a||"temp-chat"},Z=await W("/api/credentials/",{method:"POST",body:S});i("success"),setTimeout(()=>{s(Z),e()},1500)}catch(S){f(S.message),i("error")}},k=(N,S)=>{_(R=>({...R,[N]:S}))},O=async N=>{try{if(N){if(!y.client_id||!y.client_secret){f("Client ID y Client Secret son requeridos");return}const S=c.provider||n;l(S)||await x(S,{client_id:y.client_id,client_secret:y.client_secret,app_name:y.app_name||`${n} OAuth App`})}D()}catch(S){f(S.message)}},D=()=>{e(),setTimeout(()=>{const N=localStorage.getItem("access_token"),S=`/api/oauth/initiate?service_id=${n}&chat_id=${a||"temp-chat"}&token=${N}`,R=window.open(S,"oauth_popup","width=500,height=600,scrollbars=yes,resizable=yes,menubar=no,toolbar=no,location=yes,status=no");if(!R||R.closed||typeof R.closed>"u"){alert("Popup bloqueado por el navegador. Por favor permite ventanas emergentes y reintenta.");return}let Z;const j=Q=>{var K,re;if(![window.location.origin,"http://localhost:5000"].includes(Q.origin)){console.warn("OAuth message from unknown origin:",Q.origin);return}if(((K=Q.data)==null?void 0:K.type)==="OAUTH_SUCCESS"){console.log("OAuth success message received:",Q.data),window.removeEventListener("message",j),Z&&clearInterval(Z);try{R.close()}catch{}s({message:"OAuth successful"})}else if(((re=Q.data)==null?void 0:re.type)==="OAUTH_ERROR"){console.error("OAuth error message received:",Q.data),window.removeEventListener("message",j),Z&&clearInterval(Z);try{R.close()}catch{}alert("Error durante la autenticación OAuth: "+(Q.data.error||"Error desconocido"))}};window.addEventListener("message",j),Z=setInterval(()=>{try{R.closed&&(clearInterval(Z),window.removeEventListener("message",j),console.log("OAuth popup closed without success message"))}catch{}},1e3)},5e3)};return t?r("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50",children:r("div",{className:"glass-card p-8 w-[500px] max-w-[90vw] max-h-[90vh] overflow-y-auto",children:[r("div",{className:"flex justify-between items-center mb-6",children:[r("h2",{className:"text-xl font-semibold text-elegant gradient-text",children:["Autenticar ",(c==null?void 0:c.service_name)||n]}),r("button",{onClick:e,className:"text-subtle hover:text-white transition-colors p-2 hover:bg-white hover:bg-opacity-10 rounded-lg",children:"×"})]}),o==="loading"&&r("div",{className:"text-center py-12",children:r("div",{className:"text-subtle",children:"Cargando configuración..."})}),o==="oauth_waiting"&&r("div",{className:"text-center py-12",children:[r("div",{className:"text-elegant mb-2",children:"Abriendo ventana de autenticación..."}),r("div",{className:"text-xs text-muted mt-2",children:["Se está abriendo una ventana para autenticar con ",(c==null?void 0:c.service_name)||n]}),r("div",{className:"flex justify-center mt-6",children:r("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white border-opacity-30"})})]}),o==="oauth_config"&&c&&r("div",{className:"space-y-6",children:[r("div",{className:"text-center mb-6",children:[r("h3",{className:"text-lg font-medium text-elegant gradient-text",children:"Configurar OAuth"}),r("p",{className:"text-sm text-subtle mt-2",children:"Puedes usar tus propias credenciales OAuth o las por defecto del sistema"})]}),v?r("div",{className:"space-y-5",children:[r("div",{children:[r("label",{className:"block text-sm font-medium text-elegant mb-2",children:"Nombre de la App (Opcional)"}),r("input",{type:"text",className:"w-full px-4 py-3 surface-input text-white placeholder-gray-400 rounded-lg focus-elegant transition-all",placeholder:"Mi App de Gmail",value:y.app_name,onChange:N=>p({...y,app_name:N.target.value})})]}),r("div",{children:[r("label",{className:"block text-sm font-medium text-elegant mb-2",children:"Client ID *"}),r("input",{type:"text",className:"w-full px-4 py-3 surface-input text-white placeholder-gray-400 rounded-lg focus-elegant transition-all",placeholder:"123456789-abcdef.apps.googleusercontent.com",value:y.client_id,onChange:N=>p({...y,client_id:N.target.value}),required:!0})]}),r("div",{children:[r("label",{className:"block text-sm font-medium text-elegant mb-2",children:"Client Secret *"}),r("input",{type:"password",className:"w-full px-4 py-3 surface-input text-white placeholder-gray-400 rounded-lg focus-elegant transition-all",placeholder:"GOCSPX-1234567890abcdef",value:y.client_secret,onChange:N=>p({...y,client_secret:N.target.value}),required:!0})]}),r("div",{className:"surface-elevated rounded-xl p-4 mb-4",children:[r("p",{className:"text-elegant text-sm font-medium mb-3",children:["📋 ",r("strong",{children:"Importante:"})," Configura esta Redirect URI en tu OAuth App:"]}),r("div",{className:"flex items-center gap-3",children:[r("code",{className:"flex-1 text-white bg-black bg-opacity-40 px-3 py-2 rounded-lg text-xs font-mono break-all border border-white border-opacity-20",children:"http://localhost:5000/api/oauth/callback"}),r("button",{type:"button",onClick:()=>{navigator.clipboard.writeText("http://localhost:5000/api/oauth/callback");const N=event.target,S=N.textContent;N.textContent="✅",setTimeout(()=>N.textContent=S,1e3)},className:"btn-glass px-3 py-2 text-white hover:text-white rounded-lg transition-all",title:"Copiar al clipboard",children:"📋"})]}),r("p",{className:"text-subtle text-xs mt-3",children:"💡 Los scopes se configuran automáticamente según el tipo de credencial"})]}),r("div",{className:"flex space-x-3",children:[r("button",{type:"button",onClick:()=>b(!1),className:"flex-1 btn-secondary px-4 py-3 rounded-lg transition-all",children:"Cancelar"}),r("button",{type:"button",onClick:()=>O(!0),className:"flex-1 btn-primary px-4 py-3 rounded-lg transition-all",children:"Usar mis credenciales"})]})]}):r("div",{className:"space-y-4",children:[r("button",{type:"button",onClick:()=>b(!0),className:"w-full px-6 py-4 border-2 border-dashed border-white border-opacity-30 text-elegant rounded-xl hover:border-opacity-50 hover:bg-white hover:bg-opacity-5 transition-all",children:"🔧 Configurar mis credenciales OAuth"}),r("button",{type:"button",onClick:()=>O(!1),className:"w-full btn-primary px-6 py-4 rounded-xl",children:"Usar credenciales por defecto"})]}),d&&r("div",{className:"surface-elevated border border-red-400 border-opacity-30 rounded-lg p-3 mt-4",children:r("div",{className:"text-red-300 text-sm",children:d})})]}),o==="oauth_popup"&&r("div",{className:"text-center py-8",children:[r("div",{className:"text-gray-500",children:"Ventana OAuth abierta..."}),r("div",{className:"text-xs text-gray-400 mt-2",children:["Completa la autenticación en la ventana emergente.",r("br",{}),"Si no se abrió, verifica que tu navegador permita ventanas emergentes."]})]}),o==="checking"&&r("div",{className:"text-center py-8",children:r("div",{className:"text-gray-500",children:"Verificando autenticación..."})}),o==="redirecting"&&r("div",{className:"text-center py-8",children:[r("div",{className:"text-gray-500",children:["Redirigiendo a ",c==null?void 0:c.service_name,"..."]}),r("div",{className:"text-xs text-gray-400 mt-2",children:["Si no fuiste redirigido automáticamente,",r("a",{href:c==null?void 0:c.auth_url,className:"text-blue-500 underline ml-1",children:"haz clic aquí"})]})]}),o==="form"&&c&&r("form",{onSubmit:w,className:"space-y-4",children:[((A=(H=c.metadata)==null?void 0:H.fields)==null?void 0:A.map((N,S)=>{var R,Z,j,Q,G;return r("div",{children:[r("label",{className:"block text-sm font-medium text-elegant mb-2",children:N.label||((R=N.name)==null?void 0:R.charAt(0).toUpperCase())+((Z=N.name)==null?void 0:Z.slice(1).replace("_"," "))}),r("input",{type:N.type||((j=N.name)!=null&&j.includes("password")||(Q=N.name)!=null&&Q.includes("key")||(G=N.name)!=null&&G.includes("token")?"password":"text"),className:"w-full px-4 py-3 surface-input text-white placeholder-gray-400 rounded-lg focus-elegant transition-all",placeholder:N.placeholder||`Ingresa tu ${N.name}...`,value:h[N.name]||"",onChange:K=>k(N.name,K.target.value),required:N.required!==!1}),N.help_text&&r("p",{className:"text-xs text-gray-500 mt-1",children:N.help_text})]},S)}))||c.mechanism==="api_key"&&r("div",{children:[r("label",{className:"block text-sm font-medium text-elegant mb-2",children:"API Key"}),r("input",{type:"password",className:"w-full px-4 py-3 surface-input text-white placeholder-gray-400 rounded-lg focus-elegant transition-all",placeholder:"Ingresa tu API Key...",value:h.api_key||"",onChange:N=>k("api_key",N.target.value),required:!0})]})||c.mechanism==="bot_token"&&r("div",{children:[r("label",{className:"block text-sm font-medium text-elegant mb-2",children:"Bot Token"}),r("input",{type:"password",className:"w-full px-4 py-3 surface-input text-white placeholder-gray-400 rounded-lg focus-elegant transition-all",placeholder:"Ingresa tu Bot Token...",value:h.bot_token||"",onChange:N=>k("bot_token",N.target.value),required:!0})]}),r("button",{type:"submit",className:"w-full btn-primary px-4 py-3 rounded-lg transition-all",children:"Conectar"})]}),o==="processing"&&r("div",{className:"text-center py-8",children:r("div",{className:"text-gray-500",children:"Procesando..."})}),o==="success"&&r("div",{className:"text-center py-8",children:r("div",{className:"text-green-600",children:"¡Conexión exitosa!"})}),o==="error"&&r("div",{className:"text-center py-8",children:[r("div",{className:"text-red-600 mb-4",children:["Error: ",d]}),r("button",{onClick:u,className:"bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600",children:"Reintentar"})]})]})}):null},ni=()=>{const{oauthApps:t,loading:e,error:s,createOAuthApp:n,updateOAuthApp:a,deleteOAuthApp:o,hasOAuthApp:i}=Bn(),[c,m]=C(!1),[h,_]=C(null),[d,f]=C({provider:"",client_id:"",client_secret:"",app_name:""}),v=[{id:"google",name:"Google",icon:"🔍",description:"Gmail, Drive, Calendar, Sheets"},{id:"github",name:"GitHub",icon:"🐙",description:"Repositorios, Issues, Pull Requests"},{id:"microsoft",name:"Microsoft",icon:"🔷",description:"Outlook, Office 365, OneDrive"},{id:"slack",name:"Slack",icon:"💬",description:"Mensajería de equipo"},{id:"salesforce",name:"Salesforce",icon:"☁️",description:"CRM y automatización"}],b=(l=null)=>{if(l){const u=t.find(w=>w.provider===l);f({provider:l,client_id:(u==null?void 0:u.client_id)||"",client_secret:"",app_name:(u==null?void 0:u.app_name)||""}),_(l)}else f({provider:"",client_id:"",client_secret:"",app_name:""}),_(null);m(!0)},y=()=>{m(!1),_(null),f({provider:"",client_id:"",client_secret:"",app_name:""})},p=async l=>{l.preventDefault();try{if(h){const u={};d.client_id&&(u.client_id=d.client_id),d.client_secret&&(u.client_secret=d.client_secret),d.app_name&&(u.app_name=d.app_name),await a(h,u),alert("✅ OAuth App actualizada exitosamente")}else await n(d.provider,{client_id:d.client_id,client_secret:d.client_secret,app_name:d.app_name}),alert("✅ OAuth App creada exitosamente");y()}catch(u){alert(`❌ Error: ${u.message}`)}},x=async l=>{if(confirm(`¿Estás seguro de que quieres eliminar la OAuth App de ${l}? Las futuras autenticaciones usarán las credenciales por defecto del sistema.`))try{await o(l),alert("✅ OAuth App eliminada exitosamente")}catch(u){alert(`❌ Error eliminando OAuth App: ${u.message}`)}};return r("div",{className:"space-y-6",children:[r("div",{className:"flex justify-between items-center",children:[r("div",{children:[r("h3",{className:"text-lg font-semibold text-gray-900",children:"🔧 Mis OAuth Applications"}),r("p",{className:"text-sm text-gray-600 mt-1",children:"Configura tus propias aplicaciones OAuth o usa las credenciales por defecto"})]}),r("button",{onClick:()=>b(),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium",children:"➕ Agregar OAuth App"})]}),e&&r("div",{className:"text-center py-4",children:r("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"})}),s&&r("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r("p",{className:"text-red-600 text-sm",children:s})}),r("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:v.map(l=>{const u=t.find(k=>k.provider===l.id),w=!!u;return r("div",{className:"border rounded-lg p-4",children:[r("div",{className:"flex items-center justify-between mb-3",children:[r("div",{className:"flex items-center",children:[r("span",{className:"text-2xl mr-3",children:l.icon}),r("div",{children:[r("h4",{className:"font-medium text-gray-900",children:l.name}),r("p",{className:"text-xs text-gray-500",children:l.description})]})]}),r("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${w?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}`,children:w?"✅ Configurado":"⚙️ Por defecto"})]}),w&&r("div",{className:"mb-3 p-2 bg-blue-50 rounded text-sm",children:[r("p",{className:"text-blue-700",children:[r("strong",{children:"App:"})," ",u.app_name]}),r("p",{className:"text-blue-600 text-xs mt-1",children:["Client ID: ",u.client_id.substring(0,20),"..."]})]}),r("div",{className:"flex space-x-2",children:w?r(X,{children:[r("button",{onClick:()=>b(l.id),className:"flex-1 text-blue-600 hover:text-blue-800 text-sm",children:"✏️ Editar"}),r("button",{onClick:()=>x(l.id),className:"flex-1 text-red-600 hover:text-red-800 text-sm",children:"🗑️ Eliminar"})]}):r("button",{onClick:()=>b(l.id),className:"w-full text-blue-600 hover:text-blue-800 text-sm",children:"⚙️ Configurar"})})]},l.id)})}),c&&r("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[r("div",{className:"px-6 py-4 border-b",children:r("h3",{className:"text-lg font-semibold",children:h?"✏️ Editar OAuth App":"➕ Nueva OAuth App"})}),r("form",{onSubmit:p,className:"p-6 space-y-4",children:[!h&&r("div",{children:[r("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Provider"}),r("select",{value:d.provider,onChange:l=>f({...d,provider:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[r("option",{value:"",children:"Seleccionar provider..."}),v.map(l=>r("option",{value:l.id,disabled:i(l.id),children:[l.name," ",i(l.id)?"(Ya configurado)":""]},l.id))]})]}),r("div",{children:[r("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de la App"}),r("input",{type:"text",value:d.app_name,onChange:l=>f({...d,app_name:l.target.value}),placeholder:"Ej: Mi App de Gmail Personal",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r("div",{children:[r("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Client ID"}),r("input",{type:"text",value:d.client_id,onChange:l=>f({...d,client_id:l.target.value}),placeholder:"123456789-abcdef.apps.googleusercontent.com",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),r("div",{children:[r("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Client Secret"}),r("input",{type:"password",value:d.client_secret,onChange:l=>f({...d,client_secret:l.target.value}),placeholder:h?"Dejar vacío para mantener el actual":"GOCSPX-1234567890abcdef",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!h})]}),r("div",{className:"flex space-x-3 pt-4",children:[r("button",{type:"button",onClick:y,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),r("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:h?"Actualizar":"Crear"})]})]})]})})]})},ai=()=>{const[t,e]=C([]),[s,n]=C(!1),[a,o]=C(null),i=async()=>{try{n(!0),o(null);const b=await fetch("/api/credentials/",{headers:{Authorization:`Bearer ${V()}`}});if(!b.ok)throw new Error(`Error ${b.status}: ${await b.text()}`);const y=await b.json();return e(y),y}catch(b){return o(b.message),[]}finally{n(!1)}},c=async(b,y=null)=>{try{const p=new URLSearchParams({provider:b});y&&p.append("flavor",y);const x=await fetch(`/api/credentials/${b}?${p.toString()}`,{headers:{Authorization:`Bearer ${V()}`}});if(x.status===404)return null;if(!x.ok)throw new Error(`Error ${x.status}: ${await x.text()}`);return await x.json()}catch(p){return console.error("Error getting credential:",p),null}},m=async b=>{try{n(!0),o(null);const y=await fetch("/api/credentials/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`},body:JSON.stringify(b)});if(!y.ok)throw new Error(`Error ${y.status}: ${await y.text()}`);const p=await y.json();return e(x=>[...x.filter(u=>!(u.provider===p.provider&&u.flavor===p.flavor)),p]),p}catch(y){throw o(y.message),y}finally{n(!1)}},h=async(b,y=null)=>{try{n(!0),o(null);let p,x;y!==null?(console.warn("⚠️ Using deprecated provider+flavor deletion. Please migrate to service_id."),p=`/api/credentials/${b}?flavor=${y}`,x=u=>u.provider===b&&u.flavor===y):(p=`/api/credentials/${b}`,x=u=>u.service_id===b),console.log("🗑️ Deleting credential:",{serviceIdOrProvider:b,flavor:y,url:p});const l=await fetch(p,{method:"DELETE",headers:{Authorization:`Bearer ${V()}`}});if(!l.ok){const u=await l.text();throw new Error(`Error ${l.status}: ${u}`)}return console.log("✅ Credencial eliminada exitosamente del backend"),e(u=>u.filter(w=>!x(w))),!0}catch(p){throw console.error("❌ Error eliminando credencial:",p),o(p.message),console.log("🔄 Recargando credenciales desde servidor para sincronizar..."),await i(),p}finally{n(!1)}},_=(b,y=null)=>t.some(p=>p.provider===b&&(y===null||p.flavor===y)),d=()=>i(),f=(b,y=null)=>{const p=t.find(x=>x.service_id===b||x.provider===b&&(y===null||x.flavor===y));return p?p.expires_at&&new Date(p.expires_at)<=new Date?"expired":"connected":"disconnected"},v=(b,y=null)=>{const p=t.find(x=>x.provider===b&&(y===null||x.flavor===y));return(p==null?void 0:p.scopes)||[]};return M(()=>{V()&&i()},[]),{credentials:t,loading:s,error:a,fetchCredentials:i,getCredential:c,createCredential:m,deleteCredential:h,hasCredential:_,refreshCredentials:d,getConnectionStatus:f,getCredentialScopes:v}},Xr=({isOpen:t,onClose:e})=>{const[s,n]=C(!1),[a,o]=C(null),[i,c]=C(""),[m,h]=C(""),[_,d]=C("credentials"),{credentials:f,loading:v,error:b,refreshCredentials:y,deleteCredential:p,getConnectionStatus:x}=ai(),[l,u]=C({}),[w,k]=C(!0);M(()=>{(async()=>{try{const G=(await W("/api/v1/auth-service-discovery/services/available")).reduce((K,re)=>{const Qe=re.mechanism==="oauth2"?"OAuth Services":re.mechanism==="api_key"?"API Key Services":re.mechanism==="bot_token"?"Bot Token Services":re.mechanism==="db_credentials"?"Database Services":"Otros";return K[Qe]||(K[Qe]=[]),K[Qe].push({service_id:re.service_id,name:re.display_name||re.service_id,icon:O(re.service_id,re.mechanism),mechanism:re.mechanism,provider:re.provider}),K},{});u(G)}catch(Q){console.error("Error loading services:",Q),u({})}finally{k(!1)}})()},[]);const O=(j,Q)=>({gmail:"📧",google_calendar:"📅",google_drive:"💾",google_sheets:"📊",slack:"💬",telegram:"✈️",stripe:"💳",github:"🐙",dropbox:"📦",salesforce:"☁️",hubspot:"🎯",airtable:"📋",postgres:"🐘",sat:"🏛️",whatsapp:"📱",outlook:"📮"})[j]||(Q==="oauth2"?"🔐":Q==="api_key"?"🔑":Q==="bot_token"?"🤖":"🔗"),D=j=>{for(const Q of Object.values(l)){const G=Q.find(K=>K.service_id===j);if(G)return G}return{icon:"🔐",name:j}},H=j=>{o({service_id:j}),n(!0)},A=async j=>{await y(),n(!1),o(null)},N=async j=>{const G=D(j).name||j;if(confirm(`¿Estás seguro de que quieres eliminar la credencial de ${G}?`))try{await p(j),console.log("✅ Credencial eliminada exitosamente:",j)}catch(K){console.error("❌ Error eliminando credencial:",K),alert(`Error eliminando credencial de ${G}: ${K.message}`)}},S=j=>{const Q=new Date,G=new Date(j),K=Math.floor((Q-G)/(1e3*60*60));if(K<1)return"Hace menos de 1 hora";if(K<24)return`Hace ${K} hora${K>1?"s":""}`;const re=Math.floor(K/24);return`Hace ${re} día${re>1?"s":""}`},R=j=>{switch(j){case"connected":return"text-green-600 bg-green-100";case"expired":return"text-orange-600 bg-orange-100";case"disconnected":return"text-gray-600 bg-gray-100";default:return"text-gray-600 bg-gray-100"}},Z=j=>{switch(j){case"connected":return"Conectado";case"expired":return"Expirado";case"disconnected":return"Desconectado";default:return"Desconocido"}};return t?r("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50",children:r("div",{className:"glass-card rounded-xl shadow-elegant-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[r("div",{className:"px-6 py-4 border-b border-primary",children:[r("div",{className:"flex items-center justify-between",children:[r("h2",{className:"text-xl font-semibold text-elegant gradient-text",children:"🔐 Gestión de Credenciales"}),r("button",{onClick:e,className:"text-subtle hover:text-white transition-colors p-2 hover:bg-white hover:bg-opacity-10 rounded-lg",children:"✕"})]}),r("p",{className:"text-subtle text-sm mt-1",children:"Gestiona las conexiones con tus servicios y aplicaciones"})]}),r("div",{className:"border-b border-primary px-6",children:r("nav",{className:"flex space-x-8",children:[r("button",{onClick:()=>d("credentials"),className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors ${_==="credentials"?"border-accent text-accent":"border-transparent text-subtle hover:text-elegant hover:border-primary"}`,children:"🔐 Credenciales Activas"}),r("button",{onClick:()=>d("oauth-apps"),className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors ${_==="oauth-apps"?"border-accent text-accent":"border-transparent text-subtle hover:text-elegant hover:border-primary"}`,children:"🔧 OAuth Applications"})]})}),r("div",{className:"flex h-full",style:{maxHeight:"calc(90vh - 160px)"},children:_==="credentials"?r(X,{children:[r("div",{className:"w-1/2 border-r border-primary overflow-y-auto p-6",children:[r("h3",{className:"text-lg font-medium text-elegant mb-4",children:"Credenciales Activas"}),v&&r("div",{className:"text-center py-8",children:[r("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent mx-auto mb-2"}),r("p",{className:"text-subtle",children:"Cargando credenciales..."})]}),b&&r("div",{className:"surface-elevated border border-red-400 border-opacity-30 rounded-lg p-4 mb-4",children:r("p",{className:"text-red-300 text-sm",children:b})}),!v&&f.length===0&&r("div",{className:"text-center py-8",children:[r("div",{className:"text-subtle text-6xl mb-4",children:"🔒"}),r("h4",{className:"text-elegant font-medium mb-2",children:"No hay credenciales"}),r("p",{className:"text-muted text-sm",children:"Añade tu primera conexión desde el panel derecho"})]}),r("div",{className:"space-y-3",children:f.map((j,Q)=>{const G=D(j.service_id),K=x(j.service_id);return r("div",{className:"border rounded-lg p-4",children:[r("div",{className:"flex items-center justify-between mb-2",children:[r("div",{className:"flex items-center",children:[r("span",{className:"text-2xl mr-3",children:G.icon}),r("div",{children:[r("h4",{className:"font-medium",children:G.name}),r("p",{className:"text-xs text-gray-500",children:[S(j.created_at)," • ",j.service_id]})]})]}),r("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${R(K)}`,children:Z(K)})]}),r("div",{className:"flex justify-end space-x-2",children:[K==="expired"&&r("button",{onClick:()=>H(j.service_id),className:"text-orange-600 hover:text-orange-800 text-sm",children:"🔄 Renovar"}),r("button",{onClick:()=>N(j.service_id),className:"text-red-600 hover:text-red-800 text-sm",children:"🗑️ Eliminar"})]})]},Q)})})]}),r("div",{className:"w-1/2 overflow-y-auto p-6",children:[r("h3",{className:"text-lg font-medium mb-4",children:"Añadir Nueva Conexión"}),w?r("div",{className:"text-center py-8",children:r("div",{className:"text-gray-500",children:"Cargando servicios disponibles..."})}):Object.entries(l).map(([j,Q])=>r("div",{className:"mb-6",children:[r("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:j}),r("div",{className:"grid grid-cols-1 gap-2",children:Q.map((G,K)=>r("button",{onClick:()=>H(G.service_id),className:"flex items-center p-3 border rounded-lg hover:bg-gray-50 text-left",children:[r("span",{className:"text-2xl mr-3",children:G.icon}),r("div",{children:[r("div",{className:"font-medium",children:G.name}),r("div",{className:"text-xs text-gray-500",children:[G.mechanism," • ",G.service_id]})]})]},K))})]},j))]})]}):r("div",{className:"w-full overflow-y-auto p-6",children:r(ni,{})})}),r(Qn,{isOpen:s,onClose:()=>n(!1),serviceId:a==null?void 0:a.service_id,onSuccess:A})]})}):null};async function oi(){return W("/api/ai_agents/")}async function ii(t){return W(`/api/ai_agents/${t}`)}async function li(t,e=1,s=20,n){const a=new URLSearchParams({page:e.toString(),page_size:s.toString()});return n&&a.append("status",n),W(`/api/ai_agents/${t}/runs?${a.toString()}`)}async function ci(t){return W(`/api/ai_agents/${t}/runs/statistics`)}async function di(t,e=30,s=10){const n=new URLSearchParams({days:e.toString(),recent_limit:s.toString()});return W(`/api/ai_agents/${t}/runs/analytics?${n.toString()}`)}function ui(t,e){return W(`/api/ai_agents/${t}/deploy`,{method:"POST",body:{channel:e}})}function hi(t){return Fn({mutationFn:e=>ui(t,e)})}function mi({isOpen:t,onClose:e}){var n;const s=hi(Uo);return M(()=>{t&&s.reset&&s.reset()},[t]),t?r("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r("div",{className:"bg-surface text-text-primary p-4 rounded shadow-lg w-80 max-w-[90vw]",children:[r("h2",{className:"text-xl font-bold mb-4",children:"Deploy agente"}),r("div",{className:"space-y-2",children:[r("button",{onClick:()=>s.mutate("web"),disabled:s.isLoading,className:"w-full bg-purple hover:bg-purple-hover text-white py-2 rounded disabled:opacity-50",children:s.isLoading?"Desplegando…":"Web"}),r("button",{onClick:()=>s.mutate("telegram"),disabled:s.isLoading,className:"w-full bg-purple hover:bg-purple-hover text-white py-2 rounded disabled:opacity-50",children:s.isLoading?"Desplegando…":"Telegram"})]}),s.isError&&r("p",{className:"text-red-500 mt-2",children:["Error: ",((n=s.error)==null?void 0:n.detail)||"fallo"]}),s.isSuccess&&r("p",{className:"text-green-500 mt-2",children:s.data.message}),r("div",{className:"mt-4 text-right",children:r("button",{onClick:e,className:"px-4 py-2 bg-purple hover:bg-purple-hover text-white rounded",children:"Cerrar"})})]})}):null}class fi{async getProviders(e=!1){const s=new URLSearchParams;return e&&s.append("include_inactive","true"),W(`/api/llm/providers?${s.toString()}`)}async getProvider(e){return W(`/api/llm/providers/${e}`)}async getProviderModels(e,s=!1){const n=new URLSearchParams;return s&&n.append("include_inactive","true"),W(`/api/llm/providers/${e}/models?${n.toString()}`)}async getModels(e={}){const s=new URLSearchParams;return e.provider_key&&s.append("provider_key",e.provider_key),e.capabilities&&e.capabilities.forEach(n=>s.append("capabilities",n)),e.min_context_length&&s.append("min_context_length",e.min_context_length.toString()),e.max_cost_per_1k_input&&s.append("max_cost_per_1k_input",e.max_cost_per_1k_input.toString()),e.include_inactive&&s.append("include_inactive","true"),W(`/api/llm/models?${s.toString()}`)}async searchModels(e,s=20){const n=new URLSearchParams({q:e,limit:s.toString()});return W(`/api/llm/models/search?${n.toString()}`)}async getModel(e){return W(`/api/llm/models/${e}`)}async checkProvidersHealth(){return W("/api/llm/health")}async getUserAnalytics(e=30,s){const n=new URLSearchParams({days:e.toString()});return s&&n.append("provider_key",s),W(`/api/llm/usage/analytics?${n.toString()}`)}}const Yt=new fi,pi=Bt(Wn((t,e)=>({providers:[],models:[],selectedModel:null,selectedProvider:null,recommendedModels:[],loading:!1,error:null,initialized:!1,providersHealth:{},lastHealthCheck:null,setLoading:s=>t({loading:s}),setError:s=>t({error:s}),initialize:async()=>{if(!e().initialized)try{t({loading:!0,error:null});const s=await Yt.getProviders(),n=s.reduce((i,c)=>{const m=(c.models||[]).map(h=>({...h,provider_name:c.name,provider_key:c.provider_key}));return[...i,...m]},[]);console.log("🔍 LLM Store - providers loaded:",s.length),console.log("🔍 LLM Store - total models:",n.length),console.log("🔍 LLM Store - sample model:",n[0]);const a=n.find(i=>i.is_active)||n[0],o=s.find(i=>i.provider_key===(a==null?void 0:a.provider_key));t({providers:s,models:n,recommendedModels:[],selectedModel:a,selectedProvider:o,initialized:!0,loading:!1})}catch(s){console.error("Failed to initialize LLM store:",s),t({error:s.message||"Failed to load models",loading:!1})}},refresh:async()=>{t({initialized:!1}),await e().initialize()},selectModel:s=>{const n=e().providers.find(a=>a.provider_key===s.provider_key);t({selectedModel:s,selectedProvider:n})},selectModelByKey:s=>{const n=e().models.find(a=>a.model_key===s);n&&e().selectModel(n)},getModelsByProvider:s=>e().models.filter(n=>n.provider_key===s),getActiveModels:()=>e().models.filter(s=>s.is_active),searchModels:async s=>{try{t({loading:!0,error:null});const n=await Yt.searchModels(s);return t({loading:!1}),n}catch(n){return console.error("Failed to search models:",n),t({error:n.message||"Search failed",loading:!1}),[]}},checkHealth:async()=>{try{const s=await Yt.checkProvidersHealth();return t({providersHealth:s.providers,lastHealthCheck:new Date().toISOString()}),s}catch(s){return console.error("Failed to check providers health:",s),t({error:s.message||"Health check failed"}),null}},getModelsWithFilters:async(s={})=>{try{t({loading:!0,error:null});const n=await Yt.getModels(s);return t({loading:!1}),n}catch(n){return console.error("Failed to get filtered models:",n),t({error:n.message||"Failed to filter models",loading:!1}),[]}},clearError:()=>t({error:null}),reset:()=>t({providers:[],models:[],selectedModel:null,selectedProvider:null,recommendedModels:[],loading:!1,error:null,initialized:!1,providersHealth:{},lastHealthCheck:null})}),{name:"llm-store",partialize:t=>({selectedModel:t.selectedModel,selectedProvider:t.selectedProvider})}));function gi({className:t="",showProvider:e=!0,compact:s=!1,onModelChange:n=null}){const[a,o]=C(!1),[i,c]=C(""),m=at(null),{providers:h,models:_,selectedModel:d,loading:f,error:v,initialized:b,initialize:y,selectModel:p,clearError:x,getActiveModels:l}=pi();M(()=>{b||y()},[b,y]),M(()=>{const A=N=>{m.current&&!m.current.contains(N.target)&&o(!1)};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[]);const u=()=>{const A=l();return i.trim()?A.filter(N=>{var S,R;return((S=N.name)==null?void 0:S.toLowerCase().includes(i.toLowerCase()))||((R=N.model_key)==null?void 0:R.toLowerCase().includes(i.toLowerCase()))||N.provider_name&&N.provider_name.toLowerCase().includes(i.toLowerCase())}):A},w=()=>{const A=u(),N={};return A.forEach(S=>{const R=S.provider_key;if(!N[R]){const Z=h.find(j=>j.provider_key===R);N[R]={provider:Z||{name:R,provider_key:R},models:[]}}N[R].models.push(S)}),N},k=A=>{p(A),o(!1),c(""),n&&n(A)},O=A=>!A||isNaN(A)?"N/A":A<.001?"<$0.001":`$${A.toFixed(3)}`,D=A=>!A||isNaN(A)?"N/A":A>=1e6?`${(A/1e6).toFixed(1)}M`:A>=1e3?`${(A/1e3).toFixed(0)}K`:A.toString();if(f&&!b)return r("div",{className:`flex items-center gap-2 ${t}`,children:[r("div",{className:"animate-spin w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full"}),r("span",{className:"text-sm text-gray-400",children:"Loading models..."})]});if(v)return r("div",{className:`flex items-center gap-2 ${t}`,children:r("div",{className:"text-red-400 text-sm",children:["Error: ",v,r("button",{onClick:x,className:"ml-2 text-xs underline hover:no-underline",children:"Retry"})]})});if(!d)return r("div",{className:`text-gray-400 text-sm ${t}`,children:"No model selected"});const H=w();return r("div",{className:`relative ${t}`,ref:m,children:[r("button",{onClick:()=>o(!a),className:`
          flex items-center justify-between w-full px-3 py-2 
          bg-gray-800 hover:bg-gray-700 border border-gray-600 
          rounded-lg transition-colors focus:outline-none focus:ring-2 
          focus:ring-purple-500 focus:border-transparent
          ${s?"text-sm":""}
        `,children:[r("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[r("div",{className:`
            flex-shrink-0 w-2 h-2 rounded-full
            ${d.is_recommended?"bg-green-400":"bg-gray-400"}
          `}),r("div",{className:"min-w-0 flex-1 text-left",children:[r("div",{className:"text-white font-medium truncate",children:d.name}),!s&&e&&r("div",{className:"text-xs text-gray-400 truncate",children:[d.provider_name," • ",D(d.context_length)," tokens"]})]})]}),!s&&r("div",{className:"text-xs text-gray-400 ml-2",children:[O(d.cost_per_1k_input_tokens||d.input_cost_per_1k),"/1K"]}),r("svg",{className:`w-4 h-4 ml-2 transform transition-transform ${a?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&r("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-800 border border-gray-600 rounded-lg shadow-xl z-50 max-h-96 overflow-hidden",children:[r("div",{className:"p-3 border-b border-gray-600",children:r("input",{type:"text",placeholder:"Search models...",value:i,onInput:A=>c(A.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})}),r("div",{className:"max-h-64 overflow-y-auto",children:Object.entries(H).map(([A,{provider:N,models:S}])=>r("div",{children:[r("div",{className:"px-3 py-2 text-xs font-medium text-gray-400 bg-gray-750 sticky top-0",children:[N.name,r("span",{className:"ml-2 text-gray-500",children:["(",S.length,")"]})]}),S.map(R=>r(xi,{model:R,isSelected:(d==null?void 0:d.id)===R.id,onClick:()=>k(R),showProvider:!1,compact:s},R.id))]},A))}),Object.keys(H).length===0&&r("div",{className:"px-3 py-4 text-center text-gray-400",children:['No models found matching "',i,'"']})]})]})}function xi({model:t,isSelected:e,onClick:s,showProvider:n,compact:a}){const o=c=>!c||isNaN(c)?"N/A":c<.001?"<$0.001":`$${c.toFixed(3)}`,i=c=>!c||isNaN(c)?"N/A":c>=1e6?`${(c/1e6).toFixed(1)}M`:c>=1e3?`${(c/1e3).toFixed(0)}K`:c.toString();return r("button",{onClick:s,className:`
        w-full px-3 py-2 text-left hover:bg-gray-700 transition-colors
        ${e?"bg-purple-900/50 border-r-2 border-purple-500":""}
        ${a?"py-1":""}
      `,children:r("div",{className:"flex items-center justify-between",children:[r("div",{className:"min-w-0 flex-1",children:[r("div",{className:"flex items-center gap-2",children:[r("div",{className:`
              w-2 h-2 rounded-full flex-shrink-0
              ${t.is_recommended?"bg-green-400":"bg-gray-500"}
            `}),r("span",{className:"text-white font-medium truncate",children:t.name}),t.is_recommended&&r("span",{className:"text-xs bg-green-600 text-white px-1 py-0.5 rounded",children:"REC"})]}),!a&&r("div",{className:"text-xs text-gray-400 mt-1 flex items-center gap-2",children:[n&&t.provider_name&&r("span",{children:t.provider_name}),r("span",{children:[i(t.context_length)," tokens"]}),t.capabilities&&t.capabilities.length>0&&r("span",{children:["• ",t.capabilities.slice(0,2).join(", ")]})]})]}),r("div",{className:"text-xs text-gray-400 ml-2 flex-shrink-0",children:[o(t.cost_per_1k_input_tokens||t.input_cost_per_1k),"/1K"]})]})})}const Gn=["classic","ai"],vi=()=>{if(typeof window>"u")return"classic";const t=localStorage.getItem("mode");return Gn.includes(t)?t:(localStorage.setItem("mode","classic"),"classic")},Mt=Bt(t=>({mode:vi(),setMode:e=>{Gn.includes(e)&&(localStorage.setItem("mode",e),t({mode:e}))}})),yi=Object.freeze(Object.defineProperty({__proto__:null,default:Mt},Symbol.toStringTag,{value:"Module"})),bi=({isOpen:t,onClose:e,userIntent:s,onFileSelected:n})=>{const[a,o]=C([]),[i,c]=C(!1),[m,h]=C(null);M(()=>{t&&s&&_()},[t,s]);const _=async()=>{var f,v;if(s!=null&&s.trim()){c(!0),h(null);try{const{fetcher:b}=await or(async()=>{const{fetcher:p}=await Promise.resolve().then(()=>Zo);return{fetcher:p}},void 0),y=await b("/file-discovery/discover",{method:"POST",body:{user_message:s,file_types:null,providers:null,planned_steps:[]}});o(y.discovered_files||[])}catch(b){console.error("Auto-discovery error:",b),h(((v=(f=b.detail)==null?void 0:f[0])==null?void 0:v.msg)||b.message||"Error en el auto-descubrimiento")}finally{c(!1)}}},d=f=>{n&&n({file_id:f.id,file_name:f.name,provider:f.provider,file_type:f.file_type,metadata:f.metadata||{}})};return t?r("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[80vh] overflow-y-auto",children:[r("div",{className:"flex justify-between items-center mb-4",children:[r("h3",{className:"text-lg font-semibold text-gray-900",children:"Auto-Descubrimiento de Archivos"}),r("button",{onClick:e,className:"text-gray-400 hover:text-gray-600",children:r("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r("div",{className:"mb-4",children:r("p",{className:"text-sm text-gray-600",children:[r("span",{className:"font-medium",children:"Intent detectado:"})," ",s]})}),i&&r("div",{className:"flex items-center justify-center py-8",children:[r("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),r("span",{className:"ml-2 text-gray-600",children:"Analizando servicios disponibles..."})]}),m&&r("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-4",children:r("div",{className:"flex",children:[r("div",{className:"flex-shrink-0",children:r("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:r("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),r("div",{className:"ml-3",children:r("p",{className:"text-sm text-red-800",children:m})})]})}),!i&&!m&&a.length===0&&r("div",{className:"text-center py-8",children:r("p",{className:"text-gray-500",children:"No se encontraron archivos relevantes para este intent."})}),a.length>0&&r("div",{className:"space-y-3",children:[r("h4",{className:"font-medium text-gray-900",children:"Archivos Descubiertos:"}),a.map((f,v)=>r("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>d(f),children:r("div",{className:"flex items-start justify-between",children:[r("div",{className:"flex items-start space-x-3",children:[r("div",{className:"text-2xl",children:f.icon||"📄"}),r("div",{className:"flex-1",children:[r("h5",{className:"font-medium text-gray-900",children:f.name}),r("p",{className:"text-sm text-gray-600 mt-1",children:[f.provider," • ",f.file_type]}),f.metadata&&Object.keys(f.metadata).length>0&&r("div",{className:"mt-2",children:[r("p",{className:"text-xs text-gray-500",children:"Metadata:"}),r("div",{className:"text-xs text-gray-600 mt-1",children:Object.entries(f.metadata).slice(0,2).map(([b,y])=>r("div",{children:[b,": ",String(y).substring(0,50)]},b))})]})]})]}),r("div",{className:"ml-4 flex-shrink-0",children:r("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:f.confidence?`${Math.round(f.confidence*100)}%`:"Encontrado"})})]})},f.id||v))]}),r("div",{className:"flex justify-end space-x-3 mt-6",children:[r("button",{onClick:e,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:"Cerrar"}),a.length>0&&r("button",{onClick:_,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors",children:"Refrescar Sugerencias"})]})]})}):null},Kn=({isAuthenticated:t=!1,onLoginClick:e=()=>{}})=>{const[s,n]=C(null),[a,o]=C(!1),[i,c]=C("Quiero conectar mi Google Sheets para automatizar reportes");typeof t!="boolean"&&console.warn("Dashboard: isAuthenticated debe ser boolean, recibido:",typeof t);const m=[{id:"marketplace",title:"Marketplace",description:"Plantillas pre-hechas para empezar rápidamente",icon:"🛒",href:"#",requiresAuth:!1,locked:!0,features:["Templates listos para usar","Casos de uso populares","Instalación con un click","Ejemplos reales"]},{id:"agents",title:"AI Agents",description:"Agentes inteligentes para automatización avanzada",icon:"🤖",href:"#",requiresAuth:!1,locked:!0,features:["Agentes personalizados","Integración con APIs","Lógica compleja","Ejecución autónoma"]},{id:"integrations",title:"Integraciones",description:"Catálogo completo de servicios y APIs disponibles",icon:"🔌",href:"#integrations-section",requiresAuth:!1,features:["Google (Drive, Sheets, Gmail)","GitHub, Slack, Microsoft","Dropbox, Salesforce, Stripe","Code Executor, Webhooks"]},{id:"settings",title:"Configuración",description:"Credenciales, perfiles y ajustes de cuenta",icon:"⚙️",href:"#",requiresAuth:!0,features:["Gestión de credenciales","Configuración de cuenta","Métodos de pago","Notificaciones"]}],h=[{step:1,text:"Describe tu automatización",icon:"💭"},{step:2,text:"IA procesa y configura",icon:"🧠"},{step:3,text:"Se ejecuta automáticamente",icon:"⚡"},{step:4,text:"Monitorea y optimiza",icon:"📈"}],_=[{name:"🌐 Google Workspace",items:[{name:"Gmail",actions:"Enviar mensajes, triggers"},{name:"Google Drive",actions:"Upload, sincronización"},{name:"Google Sheets",actions:"Leer/escribir, crear hojas"},{name:"Google Calendar",actions:"Crear eventos"},{name:"Google Docs",actions:"Crear documentos"}]},{name:"💼 Productividad",items:[{name:"Slack",actions:"Mensajes, triggers de canales"},{name:"Microsoft Outlook",actions:"Enviar correos"},{name:"GitHub",actions:"Crear issues, triggers"},{name:"Airtable",actions:"Leer/escribir datos"}]},{name:"☁️ Storage & Files",items:[{name:"Dropbox",actions:"Upload archivos"},{name:"Code Executor",actions:"Ejecutar código Python/JS"},{name:"PostgreSQL",actions:"Queries personalizadas"},{name:"HTTP Requests",actions:"APIs personalizadas"}]},{name:"💰 Business & Sales",items:[{name:"Salesforce",actions:"Crear leads, CRM"},{name:"Stripe",actions:"Procesar pagos"},{name:"SAT México",actions:"Descargar CFDI"},{name:"Webhooks",actions:"Triggers personalizados"}]},{name:"📱 Messaging",items:[{name:"Telegram",actions:"Enviar mensajes"},{name:"WhatsApp",actions:"Templates de mensajes"}]},{name:"🤖 IA & Automation",items:[{name:"AI Agent Creator",actions:"Crear agentes personalizados",locked:!0},{name:"RAG Handler",actions:"Búsqueda semántica",locked:!0},{name:"Memory Systems",actions:"Memoria episódica/semántica",locked:!0},{name:"LLM Integrations",actions:"OpenAI, Claude, otros",locked:!0}]}],d=[{name:"🎨 Frontend",items:["Preact","Tailwind","TypeScript","Vite"]},{name:"⚙️ Backend",items:["Python","FastAPI","PostgreSQL","Redis"]},{name:"🧠 IA & NLP",items:["OpenAI","Claude","Langchain","Vector DB"]},{name:"☁️ Deploy",items:["Docker","AWS","Railway","GitHub Actions"]}];return r("div",{className:"min-h-screen bg-gradient-main text-text-primary overflow-auto",children:[r("div",{className:"max-w-7xl mx-auto px-6 py-10",children:[r("header",{className:"text-center mb-16",children:[r("div",{className:"inline-flex items-center gap-4 mb-6 p-4 glass rounded-3xl",children:r("div",{className:"w-16 h-16 flex items-center justify-center",children:r("img",{src:"/logo.svg",alt:"QYRAL Logo",className:"w-16 h-16",style:{filter:"none"}})})}),r("h1",{className:"text-5xl md:text-6xl font-extrabold mb-4 gradient-text leading-tight",children:"Plataforma de Automatización"}),r("p",{className:"text-xl text-text-secondary max-w-2xl mx-auto leading-relaxed",children:"Conecta tus herramientas favoritas con inteligencia artificial y lenguaje natural para automatizar tu negocio"}),t&&r("div",{className:"mt-8 max-w-lg mx-auto glass p-6 rounded-3xl border border-accent",children:[r("div",{className:"flex items-center gap-3 mb-3",children:[r("div",{className:"w-12 h-12 surface-elevated rounded-full flex items-center justify-center text-2xl",children:"👋"}),r("div",{className:"text-left",children:[r("h3",{className:"text-lg font-bold text-text-primary",children:"¡Bienvenido de vuelta!"}),r("p",{className:"text-sm text-text-secondary",children:"Listo para crear nuevas automatizaciones"})]})]}),r("div",{className:"flex gap-3 pt-2",children:[r(ge,{href:"/chat",className:"btn-primary px-4 py-2 rounded-lg text-sm font-medium flex-1 text-center",children:"🚀 Crear Workflow"}),r("button",{className:"btn-glass px-4 py-2 rounded-lg text-sm font-medium flex-1 text-center opacity-50 cursor-not-allowed",children:"🛒 Próximamente"})]})]}),!t&&r("div",{className:"mt-8 max-w-md mx-auto",children:[r("button",{onClick:e,className:"btn-primary px-8 py-4 rounded-2xl font-bold text-lg shadow-elegant-lg hover:transform hover:scale-105 transition-all duration-300 flex items-center gap-3 mx-auto",children:"🚀 ¡Comenzar Gratis!"}),r("p",{className:"text-sm text-text-muted mt-3",children:"Explora las funciones públicas o inicia sesión para acceso completo"})]})]}),r("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8 mb-20",children:m.map((f,v)=>{const b=f.requiresAuth&&!t||f.locked,y=r("div",{className:`relative block glass-card p-8 cursor-pointer overflow-hidden group animate-fadeInUp animate-delay-${(v+1)*100} ${f.primary?"bg-gradient-card border-accent":""} ${b?"opacity-75":""}`,onMouseEnter:()=>!b&&n(f.id),onMouseLeave:()=>n(null),onClick:b?p=>{p.preventDefault(),e()}:void 0,children:[r("div",{className:"relative z-10",children:[r("div",{className:`w-20 h-20 surface-elevated rounded-3xl flex items-center justify-center text-4xl mb-6 transition-all duration-300 ${s===f.id&&!b?"transform scale-110 rotate-3 shadow-elegant":""}`,children:f.icon}),r("h3",{className:"text-2xl font-bold mb-3 text-text-primary",children:f.title}),r("p",{className:"text-text-secondary mb-6 leading-relaxed",children:f.description}),r("ul",{className:"space-y-2",children:f.features.map((p,x)=>r("li",{className:"flex items-center gap-3 text-sm text-text-secondary",children:[r("div",{className:"w-1.5 h-1.5 bg-accent rounded-full flex-shrink-0"}),p]},x))})]}),b&&r("div",{className:"absolute inset-0 bg-gradient-main/80 backdrop-blur-sm flex flex-col items-center justify-center z-20 rounded-3xl",children:[r("div",{className:"w-16 h-16 surface-elevated rounded-2xl flex items-center justify-center text-3xl mb-4 shadow-elegant",children:"🔒"}),f.locked?r(X,{children:[r("h4",{className:"text-lg font-bold text-text-primary mb-2",children:"Próximamente"}),r("p",{className:"text-sm text-text-secondary text-center max-w-[200px]",children:"Esta funcionalidad estará disponible pronto"})]}):r(X,{children:[r("h4",{className:"text-lg font-bold text-text-primary mb-2",children:"¡Inicia sesión!"}),r("p",{className:"text-sm text-text-secondary text-center max-w-[200px] mb-4",children:"Necesitas una cuenta para acceder a esta funcionalidad"}),r("button",{onClick:p=>{p.stopPropagation(),e()},className:"btn-primary px-4 py-2 rounded-lg text-sm font-semibold",children:"🔑 Acceder"})]})]})]});return b?r("div",{children:y},f.id):r(ge,{href:f.href,children:y},f.id)})}),r("section",{className:"text-center mb-20",children:[r("h2",{className:"text-4xl font-bold mb-12 gradient-text",children:"¿Cómo Funciona?"}),r("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-8 sm:gap-12 max-w-4xl mx-auto flex-wrap",children:h.map((f,v)=>r("div",{className:"flex flex-col items-center text-center relative",children:[r("div",{className:"w-20 h-20 surface-elevated rounded-full flex items-center justify-center text-3xl font-bold shadow-elegant mb-4",children:f.step}),r("div",{className:"text-lg font-medium max-w-[120px] leading-tight",children:f.text}),v<h.length-1&&r("div",{className:"hidden md:block absolute -right-10 top-10 text-3xl text-accent font-bold",children:"→"}),v<h.length-1&&r("div",{className:"md:hidden mt-4 text-3xl text-accent font-bold transform rotate-90",children:"→"})]},f.step))})]}),!t&&r("section",{className:"mb-20",children:[r("div",{className:"text-center mb-12",children:[r("h2",{className:"text-4xl font-bold mb-4 gradient-text",children:"¿Por qué crear una cuenta?"}),r("p",{className:"text-text-secondary max-w-2xl mx-auto",children:"Desbloquea todas las funcionalidades y lleva tu productividad al siguiente nivel"})]}),r("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-12",children:[r("div",{className:"glass-card p-6 text-center",children:[r("div",{className:"w-16 h-16 surface-elevated rounded-2xl flex items-center justify-center text-3xl mx-auto mb-4 shadow-elegant",children:"💬"}),r("h3",{className:"text-xl font-bold mb-3 text-text-primary",children:"Workflows Ilimitados"}),r("p",{className:"text-text-secondary",children:"Crea tantas automatizaciones como necesites sin restricciones"})]}),r("div",{className:"glass-card p-6 text-center",children:[r("div",{className:"w-16 h-16 surface-elevated rounded-2xl flex items-center justify-center text-3xl mx-auto mb-4 shadow-elegant",children:"📊"}),r("h3",{className:"text-xl font-bold mb-3 text-text-primary",children:"Analytics Avanzados"}),r("p",{className:"text-text-secondary",children:"Monitorea el rendimiento y optimiza tus automatizaciones"})]}),r("div",{className:"glass-card p-6 text-center",children:[r("div",{className:"w-16 h-16 surface-elevated rounded-2xl flex items-center justify-center text-3xl mx-auto mb-4 shadow-elegant",children:"🔐"}),r("h3",{className:"text-xl font-bold mb-3 text-text-primary",children:"Credenciales Seguras"}),r("p",{className:"text-text-secondary",children:"Gestiona tus integraciones de manera segura y cifrada"})]})]}),r("div",{className:"text-center",children:r("button",{onClick:e,className:"btn-primary px-8 py-4 rounded-2xl font-bold text-lg shadow-elegant-lg hover:transform hover:scale-105 transition-all duration-300 inline-flex items-center gap-3",children:"🔑 Crear Cuenta Gratis"})})]}),t&&r("section",{className:"mb-12 text-center",children:r("div",{className:"glass-card p-6 max-w-md mx-auto",children:[r("h3",{className:"text-lg font-bold mb-4",children:"🧪 Probar OAuth"}),r("input",{type:"text",value:i,onChange:f=>c(f.target.value),className:"w-full p-3 surface-input border border-accent rounded-lg mb-4 text-text-primary",placeholder:"Describe qué quieres automatizar..."}),r("button",{onClick:()=>o(!0),className:"btn-primary px-4 py-2 rounded-lg w-full",children:"🔗 Probar AutoDiscovery"})]})}),r("section",{id:"integrations-section",className:"glass rounded-4xl p-8 md:p-12 mb-12",children:[r("div",{className:"text-center mb-8",children:[r("h2",{className:"text-3xl font-bold mb-4 gradient-text",children:"🔌 Integraciones Disponibles"}),r("p",{className:"text-text-secondary max-w-2xl mx-auto",children:"Conecta tus herramientas favoritas y automatiza tus procesos de negocio"})]}),r("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8",children:_.map((f,v)=>r("div",{className:"text-left",children:[r("h4",{className:"text-lg font-semibold mb-4 text-accent flex items-center gap-2",children:f.name}),r("div",{className:"space-y-3",children:f.items.map((b,y)=>r("div",{className:`p-3 surface-elevated border rounded-lg transition-all duration-300 relative overflow-hidden ${b.locked?"border-gray-600 opacity-75":"border-accent/30 hover:surface-card hover:border-accent hover:transform hover:-translate-y-0.5"}`,children:[r("div",{className:`font-medium mb-1 ${b.locked?"text-gray-400":"text-text-primary"}`,children:[b.name,b.locked&&r("span",{className:"ml-2 text-xs",children:"🔒"})]}),r("div",{className:`text-sm ${b.locked?"text-gray-500":"text-text-secondary"}`,children:b.locked?"Próximamente...":b.actions}),b.locked&&r("div",{className:"absolute inset-0 bg-gradient-main/60 backdrop-blur-[1px] flex items-center justify-center rounded-lg",children:r("div",{className:"text-center",children:[r("div",{className:"text-2xl mb-1",children:"🔒"}),r("div",{className:"text-xs font-medium text-gray-300",children:"Próximamente"})]})})]},y))})]},v))})]}),r("section",{className:"glass rounded-4xl p-8 md:p-12 text-center",children:[r("h2",{className:"text-3xl font-bold mb-8 gradient-text",children:"Stack Tecnológico"}),r("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 lg:gap-8",children:d.map((f,v)=>r("div",{className:"text-left",children:[r("h4",{className:"text-lg font-semibold mb-4 text-accent",children:f.name}),r("div",{className:"flex flex-wrap gap-2",children:f.items.map((b,y)=>r("span",{className:"px-3 py-1.5 surface-elevated border border-accent text-text-primary rounded-full text-sm font-medium transition-all duration-300 hover:surface-card hover:transform hover:-translate-y-0.5",children:b},y))})]},v))})]})]}),r(bi,{isOpen:a,onClose:()=>o(!1),userIntent:i,onFileSelected:f=>{console.log("Archivo seleccionado:",f),o(!1)}})]})};Kn.displayName="Dashboard";const _i=({oauthRequirements:t,chatId:e,onAllCompleted:s,onError:n})=>{const[a,o]=C(null),[i,c]=C([]),[m,h]=C([]);M(()=>{t&&Array.isArray(t)&&(h(t),o(t[0]))},[t]);const _=v=>{console.log("🔥 OAuthRequirementHandler - handleAuthSuccess called with:",v);const b=a==null?void 0:a.service_id;if(console.log("🔥 OAuthRequirementHandler - currentServiceId:",b),console.log("🔥 OAuthRequirementHandler - completedProviders before:",i),console.log("🔥 OAuthRequirementHandler - pendingRequirements before:",m),b){const y=[...i,b];c(y),console.log("🔥 OAuthRequirementHandler - newCompleted:",y);const p=m.filter(x=>x.service_id!==b);h(p),console.log("🔥 OAuthRequirementHandler - remaining after filter:",p),p.length>0?(console.log("🔥 OAuthRequirementHandler - Moving to next requirement:",p[0]),o(p[0])):(console.log("🎉 OAuthRequirementHandler - ALL OAUTH REQUIREMENTS COMPLETED!"),console.log("🎉 Total services authenticated:",y.length),console.log("🎉 Services:",y),o(null),s?(console.log("🎉 OAuthRequirementHandler - Executing onAllCompleted callback for ALL services"),s(y,v)):console.error("❌ OAuthRequirementHandler - onAllCompleted callback is missing!"))}else console.error("❌ OAuthRequirementHandler - No currentServiceId found")},d=v=>{console.error("OAuth requirement auth error:",v),n&&n(v,a)},f=()=>{o(null),n&&n("User cancelled authentication",a)};return a?r("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[r("div",{className:"mb-4",children:[r("h3",{className:"text-lg font-semibold text-gray-900",children:"Autenticación Requerida"}),r("p",{className:"text-sm text-gray-600 mt-2",children:["Para continuar con el workflow, necesitas autenticarte con"," ",r("span",{className:"font-medium",children:a.service_name||a.service_id})]}),m.length>1&&r("p",{className:"text-xs text-gray-500 mt-1",children:[i.length+1," de ",m.length+i.length," servicios"]})]}),r(Qn,{isOpen:!0,onClose:f,serviceId:a.service_id,chatId:e,onSuccess:_,onError:d})]})}):null};function wi(){const t=Mt(n=>n.mode),e=Mt(n=>n.setMode),s=n=>{e(n)};return r("div",{className:"inline-flex bg-gray-100 dark:bg-gray-800 rounded-2xl p-1 relative",children:[r("div",{className:`absolute top-1 h-8 bg-white dark:bg-gray-700 rounded-xl shadow-sm transition-all duration-300 ease-out ${t==="classic"?"left-1 w-20":"left-[84px] w-16"}`}),r("button",{onClick:()=>s("classic"),className:`relative z-10 px-4 py-2 text-sm font-medium transition-colors duration-300 rounded-xl ${t==="classic"?"text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"}`,children:"🔧 Clásico"}),r("button",{onClick:()=>s("ai"),className:`relative z-10 px-4 py-2 text-sm font-medium transition-colors duration-300 rounded-xl ${t==="ai"?"text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"}`,children:"🤖 Agente"})]})}const Ni=`
  /* Custom scrollbar for form content */
  .smart-form-scroll {
    scrollbar-width: thin;
    scrollbar-color: rgba(139, 92, 246, 0.3) rgba(30, 41, 59, 0.1);
  }
  
  .smart-form-scroll::-webkit-scrollbar {
    width: 8px;
  }
  
  .smart-form-scroll::-webkit-scrollbar-track {
    background: rgba(30, 41, 59, 0.1);
    border-radius: 4px;
  }
  
  .smart-form-scroll::-webkit-scrollbar-thumb {
    background: rgba(139, 92, 246, 0.3);
    border-radius: 4px;
    border: 1px solid rgba(30, 41, 59, 0.1);
  }
  
  .smart-form-scroll::-webkit-scrollbar-thumb:hover {
    background: rgba(139, 92, 246, 0.5);
  }
`;function js(t){const e={},s=[];if(t.sections){for(const n of t.sections)if(n.fields)for(const a of n.fields){const o={title:a.label||a.id,description:a.description||a.placeholder,type:Ci(a.type)};a.type==="select"&&a.options&&(o.enum=a.options.map(i=>i.value||i)),a.type==="textarea"&&(o.maxLength=1e3),a.type==="email"&&(o.format="email"),a.type==="url"&&(o.format="uri"),e[a.id]=o,a.required&&s.push(a.id)}}return{title:t.title||"Formulario",description:t.description||"",type:"object",properties:e,required:s}}function Ci(t){return{text:"string",email:"string",textarea:"string",number:"number",checkbox:"boolean",select:"string",date:"string",time:"string",url:"string",file:"string"}[t]||"string"}function ki({schemaEndpoint:t,smartFormSchema:e,onSubmit:s,onCancel:n}){const[a,o]=C(null),[i,c]=C({}),[m,h]=C(!0),[_,d]=C(null),[f,v]=C(!1);M(()=>{const l=document.createElement("style");return l.textContent=Ni,document.head.appendChild(l),()=>{document.head.removeChild(l)}},[]),M(()=>{var u;if(t===null&&((u=window.smartFormContext)!=null&&u.isSmartForm)){console.log("Using Smart Form schema from window context:",window.smartFormContext.formSchema);const w=js(window.smartFormContext.formSchema);console.log("Converted schema:",w),o(w),h(!1),d(null);return}if(e){console.log("Using Smart Form schema:",e);const w=js(e);console.log("Converted schema:",w),o(w),h(!1),d(null);return}if(!t){d("No schema endpoint or Smart Form schema provided"),h(!1);return}console.log("Fetching traditional schema from:",t);async function l(){try{h(!0);const w=await fetch(t);if(!w.ok)throw new Error("Error al obtener el esquema del formulario");const k=await w.json();o(k),d(null)}catch(w){console.error(w),d(w.message)}finally{h(!1)}}l()},[t,e]);const b=l=>{const{name:u,value:w,type:k,checked:O}=l.target;c(D=>({...D,[u]:k==="checkbox"?O:w}))},y=async l=>{l.preventDefault();try{v(!0),await s(i)}catch(u){console.error("Error submitting form:",u)}finally{v(!1)}},p=l=>l.type==="boolean"?"checkbox":l.type==="integer"||l.type==="number"?"number":l.format==="email"?"email":l.format==="uri"?"url":l.format==="password"?"password":l.format==="date"?"date":l.format==="time"?"time":l.format==="date-time"?"datetime-local":"text",x=(l,u)=>{var O;const w=(O=a.required)==null?void 0:O.includes(l),k=p(u);return u.enum?r("select",{name:l,value:i[l]||"",onChange:b,required:w,className:"w-full surface-input rounded-xl px-4 py-3 focus-elegant bg-transparent text-elegant placeholder-text-muted transition-all",children:[r("option",{value:"",disabled:!0,children:"Selecciona una opción..."}),u.enum.map(D=>r("option",{value:D,children:D},D))]}):u.type==="boolean"?r("div",{className:"flex items-center",children:[r("input",{type:"checkbox",name:l,checked:i[l]||!1,onChange:b,className:"w-5 h-5 text-accent bg-surface-input border-accent rounded focus:ring-accent focus:ring-2"}),r("span",{className:"ml-2 text-sm text-subtle",children:u.description||"Marcar si es verdadero"})]}):u.maxLength>100||u.type==="string"&&!u.maxLength?r("textarea",{name:l,value:i[l]||"",onChange:b,required:w,placeholder:u.description||`Ingresa ${u.title||l}`,className:"w-full surface-input rounded-xl px-4 py-3 focus-elegant bg-transparent text-elegant placeholder-text-muted transition-all resize-none",rows:3,maxLength:u.maxLength}):r("input",{type:k,name:l,value:i[l]||"",onChange:b,required:w,placeholder:u.description||`Ingresa ${u.title||l}`,min:u.minimum,max:u.maximum,maxLength:u.maxLength,className:"w-full surface-input rounded-xl px-4 py-3 focus-elegant bg-transparent text-elegant placeholder-text-muted transition-all"})};return m?r("div",{className:"fixed inset-0 flex items-center justify-center bg-gradient-main/80 backdrop-blur-sm z-50",children:r("div",{className:"glass-card p-8 shadow-elegant-lg",children:r("div",{className:"flex items-center justify-center",children:[r("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent"}),r("span",{className:"ml-3 text-subtle",children:"Cargando formulario..."})]})})}):_?r("div",{className:"fixed inset-0 flex items-center justify-center bg-gradient-main/80 backdrop-blur-sm z-50",children:r("div",{className:"glass-card p-6 shadow-elegant-lg max-w-md w-full mx-4",children:r("div",{className:"text-center",children:[r("div",{className:"text-red-500 text-xl mb-2",children:"⚠️"}),r("h3",{className:"text-lg font-semibold text-elegant mb-2",children:"Error"}),r("p",{className:"text-subtle mb-4",children:_}),r("button",{onClick:n,className:"btn-secondary px-4 py-2 rounded-lg transition-colors",children:"Cerrar"})]})})}):r("div",{className:"fixed inset-0 flex items-center justify-center bg-gradient-main/80 backdrop-blur-sm z-50",children:r("div",{className:"glass-card rounded-xl shadow-elegant-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:r("form",{onSubmit:y,className:"flex flex-col h-full min-h-0",children:[r("div",{className:"px-6 py-4 border-b border-primary",children:[r("h3",{className:"text-xl font-semibold text-elegant",children:a.title||"Formulario Dinámico"}),a.description&&r("p",{className:"text-sm text-subtle mt-1",children:a.description})]}),r("div",{className:"flex-1 overflow-y-auto px-6 py-4 min-h-0 smart-form-scroll",children:r("div",{className:"space-y-6 pb-4",children:Object.keys(a.properties).map(l=>{var k;const u=a.properties[l],w=(k=a.required)==null?void 0:k.includes(l);return r("div",{className:"space-y-2",children:[r("label",{className:"block text-sm font-medium text-elegant",children:[u.title||l,w&&r("span",{className:"text-red-500 ml-1",children:"*"})]}),x(l,u),u.description&&u.type!=="boolean"&&r("p",{className:"text-xs text-muted",children:u.description})]},l)})})}),r("div",{className:"px-6 py-4 border-t border-primary surface-elevated",children:r("div",{className:"flex gap-3 justify-end",children:[r("button",{type:"button",onClick:n,disabled:f,className:"btn-glass px-4 py-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Cancelar"}),r("button",{type:"submit",disabled:f,className:"btn-primary px-6 py-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center",children:[f&&r("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),f?"Enviando...":"Enviar"]})]})})]})})})}function Fs({chatId:t}){var Zr;const{token:e}=hr(),{mode:s}=Mt(),[n,a]=C(!0),[o,i]=C(!1),[c,m]=C(!1),[h,_]=C([]),[d,f]=C(!1),[v,b]=C(""),[y,p]=C(""),[x,l]=C(null),[u,w]=C(!1),[k,O]=C(null),[D,H]=C(!1),A=at(null),{activeChatId:N,messages:S,isLoading:R,error:Z,setActiveChatId:j,createChat:Q,sendMessage:G,loadMessages:K,clearError:re,executeWorkflowDirect:Qe,saveWorkflowDirect:Qi,activateWorkflowDirect:Gi,clearMessagesForNewChat:ea}=we(),ta=()=>{var $;($=A.current)==null||$.scrollIntoView({behavior:"smooth"})};M(()=>{ta()},[S]),M(()=>{var q,L;console.log("🔄 RECOVERY: useEffect ejecutado!",{activeChatId:N,hasLastResponse:!!x,messagesCount:(S==null?void 0:S.length)||0});const $=S[N];if(N&&(!$||$.length===0)&&x){console.log("🧹 FRESH CHAT: Clearing contaminated cache for new chat:",N,{hasMessages:!!$,messageCount:($==null?void 0:$.length)||0,hasLastResponse:!!x}),N&&(localStorage.removeItem(`workflow_${N}`),console.log("🧹 FRESH CHAT: Removed localStorage cache for:",N)),l(null),O(null),w(!1);return}if(N&&!x){try{const U=localStorage.getItem(`workflow_${N}`);if(U){const Y=JSON.parse(U);console.log("🔄 RECOVERY: Found cached workflow for chat:",N,"- steps:",((q=Y.execution_plan)==null?void 0:q.length)||0),l({execution_plan:Y.execution_plan||[],workflow_created:!0,metadata:Y.metadata||{}}),console.log("🔄 RECOVERY: Workflow buttons habilitados desde cache"),fetch(`/api/chat/${N}/workflow-status`,{headers:{Authorization:`Bearer ${V()}`}}).then(ae=>ae.ok?ae.json():null).then(ae=>{ae&&(console.log("🔄 INITIAL SYNC: Real workflow state from backend:",ae),w(ae.is_active))}).catch(ae=>console.error("🔄 INITIAL SYNC: Error fetching real state:",ae));return}}catch(U){console.error("🔄 RECOVERY: Error loading workflow cache:",U)}if(S&&S.length>0){console.log("🔄 FALLBACK: Buscando execution_plan en mensajes existentes...",S.length,"mensajes"),S.forEach((U,Y)=>{var ae;U.role==="assistant"&&U.metadata&&console.log(`🔍 DEBUG: Mensaje ${Y}:`,{role:U.role,has_metadata:!!U.metadata,has_execution_plan:!!U.metadata.execution_plan,execution_plan_length:((ae=U.metadata.execution_plan)==null?void 0:ae.length)||0,metadata_keys:Object.keys(U.metadata)})});for(let U=S.length-1;U>=0;U--){const Y=S[U];if(Y.role==="assistant"&&((L=Y.metadata)!=null&&L.execution_plan)&&Y.metadata.execution_plan.length>0){console.log("🔄 FALLBACK: Encontrado execution_plan en mensaje:",Y.metadata.execution_plan.length,"pasos"),l({execution_plan:Y.metadata.execution_plan,workflow_created:!0,metadata:Y.metadata||{}});try{const ae={execution_plan:Y.metadata.execution_plan,workflow_created:!0,timestamp:Date.now(),metadata:Y.metadata};localStorage.setItem(`workflow_${N}`,JSON.stringify(ae)),console.log("🔄 FALLBACK: Cached execution_plan from message for future use")}catch(ae){console.error("🔄 FALLBACK: Error caching from message:",ae)}console.log("🔄 FALLBACK: Workflow buttons habilitados desde mensajes");break}}}}},[N,x,S]),M(()=>{var $;if(N&&!x&&S&&S.length>0){console.log("🔄 MESSAGES LOADED: Triggering recovery after messages loaded",S.length),console.log("🔄 FALLBACK: Buscando execution_plan en mensajes existentes...",S.length,"mensajes"),S.forEach((P,q)=>{var L;P.role==="assistant"&&P.metadata&&console.log(`🔍 DEBUG: Mensaje ${q}:`,{role:P.role,has_metadata:!!P.metadata,has_execution_plan:!!P.metadata.execution_plan,execution_plan_length:((L=P.metadata.execution_plan)==null?void 0:L.length)||0,metadata_keys:Object.keys(P.metadata)})});for(let P=S.length-1;P>=0;P--){const q=S[P];if(q.role==="assistant"&&(($=q.metadata)!=null&&$.execution_plan)&&q.metadata.execution_plan.length>0){console.log("🔄 FALLBACK: Encontrado execution_plan en mensaje:",q.metadata.execution_plan.length,"pasos"),l({execution_plan:q.metadata.execution_plan,workflow_created:!0,metadata:q.metadata||{}});try{const L={execution_plan:q.metadata.execution_plan,workflow_created:!0,timestamp:Date.now(),metadata:q.metadata};localStorage.setItem(`workflow_${N}`,JSON.stringify(L)),console.log("🔄 FALLBACK: Cached execution_plan from message for future use")}catch(L){console.error("🔄 FALLBACK: Error caching from message:",L)}console.log("🔄 FALLBACK: Workflow buttons habilitados desde mensajes");break}}}},[S,N,x]),M(()=>{(async()=>{if(!(!N||!e))try{console.log("🔍 LOADING WORKFLOWS like WorkflowCard for chat:",N);const P=await fetch("/api/flows",{headers:{Authorization:`Bearer ${V()}`}});if(P.ok){const q=await P.json();console.log("🔍 ALL WORKFLOWS:",q);const L=q.find(U=>U.chat_id===N);L?(console.log("🔍 FOUND MATCHING WORKFLOW:",L),O(L.flow_id),w(L.is_active)):(console.log("🔍 NO MATCHING WORKFLOW for chat_id:",N),O(null),w(!1))}else console.log("🔍 WORKFLOWS API ERROR:",P.status),O(null),w(!1)}catch(P){console.error("🔍 WORKFLOWS LOAD ERROR:",P),O(null),w(!1)}})()},[N,e]),M(()=>{const $=P=>{const{chatId:q,smartForm:L,backendData:U}=P.detail;q===N&&(console.log("🔍 CHATVIEW: Smart form ready event received:",L),b(null),f(!0))};return window.addEventListener("smartFormReady",$),()=>{window.removeEventListener("smartFormReady",$)}},[N]),M(()=>{const $=P=>{const{chatId:q,oauthRequirements:L,backendData:U}=P.detail;q===N&&(console.log("🔐 CHATVIEW: OAuth requirements detected event received:",{count:(L==null?void 0:L.length)||0,requirements:L}),_(L),m(!0))};return window.addEventListener("oauthRequirementsDetected",$),()=>{window.removeEventListener("oauthRequirementsDetected",$)}},[N]),M(()=>{(async()=>{if(!e){ie("/");return}a(!0),re();try{t?(j(t),await K(t)):(console.log("🆕 Iniciando chat temporal en /chat/ - limpiando estado anterior"),ea())}catch(P){console.error("Error initializing chat:",P)}finally{a(!1)}})()},[t,e]);const ot=async $=>{if(!$.trim())return;if(R){console.log("🚫 Message send blocked - already sending");return}p("");const P=N||t;if(!P){console.log("🆕 Chat temporal en /chat/ detectado, creando sesión real...");try{const L=await Q();if(L){const U=`/chat/${L.session_id}`;window.history.replaceState(null,"",U),console.log("✅ URL updated silently to:",U),j(L.session_id);const Y=await G(L.session_id,"user",$.trim());Y?l(Y):(console.error("Failed to send first message"),setError("Error enviando primer mensaje"));return}}catch(L){console.error("Error creando chat:",L),setError("Error creando nueva sesión de chat");return}}console.log("📤 Sending message to existing chat:",P);const q=await G(P,"user",$.trim());q?l(q):console.error("Failed to send message")},ra=async($,P)=>{console.log("🔐 CHATVIEW: OAuth completed for providers:",$),m(!1),_([]);const L=await G(N,"user","OAuth authentication completed successfully. Please continue with the workflow.");L&&l(L)},sa=($,P)=>{console.error("🔐 CHATVIEW: OAuth error:",$,P),m(!1),_([])},na=async $=>{var P;if(f(!1),v===null&&((P=window.smartFormContext)!=null&&P.isSmartForm))try{console.log("[ChatView] Submitting Smart Form with data:",$),console.log("[ChatView] Smart Form context:",window.smartFormContext);const q=`Completé la información requerida: ${JSON.stringify($)}`,L=await G(N,"user",q);L&&l(L),window.smartFormContext=null}catch(q){console.error("[ChatView] Error submitting Smart Form:",q),setError("Error enviando formulario")}finally{window.smartFormContext=null}};if(!e)return r("div",{className:"flex-1 flex items-center justify-center",children:r("div",{className:"text-center",children:[r("h2",{className:"text-xl font-bold mb-4",children:"Acceso Requerido"}),r("p",{className:"text-text-secondary mb-4",children:"Debes iniciar sesión para usar el chat"}),r("button",{onClick:()=>ie("/"),className:"btn-primary px-6 py-2 rounded-lg",children:"Ir al inicio"})]})});if(n)return r("div",{className:"flex-1 flex items-center justify-center",children:r("div",{className:"text-center",children:[r("div",{className:"animate-spin w-8 h-8 border-2 border-primary border-t-transparent rounded-full mx-auto mb-4"}),r("p",{className:"text-text-secondary",children:"Inicializando chat..."})]})});const Qt=N&&Array.isArray(S[N])?S[N]:[],Re=()=>{var L;const $=S[N];if(N&&(!$||$.length===0)&&x)return console.log("🔍 hasWorkflowData: Fresh chat detected with contaminated cache - returning false"),!1;const q=x&&x.execution_plan&&x.execution_plan.length>0;return console.log("🔍 hasWorkflowData check:",{hasLastResponse:!!x,hasExecutionPlan:!!(x!=null&&x.execution_plan),planLength:((L=x==null?void 0:x.execution_plan)==null?void 0:L.length)||0,result:q}),q};return r("div",{className:"flex flex-col h-screen bg-gradient-main",children:[r("div",{className:"glass border-b border-primary p-4",children:r("div",{className:"flex items-center justify-between",children:[r("div",{className:"flex items-center gap-3",children:r("div",{children:[r("button",{onClick:()=>ie("/workflows"),className:"text-lg font-bold text-text-primary hover:text-purple-400 transition-colors duration-200 cursor-pointer",children:"Asistente QYRAL"}),r("div",{className:"flex items-center gap-2 text-xs text-text-secondary",children:[r("div",{className:"status-dot status-active"}),"Disponible"]})]})}),r("div",{className:"flex items-center gap-2",children:[r("div",{className:"flex items-center gap-2",children:[r("span",{className:"text-xs font-medium text-text-secondary",children:"Modo:"}),r(wi,{})]}),s==="ai"&&r("div",{className:"flex items-center gap-2",children:[r("span",{className:"text-xs font-medium text-text-secondary",children:"Modelo:"}),r("div",{className:"min-w-[160px]",children:r(gi,{compact:!0})})]}),r("button",{className:"btn-glass px-2 py-1.5 rounded-lg text-xs font-medium",children:"Simular"}),r("button",{className:"btn-glass px-2 py-1.5 rounded-lg text-xs font-medium",children:"Métricas"}),r("button",{onClick:()=>i(!0),className:"btn-primary px-2 py-1.5 rounded-lg text-xs font-medium",children:"🔐 Creds"}),r("button",{onClick:async()=>{var $,P,q;if(!Re()){alert("Primero crea un workflow para poder guardarlo");return}try{H(!0),console.log("🔧 FIXED: Saving workflow with execution_plan:",x.execution_plan.length,"steps");const L=await fetch("/api/chat/workflow-decision",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`},body:JSON.stringify({decision:"save",chat_id:N,execution_plan:x.execution_plan})});if(!L.ok)throw new Error(`Error ${L.status}: ${await L.text()}`);const U=await L.json();console.log("✅ Workflow saved via direct API:",U);const Y=U.workflow_id||(($=U.metadata)==null?void 0:$.flow_id)||U.flow_id||U.id;if(console.log("🔧 FLOW_ID SEARCH:",{workflow_id:U.workflow_id,"metadata.flow_id":(P=U.metadata)==null?void 0:P.flow_id,flow_id:U.flow_id,id:U.id,found:Y}),Y){O(Y),console.log("🔧 FLOW_ID SET after save:",Y);try{const Gt=localStorage.getItem(`workflow_${N}`);if(Gt){const es=JSON.parse(Gt);es.flow_id=Y,localStorage.setItem(`workflow_${N}`,JSON.stringify(es)),console.log("🔧 CACHE: Updated cache with flow_id")}}catch(Gt){console.error("🔧 CACHE: Error updating cache:",Gt)}}else console.log("🔧 FLOW_ID MISSING: result keys:",Object.keys(U)),console.log("🔧 FLOW_ID MISSING: full result:",U);alert(Y?"✅ Workflow guardado correctamente! Ahora puedes activarlo con el toggle.":"✅ Workflow guardado correctamente!")}catch(L){console.error("🚨 SAVE ERROR DETAILS:",{message:L.message,stack:L.stack,name:L.name,activeChatId:N,hasExecutionPlan:!!(x!=null&&x.execution_plan),planLength:((q=x==null?void 0:x.execution_plan)==null?void 0:q.length)||0}),alert(`Error guardando workflow: ${L.message}`)}finally{H(!1)}},className:`btn-glass px-2 py-1.5 rounded-lg text-xs font-medium transition-all ${Re()?"hover:bg-white/20":"opacity-50 cursor-not-allowed"}`,disabled:!Re()||R||D,title:Re()?k?"Actualizar workflow existente":"Guardar workflow nuevo":"Crea un workflow primero",children:D?"⏳ Guardando...":"💾 Guardar"}),r("div",{className:"flex items-center gap-2",children:[r("span",{className:"text-xs text-text-secondary",children:"Estado:"}),r("div",{className:"flex items-center gap-1",children:[r("span",{className:`text-xs font-medium ${u?"text-green-400":"text-red-400"}`,children:u?"🟢":"🔴"}),r("label",{className:"relative inline-flex items-center cursor-pointer",children:[r("input",{type:"checkbox",checked:u,onChange:async()=>{if(console.log("🔧 TOGGLE CLICKED: currentFlowId =",k),!k){console.log("🔧 TOGGLE BLOCKED: No currentFlowId available"),alert("Primero GUARDA el workflow, luego podrás activarlo/desactivarlo");return}try{const $=!u;console.log("🔧 SIMPLE TOGGLE: Using flow_id:",k,"newState:",$),w($);const P=await fetch(`/api/flows/${k}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`},body:JSON.stringify({is_active:$})});if(!P.ok)throw w(!$),new Error(`Error ${P.status}: ${await P.text()}`);const q=await P.json();console.log("✅ SIMPLE TOGGLE SUCCESS:",q),w(q.is_active);const L=q.is_active?"activado":"desactivado"}catch($){console.error("🔧 SIMPLE TOGGLE ERROR:",$),w(!newState),alert(`Error ${newState?"activando":"desactivando"} workflow: ${$.message}`)}},disabled:!k||R,className:"sr-only peer"}),r("div",{className:`w-8 h-4 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:left-[1px] after:bg-white after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-purple-500 ${!k||R?"opacity-50 cursor-not-allowed":""}`})]})]})]}),r("button",{onClick:async()=>{if(!Re()){alert("Primero crea un workflow para poder ejecutarlo");return}try{console.log("🚀 DIRECT: Executing workflow with execution_plan:",x.execution_plan.length,"steps"),await Qe(N,x.execution_plan)}catch($){console.error("Error ejecutando workflow:",$),alert("Error ejecutando workflow")}},className:`btn-glass px-2 py-1.5 rounded-lg text-xs font-medium transition-all ${Re()?"hover:bg-blue-500/20":"opacity-50 cursor-not-allowed"}`,disabled:!Re()||R,title:Re()?"Ejecutar workflow ahora":"Crea un workflow primero",children:"⚡ Ejecutar"}),R&&r("div",{className:"flex items-center gap-2 text-text-secondary",children:[r("div",{className:"animate-spin w-4 h-4 border-2 border-primary border-t-transparent rounded-full"}),r("span",{className:"text-sm",children:"Procesando..."})]})]})]})}),r("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[Z&&r("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-4 mb-4",children:[r("div",{className:"flex items-center gap-2",children:[r("span",{className:"text-red-400",children:"⚠️"}),r("span",{className:"text-red-400 font-medium",children:"Error:"}),r("span",{className:"text-text-primary",children:Z})]}),r("button",{onClick:re,className:"mt-2 text-sm text-red-400 hover:text-red-300 underline",children:"Cerrar"})]}),Qt.length===0&&!R?r("div",{className:"flex flex-col items-center justify-center text-center py-6",children:[r("div",{className:"w-16 h-16 surface-elevated rounded-2xl flex items-center justify-center mb-4 opacity-80",children:r("img",{src:"/logo.svg",alt:"QYRAL Logo",className:"w-12 h-12",style:{filter:"none"}})}),r("h3",{className:"text-xl font-bold gradient-text mb-2",children:"¡Hola! Soy tu asistente de automatización"}),r("p",{className:"text-text-secondary max-w-md text-sm leading-relaxed mb-6",children:"Describe lo que quieres automatizar y yo te ayudo a configurarlo paso a paso"}),r("div",{className:"grid grid-cols-2 gap-3 max-w-lg w-full mb-4",children:[r("div",{onClick:()=>ot("Quiero automatizar el envío de emails cuando reciba nuevos leads"),className:"glass-light p-3 rounded-xl cursor-pointer hover:scale-105 transition-all duration-200 text-left",children:[r("div",{className:"text-lg mb-1",children:"📧"}),r("div",{className:"font-medium text-text-primary text-sm mb-1",children:"Email Automation"}),r("div",{className:"text-xs text-text-secondary",children:"Emails automáticos para nuevos leads"})]}),r("div",{onClick:()=>ot("Ayúdame a conectar Slack con Google Drive para notificaciones"),className:"glass-light p-3 rounded-xl cursor-pointer hover:scale-105 transition-all duration-200 text-left",children:[r("div",{className:"text-lg mb-1",children:"🔗"}),r("div",{className:"font-medium text-text-primary text-sm mb-1",children:"App Integration"}),r("div",{className:"text-xs text-text-secondary",children:"Conecta Slack con Google Drive"})]}),r("div",{onClick:()=>ot("Quiero programar reportes automáticos cada lunes"),className:"glass-light p-3 rounded-xl cursor-pointer hover:scale-105 transition-all duration-200 text-left",children:[r("div",{className:"text-lg mb-1",children:"📊"}),r("div",{className:"font-medium text-text-primary text-sm mb-1",children:"Scheduled Reports"}),r("div",{className:"text-xs text-text-secondary",children:"Reportes automáticos semanales"})]}),r("div",{onClick:()=>ot("Ayúdame a automatizar la gestión de mi calendario"),className:"glass-light p-3 rounded-xl cursor-pointer hover:scale-105 transition-all duration-200 text-left",children:[r("div",{className:"text-lg mb-1",children:"📅"}),r("div",{className:"font-medium text-text-primary text-sm mb-1",children:"Calendar Management"}),r("div",{className:"text-xs text-text-secondary",children:"Automatiza tu calendario"})]})]}),r("div",{className:"text-xs text-text-secondary opacity-60",children:"O escribe tu propia idea de automatización abajo ↓"})]}):r(X,{children:[Qt.map(($,P)=>r("div",{className:`flex gap-4 items-start animate-fadeInUp ${$.role==="user"?"flex-row-reverse":""}`,children:[r("div",{className:`w-9 h-9 rounded-xl flex items-center justify-center text-sm font-semibold flex-shrink-0 ${$.role==="user"?"surface-elevated text-white":"glass text-accent"}`,children:$.role==="user"?"TÚ":"AI"}),r("div",{className:`max-w-[70%] ${$.role==="user"?"glass surface-elevated border-accent":"glass-light"} p-4 rounded-2xl transition-all duration-300 hover:transform hover:scale-[1.02]`,children:[r("div",{className:"text-text-primary leading-relaxed whitespace-pre-wrap",children:$.content}),r("div",{className:"text-xs text-text-muted mt-2 flex items-center justify-between",children:[r("span",{children:new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})}),$.isTemp&&r("span",{className:"ml-2 text-yellow-500",children:"⏳"})]})]})]},$.id)),r("div",{ref:A})]}),R&&r("div",{className:"flex gap-4 items-start animate-fadeInUp",children:[r("div",{className:"w-9 h-9 rounded-xl flex items-center justify-center text-sm font-semibold flex-shrink-0 glass text-accent",children:"AI"}),r("div",{className:"max-w-[70%] glass-light p-4 rounded-2xl transition-all duration-300",children:[r("div",{className:"text-text-primary leading-relaxed flex items-center gap-3",children:[r("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-accent"}),Qt.length===0?"Creando workflow...":"Procesando solicitud..."]}),r("div",{className:"text-xs text-text-muted mt-2",children:new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})})]})]})]}),r("div",{className:"glass border-t border-primary p-4 bg-gradient-to-r from-glass-dark to-glass-medium",children:r("div",{className:"flex gap-3 items-end",children:r("div",{className:"flex-1 relative",children:[r("textarea",{value:y,onChange:$=>p($.target.value),onKeyDown:$=>{$.key==="Enter"&&!$.shiftKey&&($.preventDefault(),ot(y))},placeholder:Qt.length===0?"💡 ¡Empieza aquí! Describe qué quieres automatizar...":"💬 Continúa la conversación o ajusta tu automatización...",rows:1,className:"w-full glass-light rounded-xl px-4 py-3 pr-12 text-sm resize-none focus-ring bg-transparent text-text-primary placeholder-text-secondary min-h-[48px] max-h-[120px] border-2 border-primary focus:border-accent",style:{scrollbarWidth:"none"}}),r("button",{onClick:()=>ot(y),disabled:!y.trim()||R,className:"absolute right-2 top-1/2 transform -translate-y-1/2 btn-primary w-10 h-10 rounded-lg flex items-center justify-center text-lg disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:R?"⏳":"🚀"})]})})}),r(Xr,{isOpen:o,onClose:()=>i(!1),chatId:N||t}),c&&r(_i,{oauthRequirements:h,chatId:N||t,onAllCompleted:ra,onError:sa}),d&&r(ki,{schemaEndpoint:v,smartFormSchema:v===null?(Zr=window.smartFormContext)==null?void 0:Zr.formSchema:null,onSubmit:na,onCancel:()=>f(!1)})]})}function Si({flowId:t}){const[e,s]=C([]),[n,a]=C(!1),[o,i]=C("");return M(()=>{t&&(a(!0),i(""),W(`/api/executions/flow/${t}`,{method:"GET"}).then(c=>{s(c)}).catch(c=>{console.error("Error fetching executions:",c),i("No se pudo cargar las ejecuciones")}).finally(()=>a(!1)))},[t]),n?r("div",{children:"Cargando ejecuciones..."}):o?r("div",{className:"text-red-500",children:o}):e.length===0?r("div",{children:"No hay ejecuciones para este flujo."}):r("div",{className:"p-4 bg-white rounded shadow",children:[r("h2",{className:"text-xl font-semibold mb-4",children:"Historial de Ejecuciones"}),r("table",{className:"w-full table-auto border-collapse",children:[r("thead",{children:r("tr",{className:"bg-gray-100",children:[r("th",{className:"border px-2 py-1 text-left",children:"Inició"}),r("th",{className:"border px-2 py-1 text-left",children:"Finalizó"}),r("th",{className:"border px-2 py-1 text-left",children:"Estado"}),r("th",{className:"border px-2 py-1 text-center",children:"Acciones"})]})}),r("tbody",{children:e.map(c=>r("tr",{children:[r("td",{className:"border px-2 py-1",children:new Date(c.started_at).toLocaleString()}),r("td",{className:"border px-2 py-1",children:c.ended_at?new Date(c.ended_at).toLocaleString():"—"}),r("td",{className:"border px-2 py-1 capitalize",children:c.status}),r("td",{className:"border px-2 py-1 text-center",children:r(ge,{href:`#/executions/${c.execution_id}`,className:"text-blue-500 underline",children:"Ver detalle"})})]},c.execution_id))})]})]})}function Ei({executionId:t}){const[e,s]=C(null),[n,a]=C([]),[o,i]=C(!1),[c,m]=C("");return M(()=>{if(!t){m("Execution ID missing");return}i(!0),m(""),W(`/api/executions/${t}`,{method:"GET"}).then(h=>{s(h.execution),a(h.steps)}).catch(h=>{console.error("Error fetching execution detail:",h),m("No se pudo cargar el detalle de la ejecución")}).finally(()=>i(!1))},[t]),o?r("div",{children:"Cargando detalle..."}):c?r("div",{className:"text-red-500",children:c}):e?r("div",{className:"p-4 bg-white rounded shadow",children:[r("button",{className:"mb-4 text-blue-500 underline",onClick:()=>ie(`/flows/${e.flow_id}/executions`),children:"← Volver al historial"}),r("h2",{className:"text-xl font-semibold mb-2",children:["Ejecución ",e.execution_id]}),r("ul",{className:"mb-4",children:[r("li",{children:[r("strong",{children:"Flujo:"})," ",e.flow_id]}),r("li",{children:[r("strong",{children:"Estado:"})," ",e.status]}),r("li",{children:[r("strong",{children:"Inició:"})," ",new Date(e.started_at).toLocaleString()]}),r("li",{children:[r("strong",{children:"Finalizó:"})," ",e.ended_at?new Date(e.ended_at).toLocaleString():"—"]}),e.cost!=null&&r("li",{children:[r("strong",{children:"Costo:"})," ",e.cost]}),e.error&&r("li",{className:"text-red-600",children:[r("strong",{children:"Error:"})," ",e.error]})]}),r("h3",{className:"text-lg font-semibold mb-2",children:"Pasos de ejecución"}),r("table",{className:"w-full table-auto border-collapse",children:[r("thead",{children:r("tr",{className:"bg-gray-100",children:[r("th",{className:"border px-2 py-1",children:"Nodo"}),r("th",{className:"border px-2 py-1",children:"Acción"}),r("th",{className:"border px-2 py-1",children:"Estado"}),r("th",{className:"border px-2 py-1",children:"Inició"}),r("th",{className:"border px-2 py-1",children:"Finalizó"}),r("th",{className:"border px-2 py-1",children:"Error"})]})}),r("tbody",{children:n.map(h=>r("tr",{children:[r("td",{className:"border px-2 py-1",children:h.node_id}),r("td",{className:"border px-2 py-1",children:h.action_id}),r("td",{className:"border px-2 py-1 capitalize",children:h.status}),r("td",{className:"border px-2 py-1",children:new Date(h.started_at).toLocaleString()}),r("td",{className:"border px-2 py-1",children:h.ended_at?new Date(h.ended_at).toLocaleString():"—"}),r("td",{className:"border px-2 py-1 text-red-600",children:h.error||"—"})]},h.step_id))})]})]}):r("div",{children:"Ejecución no encontrada."})}function Ai(){return W("/api/marketplace/templates",{method:"GET"})}function Oi(t){return W("/api/marketplace/install?template_id="+t,{method:"POST"})}function $i(){return So({queryKey:["marketplace","templates"],queryFn:Ai})}function Ri(){const t=ir(e=>e.add);return Fn({mutationFn:e=>Oi(e),onSuccess:()=>{t({type:"success",message:"Plantilla instalada"})}})}function Ti(){const{data:t=[]}=$i(),e=Ri();return r("div",{className:"p-6 bg-gray-100 min-h-screen",children:[r("h1",{className:"text-3xl font-bold mb-6",children:"Marketplace"}),r("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(s=>r("div",{className:"bg-white p-4 rounded shadow",children:[r("h2",{className:"text-lg font-semibold mb-1",children:s.name}),r("p",{className:"text-sm text-gray-500",children:s.category}),r("p",{className:"text-gray-700 mb-2 line-clamp-2",children:s.description}),r("button",{onClick:()=>e.mutate(s.template_id),className:"bg-purple hover:bg-purple-hover text-white px-2 py-1 rounded",children:"Instalar"})]},s.template_id))})]})}const Vn=()=>{const[t,e]=C([]),[s,n]=C(!1),[a,o]=C(null),i=async()=>{try{n(!0),o(null),console.log("🔍 Fetching workflows...");const x=V();console.log("🔍 Token exists:",!!x);const l=await fetch("/api/flows",{headers:{Authorization:`Bearer ${x}`},signal:AbortSignal.timeout(1e4)});if(console.log("🔍 Response status:",l.status),!l.ok){const w=await l.text();throw console.error("🔍 Error response:",w),new Error(`Error ${l.status}: ${w}`)}const u=await l.json();return console.log("🔍 Workflows data:",u),e(u),u}catch(x){return console.error("🔍 Fetch workflows error:",x),o(x.message),[]}finally{n(!1)}},c=async x=>{try{n(!0),o(null);const l=await fetch("/api/flows/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`},body:JSON.stringify(x)});if(!l.ok)throw new Error(`Error ${l.status}: ${await l.text()}`);const u=await l.json();return e(w=>[...w,u]),u}catch(l){throw o(l.message),l}finally{n(!1)}},m=async x=>{try{const l=await fetch(`/api/flows/${x}?includeSpec=true`,{headers:{Authorization:`Bearer ${V()}`}});if(!l.ok)throw new Error(`Error ${l.status}: ${await l.text()}`);return await l.json()}catch(l){return o(l.message),null}},h=async(x,l)=>{try{n(!0),o(null),e(k=>k.map(O=>O.flow_id===x?{...O,is_active:l}:O));const u=await fetch(`/api/flows/${x}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`},body:JSON.stringify({is_active:l})});if(!u.ok)throw e(k=>k.map(O=>O.flow_id===x?{...O,is_active:!l}:O)),new Error(`Error ${u.status}: ${await u.text()}`);const w=await u.json();return console.log("🔧 HOOK: toggleWorkflowActive response:",w),e(k=>{const O=k.map(D=>D.flow_id===x?{...D,is_active:w.is_active}:D);return console.log("🔧 HOOK: Confirmed state:",O.find(D=>D.flow_id===x)),O}),w}catch(u){throw o(u.message),u}finally{n(!1)}},_=async(x,l={})=>{try{n(!0),o(null);const u=await fetch(`/api/flows/${x}/run-now`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`}});if(!u.ok)throw new Error(`Error ${u.status}: ${await u.text()}`);return await u.json()}catch(u){throw o(u.message),u}finally{n(!1)}},d=async x=>{try{o(null);const l=await fetch(`/api/flows/${x}`,{method:"DELETE",headers:{Authorization:`Bearer ${V()}`}});if(!l.ok)throw new Error(`Error ${l.status}: ${await l.text()}`);return e(u=>u.filter(w=>w.flow_id!==x)),await l.json()}catch(l){throw o(l.message),l}},f=x=>{const l=[];return(!x||typeof x!="object")&&l.push("Especificación de workflow inválida"),(!x.steps||!Array.isArray(x.steps)||x.steps.length===0)&&l.push("El workflow debe tener al menos un paso"),x.steps&&x.steps.forEach((u,w)=>{u.node_id||l.push(`Paso ${w+1}: falta node_id`),u.action_id||l.push(`Paso ${w+1}: falta action_id`)}),{isValid:l.length===0,errors:l}},v=(x,l=[])=>{if(!x)return`Workflow ${new Date().toLocaleString()}`;let w=x.trim().split(" ").slice(0,4).join(" ");if(l.length>0){const k=new Set(l.map(O=>O.node_id||O.name)).size;w+=` (${k} servicios)`}return w.length>50&&(w=w.substring(0,47)+"..."),w},b=async(x,l)=>{try{n(!0),o(null);const u=await fetch("/api/chat/workflow-decision",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`},body:JSON.stringify({decision:"save",chat_id:l,workflow_context:{workflow_data:x}})});if(!u.ok)throw new Error(`Error ${u.status}: ${await u.text()}`);const w=await u.json();if(!w.success)throw new Error(w.message||"Failed to save workflow");return await i(),{...w,workflow_id:w.workflow_id}}catch(u){throw o(u.message),u}finally{n(!1)}},y=async(x,l)=>{try{n(!0),o(null);const u=await fetch("/api/chat/workflow-decision",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`},body:JSON.stringify({decision:"activate",chat_id:l,workflow_context:{workflow_data:x}})});if(!u.ok)throw new Error(`Error ${u.status}: ${await u.text()}`);const w=await u.json();if(!w.success)throw new Error(w.message||"Failed to activate workflow");return await i(),w}catch(u){throw o(u.message),u}finally{n(!1)}},p=async(x,l)=>{try{n(!0),o(null);const u=await fetch("/api/chat/workflow-decision",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`},body:JSON.stringify({decision:"execute",chat_id:l,workflow_context:{workflow_data:x}})});if(!u.ok)throw new Error(`Error ${u.status}: ${await u.text()}`);const w=await u.json();if(!w.success)throw new Error(w.message||"Failed to execute workflow");return w}catch(u){throw o(u.message),u}finally{n(!1)}};return M(()=>{i()},[]),{workflows:t,loading:s,error:a,fetchWorkflows:i,createWorkflow:c,getWorkflow:m,toggleWorkflowActive:h,runWorkflow:_,deleteWorkflow:d,createWorkflowViaBridge:b,activateWorkflowViaBridge:y,executeWorkflowViaBridge:p,validateWorkflowSpec:f,generateWorkflowName:v}};function Li({flow:t,onDelete:e}){const[s,n]=C(!1),[a,o]=C(!1),[i,c]=C(!1),[m,h]=C(!1),[_,d]=C(t.is_active),{toggleWorkflowActive:f,runWorkflow:v,deleteWorkflow:b,workflows:y}=Vn();M(()=>{const u=y.find(w=>w.flow_id===t.flow_id);u&&d(u.is_active)},[y,t.flow_id]);const p=async()=>{try{n(!0);const u=!_;console.log("🔧 TOGGLE: Before toggle - localIsActive:",_),d(u);const w=await f(t.flow_id,u);console.log("🔧 TOGGLE: After toggle - result:",w)}catch(u){console.error("Error toggling workflow:",u),d(!newState),alert(`Error ${_?"desactivando":"activando"} workflow: ${u.message}`)}finally{n(!1)}},x=async()=>{try{o(!0);const u=await v(t.flow_id);console.log("Workflow execution result:",u),alert("✅ Workflow ejecutado correctamente!")}catch(u){console.error("Error running workflow:",u),alert(`❌ Error ejecutando workflow: ${u.message}`)}finally{o(!1)}},l=async()=>{try{c(!0),await(e||b)(t.flow_id),h(!1)}catch(u){console.error("Error deleting workflow:",u),alert(`❌ Error eliminando workflow: ${u.message}`),c(!1)}};return r("div",{className:"glass rounded-2xl p-6 hover:scale-105 transition-all duration-300 border border-purple-500/20",children:[r("div",{className:"flex justify-between items-start mb-4",children:[r("div",{className:"flex-1",children:[r("h2",{className:"text-xl font-bold text-text-primary mb-1 truncate",children:t.name}),t.chat_title&&r("p",{className:"text-sm text-text-secondary truncate",children:["📝 ",t.chat_title]})]}),r("button",{onClick:()=>h(!0),disabled:i,className:`p-2 rounded-lg transition-colors ml-2 ${i?"text-gray-500 cursor-not-allowed":"text-red-400 hover:text-red-300 hover:bg-red-500/10"}`,title:i?"Eliminando...":"Eliminar workflow",children:i?"🔄":"🗑️"})]}),r("div",{className:"flex items-center justify-between mb-6",children:[r("span",{className:"text-text-secondary font-medium",children:"Estado:"}),r("div",{className:"flex items-center gap-2",children:[r("span",{className:`text-sm font-medium ${_?"text-green-400":"text-red-400"}`,children:_?"🟢 Activo":"🔴 Inactivo"}),r("label",{className:"relative inline-flex items-center cursor-pointer",children:[r("input",{type:"checkbox",checked:_,onChange:p,disabled:s,className:"sr-only peer"}),r("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-500"})]})]})]}),r("button",{onClick:x,disabled:a,className:"w-full btn-primary py-3 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:a?"⏳ Ejecutando...":"▶️ Ejecutar Ahora"}),m&&r("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:r("div",{className:"glass rounded-2xl p-6 max-w-md mx-4",children:[r("h3",{className:"text-xl font-bold text-text-primary mb-4",children:"⚠️ Confirmar eliminación"}),r("p",{className:"text-text-secondary mb-6",children:"¿Estás seguro de que quieres eliminar este workflow? Esta acción también eliminará el chat asociado y no se puede deshacer."}),r("div",{className:"flex gap-3",children:[r("button",{onClick:()=>h(!1),className:"flex-1 btn-glass py-2 rounded-lg",children:"Cancelar"}),r("button",{onClick:l,disabled:i,className:`flex-1 py-2 rounded-lg font-medium transition-colors ${i?"bg-gray-500 cursor-not-allowed text-gray-300":"bg-red-500 hover:bg-red-600 text-white"}`,children:i?"🔄 Eliminando...":"Eliminar"})]})]})})]})}function Di({flows:t,onDeleteWorkflow:e}){return!t||t.length===0?r("div",{className:"text-center p-4 text-gray-500",children:"No tienes workflows aún."}):r("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(s=>r(Li,{flow:s,onDelete:e},s.flow_id))})}function Pi(){const{token:t}=hr(),e=!!t;if(M(()=>{if(!e){ie("/",!0);return}},[e]),!e)return null;const{workflows:s,loading:n,error:a,deleteWorkflow:o}=Vn(),[i,c]=C(!1),[m,h]=C(!1),_=()=>{if(!m){h(!0);try{ie("/chat",!0)}catch(d){console.error("Error navegando a nuevo chat:",d),alert("Error iniciando nuevo workflow. Por favor intenta de nuevo.")}finally{h(!1)}}};return n?r("div",{className:"min-h-screen bg-gradient-main flex items-center justify-center",children:r("div",{className:"text-center",children:[r("div",{className:"w-16 h-16 bg-gradient-purple rounded-3xl flex items-center justify-center text-3xl mx-auto mb-4",children:"⚡"}),r("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto mb-4"}),r("p",{className:"text-text-secondary",children:"Cargando workflows..."})]})}):a?r("div",{className:"min-h-screen bg-gradient-main flex items-center justify-center",children:r("div",{className:"glass rounded-3xl p-8 text-center max-w-md",children:[r("div",{className:"w-16 h-16 bg-red-500/20 rounded-2xl flex items-center justify-center text-3xl mx-auto mb-4",children:"⚠️"}),r("h3",{className:"text-xl font-bold text-text-primary mb-2",children:"Error al cargar workflows"}),r("p",{className:"text-text-secondary mb-6",children:a}),r("button",{onClick:()=>window.location.reload(),className:"btn-primary px-6 py-3 rounded-lg font-medium",children:"🔄 Reintentar"})]})}):r("div",{className:"min-h-screen bg-gradient-main text-text-primary",children:r("div",{className:"max-w-7xl mx-auto px-6 py-10",children:[r("div",{className:"glass border-b border-purple-500/20 p-6 rounded-t-3xl mb-8",children:r("div",{className:"flex justify-between items-center",children:[r("div",{className:"flex items-center gap-4",children:[r("div",{className:"w-12 h-12 bg-gradient-purple rounded-xl flex items-center justify-center text-2xl",children:"🚀"}),r("div",{children:[r("h1",{className:"text-3xl font-bold gradient-text",children:"Mis Workflows"}),r("p",{className:"text-text-secondary",children:"Gestiona y crea tus automatizaciones"})]})]}),r("div",{className:"flex items-center gap-3",children:[r("button",{onClick:()=>c(!0),className:"btn-glass px-4 py-2 rounded-lg font-medium",children:"🔐 Gestionar Credenciales"}),r("button",{onClick:_,disabled:m,className:"btn-primary px-4 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:m?"⏳ Creando...":"➕ Crear Workflow"})]})]})}),s.length===0?r("div",{className:"glass rounded-3xl p-12 text-center",children:[r("div",{className:"w-24 h-24 bg-gradient-purple rounded-3xl flex items-center justify-center text-4xl mb-6 opacity-80 mx-auto",children:"💾"}),r("h3",{className:"text-2xl font-bold gradient-text mb-3",children:"No tienes workflows guardados"}),r("p",{className:"text-text-secondary max-w-md mx-auto leading-relaxed mb-4",children:"Los workflows son automatizaciones completadas y guardadas que puedes reutilizar."}),r("div",{className:"bg-blue-500/10 border border-blue-400/30 rounded-xl p-4 mb-8 text-left max-w-lg mx-auto",children:[r("h4",{className:"text-blue-300 font-semibold mb-2",children:"💡 ¿Cómo crear workflows?"}),r("ol",{className:"text-sm text-text-secondary space-y-1",children:[r("li",{children:"1. Crea un chat nuevo desde el sidebar izquierdo"}),r("li",{children:"2. Describe tu automatización en lenguaje natural"}),r("li",{children:"3. QYRAL AI configurará los pasos automáticamente"}),r("li",{children:"4. Al finalizar, guarda el workflow para reutilizarlo"})]})]}),r("button",{onClick:_,disabled:m,className:"btn-primary px-8 py-4 rounded-2xl font-bold text-lg shadow-purple-lg hover:transform hover:scale-105 transition-all duration-300 inline-flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:m?r(X,{children:"⏳ Abriendo chat..."}):r(X,{children:"💬 Abrir Chat para Crear Workflow"})})]}):r(Di,{flows:s,onDeleteWorkflow:o}),r(Xr,{isOpen:i,onClose:()=>c(!1)})]})})}function Mi({agent:t,onUpdate:e}){var h;const[s,n]=C(null),[a,o]=C(!1);M(()=>{i()},[t.agent_id]);const i=async()=>{try{o(!0);const _=await ci(t.agent_id);n(_)}catch(_){console.error("Error loading agent stats:",_)}finally{o(!1)}},c=_=>{switch(_==null?void 0:_.toLowerCase()){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-gray-100 text-gray-800";case"error":return"bg-red-100 text-red-800";default:return"bg-blue-100 text-blue-800"}},m=_=>_?new Date(_).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"Nunca";return r("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[r("div",{className:"flex justify-between items-start mb-4",children:r("div",{className:"flex-1",children:[r("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:t.name}),r("div",{className:"flex items-center gap-2 mb-2",children:[r("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${c(t.status)}`,children:t.status}),r("span",{className:"text-xs text-gray-500",children:t.model})]})]})}),r("div",{className:"space-y-2 mb-4",children:[r("div",{className:"text-sm",children:[r("span",{className:"text-gray-500",children:"Tools:"}),r("span",{className:"ml-1 text-gray-700",children:[((h=t.tools)==null?void 0:h.length)||0," herramientas"]})]}),r("div",{className:"text-sm",children:[r("span",{className:"text-gray-500",children:"Temperature:"}),r("span",{className:"ml-1 text-gray-700",children:t.temperature})]}),r("div",{className:"text-sm",children:[r("span",{className:"text-gray-500",children:"Max Iterations:"}),r("span",{className:"ml-1 text-gray-700",children:t.max_iterations})]})]}),r("div",{className:"border-t pt-4 mb-4",children:r("div",{className:"text-center",children:r("div",{className:"text-sm text-gray-500",children:"Agente configurado"})})}),r("div",{className:"flex gap-2",children:[r(ge,{href:`#/agents/${t.agent_id}`,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white text-center py-2 px-3 rounded text-sm transition-colors",children:"Ver Detalles"}),r(ge,{href:`#/agents/${t.agent_id}/runs`,className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 text-center py-2 px-3 rounded text-sm transition-colors",children:"Historial"})]}),r("div",{className:"mt-3 pt-3 border-t",children:r("div",{className:"text-xs text-gray-500",children:["Creado: ",m(t.created_at)]})})]})}function ji(){const[t,e]=C([]),[s,n]=C(!0),[a,o]=C("");M(()=>{i()},[]);const i=async()=>{try{n(!0),o("");const c=await oi();e(c)}catch(c){console.error("Error loading agents:",c),o("No se pudieron cargar los agentes")}finally{n(!1)}};return s?r("div",{className:"flex justify-center items-center min-h-64",children:r("div",{className:"text-gray-600",children:"Cargando agentes..."})}):a?r("div",{className:"p-6",children:[r("div",{className:"text-red-500 mb-4",children:a}),r("button",{onClick:i,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded",children:"Reintentar"})]}):r("div",{className:"p-6",children:[r("div",{className:"flex justify-between items-center mb-6",children:[r("h1",{className:"text-2xl font-bold",children:"AI Agents"}),r("div",{className:"text-sm text-gray-600",children:[t.length," agente",t.length!==1?"s":""," total",t.length!==1?"es":""]})]}),t.length===0?r("div",{className:"text-center py-12",children:[r("div",{className:"text-gray-500 mb-4",children:"No hay agentes creados"}),r("p",{className:"text-sm text-gray-400 mb-6",children:"Los agentes son creados automáticamente cuando QYRAL AI diseña una automatización que los requiere."})]}):r("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(c=>r(Mi,{agent:c,onUpdate:i},c.agent_id))})]})}function Fi({agentId:t}){const[e,s]=C([]),[n,a]=C(!0),[o,i]=C(""),[c,m]=C(1),[h,_]=C(!0),[d,f]=C("");M(()=>{t&&v(1,!0)},[t,d]);const v=async(l=1,u=!1)=>{try{a(!0),u&&i("");const w=await li(t,l,20,d||void 0);s(u?w.runs||[]:k=>[...k,...w.runs||[]]),_((w.runs||[]).length===20),m(l)}catch(w){console.error("Error loading runs:",w),i("No se pudieron cargar las ejecuciones")}finally{a(!1)}},b=()=>{!n&&h&&v(c+1,!1)},y=l=>{switch(l){case"succeeded":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"running":return"bg-blue-100 text-blue-800";case"queued":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},p=l=>new Date(l).toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),x=(l,u)=>{if(!u)return"—";const w=new Date(u)-new Date(l),k=Math.floor(w/6e4),O=Math.floor(w%6e4/1e3);return`${k}m ${O}s`};return n&&e.length===0?r("div",{className:"flex justify-center items-center min-h-32",children:r("div",{className:"text-gray-600",children:"Cargando ejecuciones..."})}):r("div",{className:"space-y-4",children:[r("div",{className:"bg-white p-4 rounded-lg shadow",children:r("div",{className:"flex items-center gap-4",children:[r("label",{className:"text-sm font-medium text-gray-700",children:"Filtrar por estado:"}),r("select",{value:d,onChange:l=>f(l.target.value),className:"border border-gray-300 rounded px-3 py-1 text-sm",children:[r("option",{value:"",children:"Todos"}),r("option",{value:"succeeded",children:"Exitosas"}),r("option",{value:"failed",children:"Fallidas"}),r("option",{value:"running",children:"Ejecutando"}),r("option",{value:"queued",children:"En Cola"})]})]})}),r("div",{className:"bg-white rounded-lg shadow",children:[o&&r("div",{className:"p-4 text-red-500 border-b",children:[o,r("button",{onClick:()=>v(1,!0),className:"ml-2 text-blue-500 hover:underline",children:"Reintentar"})]}),e.length===0&&!n?r("div",{className:"p-8 text-center text-gray-500",children:"No hay ejecuciones para este agente"}):r("div",{className:"overflow-x-auto",children:r("table",{className:"w-full",children:[r("thead",{className:"bg-gray-50",children:r("tr",{children:[r("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Objetivo"}),r("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),r("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Iniciado"}),r("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Duración"}),r("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Resultado"})]})}),r("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(l=>r("tr",{className:"hover:bg-gray-50",children:[r("td",{className:"px-4 py-4",children:r("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:l.goal||"Sin objetivo específico"})}),r("td",{className:"px-4 py-4",children:r("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${y(l.status)}`,children:l.status})}),r("td",{className:"px-4 py-4 text-sm text-gray-500",children:p(l.created_at)}),r("td",{className:"px-4 py-4 text-sm text-gray-500",children:x(l.created_at,l.updated_at)}),r("td",{className:"px-4 py-4 text-sm text-gray-500 max-w-xs",children:[l.error&&r("div",{className:"text-red-600 truncate",title:l.error,children:["Error: ",l.error]}),l.result&&!l.error&&r("div",{className:"text-green-600 truncate",children:"✓ Completado"}),!l.result&&!l.error&&l.status==="running"&&r("div",{className:"text-blue-600",children:"En progreso..."})]})]},l.run_id))})]})}),h&&e.length>0&&r("div",{className:"p-4 border-t text-center",children:r("button",{onClick:b,disabled:n,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300 text-white px-4 py-2 rounded text-sm",children:n?"Cargando...":"Cargar Más"})})]})]})}function Ii({analytics:t}){var h;const[e,s]=C("success");if(!t||!t.daily_stats)return r("div",{className:"bg-white rounded-lg shadow p-6",children:r("div",{className:"text-gray-500",children:"No hay datos de análisis disponibles"})});const{daily_stats:n,statistics:a}=t,o=Math.max(...n.map(_=>_.total_runs),1),i=100,c=_=>new Date(_).toLocaleDateString("es-ES",{month:"short",day:"numeric"}),m=(_,d,f,v)=>r("div",{className:"flex items-end justify-between h-48 px-2 py-4 bg-gray-50",children:_.map((b,y)=>{const p=f(b),x=d>0?p/d*100:0;return r("div",{className:"flex flex-col items-center flex-1 max-w-12",children:[r("div",{className:`w-full ${v} rounded-t transition-all duration-300 hover:opacity-80`,style:{height:`${x}%`,minHeight:p>0?"4px":"0px"},title:`${c(b.date)}: ${p}`}),r("div",{className:"text-xs text-gray-500 mt-2 text-center",children:c(b.date)})]},y)})});return r("div",{className:"space-y-6",children:[r("div",{className:"bg-white rounded-lg shadow p-6",children:[r("div",{className:"flex justify-between items-center mb-4",children:[r("h3",{className:"text-lg font-semibold",children:"Análisis de Rendimiento"}),r("div",{className:"flex gap-2",children:[r("button",{onClick:()=>s("success"),className:`px-3 py-1 rounded text-sm ${e==="success"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Tasa de Éxito"}),r("button",{onClick:()=>s("runs"),className:`px-3 py-1 rounded text-sm ${e==="runs"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Volumen"})]})]}),r("div",{className:"relative",children:e==="success"?r("div",{children:[r("div",{className:"text-sm text-gray-600 mb-2",children:"Tasa de Éxito Diaria (%)"}),m(n,i,_=>_.success_rate||0,"bg-green-500")]}):r("div",{children:[r("div",{className:"text-sm text-gray-600 mb-2",children:"Ejecuciones Diarias"}),m(n,o,_=>_.total_runs,"bg-blue-500")]})})]}),r("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r("div",{className:"bg-white rounded-lg shadow p-6",children:[r("h4",{className:"text-md font-semibold mb-4",children:"Distribución de Resultados"}),r("div",{className:"space-y-3",children:[r("div",{className:"flex justify-between items-center",children:[r("span",{className:"text-sm text-gray-600",children:"Exitosas"}),r("div",{className:"flex items-center gap-2",children:[r("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:r("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${a.total_runs>0?a.successful_runs/a.total_runs*100:0}%`}})}),r("span",{className:"text-sm font-medium",children:a.successful_runs})]})]}),r("div",{className:"flex justify-between items-center",children:[r("span",{className:"text-sm text-gray-600",children:"Fallidas"}),r("div",{className:"flex items-center gap-2",children:[r("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:r("div",{className:"bg-red-500 h-2 rounded-full",style:{width:`${a.total_runs>0?a.failed_runs/a.total_runs*100:0}%`}})}),r("span",{className:"text-sm font-medium",children:a.failed_runs})]})]}),r("div",{className:"flex justify-between items-center",children:[r("span",{className:"text-sm text-gray-600",children:"En Ejecución"}),r("div",{className:"flex items-center gap-2",children:[r("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:r("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${a.total_runs>0?a.running_runs/a.total_runs*100:0}%`}})}),r("span",{className:"text-sm font-medium",children:a.running_runs})]})]})]})]}),r("div",{className:"bg-white rounded-lg shadow p-6",children:[r("h4",{className:"text-md font-semibold mb-4",children:"Métricas de Rendimiento"}),r("div",{className:"space-y-4",children:[r("div",{className:"flex justify-between",children:[r("span",{className:"text-sm text-gray-600",children:"Duración Promedio"}),r("span",{className:"text-sm font-medium",children:[((h=a.average_duration_minutes)==null?void 0:h.toFixed(1))||0," minutos"]})]}),r("div",{className:"flex justify-between",children:[r("span",{className:"text-sm text-gray-600",children:"Última Ejecución"}),r("span",{className:"text-sm font-medium",children:a.last_run_date?new Date(a.last_run_date).toLocaleDateString("es-ES"):"Nunca"})]}),r("div",{className:"flex justify-between",children:[r("span",{className:"text-sm text-gray-600",children:"Total Ejecutado"}),r("span",{className:"text-sm font-medium",children:a.total_runs})]}),r("div",{className:"flex justify-between",children:[r("span",{className:"text-sm text-gray-600",children:"En Cola"}),r("span",{className:"text-sm font-medium",children:a.queued_runs})]})]})]})]}),r("div",{className:"bg-white rounded-lg shadow p-4",children:r("div",{className:"text-sm text-gray-500 text-center",children:["Período analizado: ",new Date(t.period_start).toLocaleDateString("es-ES")," - ",new Date(t.period_end).toLocaleDateString("es-ES")]})})]})}function qi({agentId:t}){var y,p,x;const[e,s]=C(null),[n,a]=C(null),[o,i]=C(!0),[c,m]=C(""),[h,_]=C("overview");M(()=>{t&&d()},[t]);const d=async()=>{try{i(!0),m("");const[l,u]=await Promise.all([ii(t),di(t,30,10)]);s(l),a(u)}catch(l){console.error("Error loading agent:",l),m("No se pudo cargar la información del agente")}finally{i(!1)}};if(o)return r("div",{className:"flex justify-center items-center min-h-64",children:r("div",{className:"text-gray-600",children:"Cargando agente..."})});if(c)return r("div",{className:"p-6",children:[r("div",{className:"text-red-500 mb-4",children:c}),r(ge,{href:"#/agents",className:"text-blue-500 hover:underline",children:"← Volver a Agentes"})]});if(!e)return r("div",{className:"p-6",children:[r("div",{className:"text-gray-500 mb-4",children:"Agente no encontrado"}),r(ge,{href:"#/agents",className:"text-blue-500 hover:underline",children:"← Volver a Agentes"})]});const f=l=>{switch(l==null?void 0:l.toLowerCase()){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-gray-100 text-gray-800";case"error":return"bg-red-100 text-red-800";default:return"bg-blue-100 text-blue-800"}},v=l=>l?new Date(l).toLocaleString("es-ES"):"N/A",b=[{id:"overview",label:"Resumen"},{id:"runs",label:"Ejecuciones"},{id:"analytics",label:"Análisis"}];return r("div",{className:"p-6",children:[r("div",{className:"mb-6",children:[r(ge,{href:"#/agents",className:"text-blue-500 hover:underline mb-2 inline-block",children:"← Volver a Agentes"}),r("div",{className:"flex justify-between items-start",children:[r("div",{children:[r("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:e.name}),r("div",{className:"flex items-center gap-3",children:[r("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${f(e.status)}`,children:e.status}),r("span",{className:"text-sm text-gray-500",children:["Modelo: ",e.model]})]})]}),r("div",{className:"text-right text-sm text-gray-500",children:[r("div",{children:["Creado: ",v(e.created_at)]}),e.updated_at&&r("div",{children:["Actualizado: ",v(e.updated_at)]})]})]})]}),n&&r("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[r("div",{className:"bg-white p-4 rounded-lg shadow",children:[r("div",{className:"text-2xl font-bold text-blue-600",children:n.statistics.total_runs}),r("div",{className:"text-sm text-gray-600",children:"Total Ejecuciones"})]}),r("div",{className:"bg-white p-4 rounded-lg shadow",children:[r("div",{className:"text-2xl font-bold text-green-600",children:[((y=n.statistics.success_rate)==null?void 0:y.toFixed(1))||0,"%"]}),r("div",{className:"text-sm text-gray-600",children:"Tasa de Éxito"})]}),r("div",{className:"bg-white p-4 rounded-lg shadow",children:[r("div",{className:"text-2xl font-bold text-orange-600",children:[((p=n.statistics.average_duration_minutes)==null?void 0:p.toFixed(1))||0,"m"]}),r("div",{className:"text-sm text-gray-600",children:"Duración Promedio"})]}),r("div",{className:"bg-white p-4 rounded-lg shadow",children:[r("div",{className:"text-2xl font-bold text-purple-600",children:n.statistics.running_runs}),r("div",{className:"text-sm text-gray-600",children:"Ejecutando Ahora"})]})]}),r("div",{className:"border-b border-gray-200 mb-6",children:r("nav",{className:"-mb-px flex space-x-8",children:b.map(l=>r("button",{onClick:()=>_(l.id),className:`py-2 px-1 border-b-2 font-medium text-sm ${h===l.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:l.label},l.id))})}),r("div",{children:[h==="overview"&&r("div",{className:"space-y-6",children:[r("div",{className:"bg-white rounded-lg shadow p-6",children:[r("h3",{className:"text-lg font-semibold mb-4",children:"Configuración"}),r("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r("div",{children:[r("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prompt Sistema"}),r("div",{className:"bg-gray-50 p-3 rounded text-sm text-gray-700 max-h-32 overflow-y-auto",children:e.default_prompt})]}),r("div",{className:"space-y-4",children:[r("div",{children:[r("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tools Disponibles"}),r("div",{className:"flex flex-wrap gap-2",children:((x=e.tools)==null?void 0:x.map((l,u)=>r("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:l},u)))||r("span",{className:"text-gray-500 text-sm",children:"Sin tools"})})]}),r("div",{className:"grid grid-cols-2 gap-4",children:[r("div",{children:[r("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Temperature"}),r("div",{className:"text-sm text-gray-900",children:e.temperature})]}),r("div",{children:[r("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Iteraciones"}),r("div",{className:"text-sm text-gray-900",children:e.max_iterations})]})]})]})]})]}),(n==null?void 0:n.recent_runs)&&n.recent_runs.length>0&&r("div",{className:"bg-white rounded-lg shadow p-6",children:[r("h3",{className:"text-lg font-semibold mb-4",children:"Actividad Reciente"}),r("div",{className:"space-y-3",children:n.recent_runs.slice(0,5).map(l=>r("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[r("div",{children:[r("div",{className:"font-medium text-sm",children:l.goal||"Sin objetivo específico"}),r("div",{className:"text-xs text-gray-500",children:v(l.created_at)})]}),r("div",{className:"flex items-center gap-2",children:r("span",{className:`px-2 py-1 rounded text-xs ${l.status==="succeeded"?"bg-green-100 text-green-800":l.status==="failed"?"bg-red-100 text-red-800":l.status==="running"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:l.status})})]},l.run_id))})]})]}),h==="runs"&&r(Fi,{agentId:t}),h==="analytics"&&n&&r(Ii,{analytics:n})]})]})}const Jn=()=>{const[t,e]=C("processing"),[s,n]=C("Procesando autorización..."),[a,o]=C(null),i=async(_,d,f)=>{try{if(n("Intercambiando código por tokens..."),window.opener){console.log("Popup detected - sending success message to parent"),window.opener.postMessage({oauth:"success",code:_,state:d,service:f},window.location.origin),e("success"),n("¡Autorización completada exitosamente!"),setTimeout(()=>{window.close()},2e3);return}const v=new URLSearchParams({service:f,code:_});d&&v.append("state",d);const b=await fetch(`/api/oauth/callback?${v.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${V()}`},credentials:"include"});if(!b.ok){const y=await b.text();throw new Error(`Error ${b.status}: ${y}`)}e("success"),n("¡Credenciales guardadas exitosamente!"),await c(f),setTimeout(()=>ie("/"),3e3)}catch(v){if(console.error("Error processing OAuth callback:",v),window.opener){window.opener.postMessage({oauth:"error",error:v.message},window.location.origin),setTimeout(()=>{window.close()},2e3);return}e("error"),n(`Error procesando autorización: ${v.message}`)}},c=async _=>{try{const d=await fetch(`/api/credentials/${_}`,{headers:{Authorization:`Bearer ${V()}`}});if(d.ok){const f=await d.json();o({service_id:f.service_id,created_at:f.created_at}),n(`¡${f.service_id.toUpperCase()} conectado exitosamente!`)}}catch{console.log("Could not verify credentials, but OAuth might still be successful")}},m=_=>{try{const d=JSON.parse(atob(_));return d.service||d.provider}catch{return _}},h=()=>{const _=document.referrer,d=window.location.href,f=[/service=([^&]+)/,/provider=([^&]+)/,/\/oauth\/([^\/\?]+)/];for(const v of f){const b=(_+d).match(v);if(b)return b[1]}return null};return M(()=>{(async()=>{const d=new URLSearchParams(window.location.search),f=d.get("code"),v=d.get("state"),b=d.get("error"),y=d.get("error_description");if(b){const x=y?`${b}: ${y}`:b;if(window.opener){window.opener.postMessage({oauth:"error",error:x},window.location.origin),setTimeout(()=>{window.close()},2e3);return}e("error"),n(`Error en autorización: ${x}`),setTimeout(()=>ie("/"),5e3);return}if(!f){const x="No se recibió código de autorización";if(window.opener){window.opener.postMessage({oauth:"error",error:x},window.location.origin),setTimeout(()=>{window.close()},2e3);return}e("error"),n(x),setTimeout(()=>ie("/"),3e3);return}let p=null;if(v&&(p=m(v)),p||(p=h()),!p){const x=window.location.hostname;x.includes("google")?p="google":x.includes("microsoft")?p="microsoft":x.includes("slack")?p="slack":p="unknown"}await i(f,v,p)})()},[]),r("div",{className:"min-h-screen bg-gradient-main flex items-center justify-center",children:r("div",{className:"glass-card p-8 text-center max-w-md mx-4",children:[t==="processing"&&r(X,{children:[r("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent mx-auto mb-4"}),r("h2",{className:"text-xl font-semibold text-elegant mb-2",children:"Procesando autorización"}),r("p",{className:"text-subtle",children:s})]}),t==="success"&&r(X,{children:[r("div",{className:"text-green-500 text-6xl mb-4",children:"✅"}),r("h2",{className:"text-xl font-semibold text-elegant mb-2",children:"¡Autorización exitosa!"}),r("p",{className:"text-subtle mb-4",children:s}),a&&r("div",{className:"surface-elevated rounded-lg p-4 mb-4",children:r("div",{className:"text-sm text-elegant",children:[r("div",{children:[r("strong",{children:"Servicio:"})," ",a.service_id]}),r("div",{children:[r("strong",{children:"Conectado:"})," ",new Date(a.created_at).toLocaleString()]})]})}),r("p",{className:"text-xs text-muted",children:"Redirigiendo automáticamente en unos segundos..."})]}),t==="error"&&r(X,{children:[r("div",{className:"text-red-500 text-6xl mb-4",children:"❌"}),r("h2",{className:"text-xl font-semibold text-elegant mb-2",children:"Error en autorización"}),r("p",{className:"text-subtle",children:s})]})]})})};Jn.displayName="OAuthCallback";function Ui(){const t=ir(s=>s.notifications),e=ir(s=>s.remove);return M(()=>{const s=t.map(n=>setTimeout(()=>e(n.id),3e3));return()=>s.forEach(n=>clearTimeout(n))},[t,e]),t.length===0?null:r("div",{className:"fixed bottom-4 right-4 space-y-2 z-50",children:t.map(s=>r("div",{className:"bg-gray-800 text-white px-3 py-2 rounded",children:s.message},s.id))})}class zi extends pe{constructor(s){super(s);rs(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(s){return{hasError:!0}}componentDidCatch(s,n){console.error("ErrorBoundary caught an error:",s,n),this.setState({error:s,errorInfo:n}),typeof window<"u"&&window.reportError&&window.reportError(s)}render(){return this.state.hasError?this.props.fallback?this.props.fallback(this.state.error,this.handleReset):r("div",{className:"min-h-[400px] flex items-center justify-center p-8",children:r("div",{className:"text-center max-w-md",children:[r("div",{className:"mb-4",children:r("div",{className:"w-16 h-16 mx-auto mb-4 text-red-500",children:r("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:r("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})})})}),r("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Algo salió mal"}),r("p",{className:"text-gray-600 mb-6",children:"Ha ocurrido un error inesperado. Por favor, intenta recargar la página."}),r("div",{className:"space-y-3",children:[r("button",{onClick:this.handleReset,className:"w-full px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Intentar de nuevo"}),r("button",{onClick:()=>window.location.reload(),className:"w-full px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Recargar página"})]}),!1]})}):this.props.children}}let St=null;async function Ir(){return St||(St=(async()=>{try{const t=localStorage.getItem("refresh_token");if(!t)return console.log("No refresh token available"),!1;const e=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:t})});if(e.ok){const s=await e.json();return He.getState().login(s.access_token),localStorage.setItem("refresh_token",s.refresh_token),console.log("Token refreshed successfully"),!0}else return console.log("Failed to refresh token:",e.status),!1}catch(t){return console.error("Error refreshing token:",t),!1}finally{St=null}})(),St)}function Yn(){const e=setInterval(async()=>{He.getState().token?(console.log("Attempting automatic token refresh..."),await Ir()||(console.log("Auto-refresh failed, user will need to login again"),clearInterval(e))):clearInterval(e)},5184e5),s=He.getState().token;if(s)try{const a=JSON.parse(atob(s.split(".")[1])).exp*1e3,o=Date.now();a-o<24*60*60*1e3&&(console.log("Token expires soon, attempting refresh..."),Ir())}catch(n){console.error("Error parsing token for expiry check:",n)}return e}const Hi=Object.freeze(Object.defineProperty({__proto__:null,refreshAccessToken:Ir,setupTokenAutoRefresh:Yn},Symbol.toStringTag,{value:"Module"}));function Xn(){const[t,e]=C(!1),{chats:s,activeChatId:n,addChat:a}=we(),{token:o,subscribeToLogout:i}=hr(),{mode:c}=Mt(),[m,h]=C(!1),[_,d]=C(!1),f=!!o;M(()=>{e(!0),o&&Yn()},[o]),M(()=>i(()=>{ie("/",!0)}),[i]);const[v,b]=C(!1),[y,p]=C(window.location.pathname);M(()=>{const l=()=>{p(window.location.pathname)};window.addEventListener("popstate",l);const u=history.pushState,w=history.replaceState;return history.pushState=function(...k){u.apply(this,k),l()},history.replaceState=function(...k){w.apply(this,k),l()},()=>{window.removeEventListener("popstate",l),history.pushState=u,history.replaceState=w}},[]);const x=y.startsWith("/chat")&&f;return t?r("div",{className:"min-h-screen flex bg-gradient-main text-text-primary",children:[x&&f&&r(ei,{}),r("div",{className:"flex-1 flex flex-col",children:[!x&&r("div",{className:"p-4 border-b border-primary glass",children:r("div",{className:"flex flex-wrap gap-2 items-center justify-between",children:[r("div",{className:"flex items-center gap-3",children:r(ge,{href:"/",className:"flex items-center gap-2 text-lg font-bold gradient-text-elegant hover:scale-105 transition-transform",children:[r("div",{className:"w-12 h-12 flex items-center justify-center",children:r("img",{src:"/logo.svg",alt:"QYRAL Logo",className:"w-12 h-12",style:{filter:"none"}})}),"QYRAL AI"]})}),r("div",{className:"flex items-center gap-2",children:[f&&r(X,{children:[r(ge,{href:"/workflows",className:"btn-glass px-3 py-2 rounded-lg",children:"Mis Workflows"}),r(ge,{href:"/chat",className:"btn-primary px-3 py-2 rounded-lg",children:"Crear Workflow"})]}),r("button",{className:"btn-glass px-3 py-2 rounded-lg opacity-50 cursor-not-allowed",disabled:!0,children:"Marketplace - Próximamente"}),r("button",{className:"btn-glass px-3 py-2 rounded-lg opacity-50 cursor-not-allowed",disabled:!0,children:"Agents - Próximamente"}),!f&&r("button",{onClick:()=>b(!0),className:"btn-primary px-4 py-2 rounded-lg font-semibold",children:"🔑 Iniciar Sesión"})]})]})}),r("div",{className:"flex-1 overflow-hidden",children:r(zi,{children:r(ar,{children:[r(Kn,{path:"/",isAuthenticated:f,onLoginClick:()=>b(!0)}),r(Fs,{path:"/chat"}),r(Fs,{path:"/chat/:chatId"}),r(Pi,{path:"/workflows"}),r(Si,{path:"/executions"}),r(Ei,{path:"/executions/:id"}),r(Ti,{path:"/marketplace"}),r(ji,{path:"/agents"}),r(qi,{path:"/agents/:agentId"}),r(Jn,{path:"/oauth-callback"})]})})})]}),v&&r(ti,{onClose:()=>b(!1)}),r(Xr,{isOpen:m&&f,onClose:()=>h(!1),chatId:n}),r(mi,{isOpen:_&&f,onClose:()=>d(!1)}),r(Ui,{})]}):r("div",{className:"min-h-screen bg-gradient-main flex items-center justify-center",children:r("div",{className:"text-center",children:[r("div",{className:"w-16 h-16 surface-elevated rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-elegant",children:r("img",{src:"/logo.svg",alt:"QYRAL Logo",className:"w-10 h-10",style:{filter:"none"}})}),r("div",{className:"text-lg font-semibold gradient-text",children:"Cargando QYRAL AI..."})]})})}Xn.displayName="App";class Wi{constructor(){this.logEndpoint="/api/frontend-logs",this.logBuffer=[],this.maxBufferSize=50,this.flushInterval=5e3,this.setupAutoFlush(),this.interceptConsole()}interceptConsole(){this.originalConsole={log:console.log,info:console.info,warn:console.warn,error:console.error,debug:console.debug},console.log=(...e)=>{this.originalConsole.log(...e),this.addLog("INFO",e)},console.info=(...e)=>{this.originalConsole.info(...e),this.addLog("INFO",e)},console.warn=(...e)=>{this.originalConsole.warn(...e),this.addLog("WARN",e)},console.error=(...e)=>{this.originalConsole.error(...e),this.addLog("ERROR",e)},console.debug=(...e)=>{this.originalConsole.debug(...e),this.addLog("DEBUG",e)}}addLog(e,s){const n=new Date().toISOString(),a=s.map(i=>typeof i=="object"?JSON.stringify(i,null,2):String(i)).join(" "),o={timestamp:n,level:e,message:a,url:window.location.href,userAgent:navigator.userAgent};this.logBuffer.push(o),this.logBuffer.length>=this.maxBufferSize&&this.flushLogs()}async flushLogs(){if(this.logBuffer.length===0)return;const e=[...this.logBuffer];this.logBuffer=[];try{await fetch(this.logEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({logs:e,source:"frontend"})})}catch(s){this.logBuffer.unshift(...e),this.originalConsole.error("Failed to send frontend logs to backend:",s)}}setupAutoFlush(){setInterval(()=>{this.flushLogs()},this.flushInterval),window.addEventListener("beforeunload",()=>{this.flushLogs()})}logWorkflow(e,s){console.log(`🔧 WORKFLOW_${e.toUpperCase()}:`,s)}logAPI(e,s,n,a){console.log(`🌐 API_${e.toUpperCase()}: ${s}`,{data:n,response:a})}logError(e,s){console.error(`❌ ERROR_${e.toUpperCase()}:`,s)}logDebug(e,s){console.debug(`🔍 DEBUG_${e.toUpperCase()}:`,s)}}new Wi;const Bi=new Oa,Zn=document.getElementById("app");if(!Zn)throw new Error("No se encontró el elemento #app en el DOM");_t(r(fo,{client:Bi,children:r(Xn,{})}),Zn);
